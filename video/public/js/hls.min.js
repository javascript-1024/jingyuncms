"undefined"!=typeof window&&function(F,C){"object"==typeof exports&&"object"==typeof module?module.exports=C():"function"==typeof define&&define.amd?define([],C):"object"==typeof exports?exports.Hls=C():F.Hls=C()}(this,function(){return function(F){function C(A){if(z[A])return z[A].exports;var q=z[A]={i:A,l:!1,exports:{}};return F[A].call(q.exports,q,q.exports,C),q.l=!0,q.exports}var z={};return C.m=F,C.c=z,C.d=function(A,q,g){C.o(A,q)||Object.defineProperty(A,q,{enumerable:!0,get:g})},C.r=function(A){"undefined"!=
typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"});Object.defineProperty(A,"__esModule",{value:!0})},C.t=function(A,q){if((1&q&&(A=C(A)),8&q)||4&q&&"object"==typeof A&&A&&A.__esModule)return A;var g=Object.create(null);if(C.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:A}),2&q&&"string"!=typeof A)for(var p in A)C.d(g,p,function(r){return A[r]}.bind(null,p));return g},C.n=function(A){var q=A&&A.__esModule?function(){return A.default}:function(){return A};
return C.d(q,"a",q),q},C.o=function(A,q){return Object.prototype.hasOwnProperty.call(A,q)},C.p="/dist/",C(C.s=31)}([function(F,C,z){function A(){}function q(h){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];c.forEach(function(f){p[f]=h[f]?h[f].bind(h):function(a){var e=r.console[a];return e?function(){for(var m=[],d=0;d<arguments.length;d++)m[d]=arguments[d];m[0]&&(m[0]="["+a+"] > "+m[0]);e.apply(r.console,m)}:A}(f)})}Object.defineProperty(C,"__esModule",{value:!0});F=z(6);var g={trace:A,
debug:A,log:A,warn:A,info:A,error:A},p=g,r=F.getSelfScope();C.enableLogs=function(h){if(!0===h||"object"==typeof h){q(h,"debug","log","info","warn","error");try{p.log()}catch(c){p=g}}else p=g};C.logger=p},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});C.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",
BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",
AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",
FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",
KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=z(6).getSelfScope().Number;C.Number=F;F.isFinite=F.isFinite||function(A){return"number"==typeof A&&isFinite(A)}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});C.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"};
C.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",
AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",
BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(0),q=z(3),g=z(1),p={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0};F=function(){function r(h){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];this.hls=h;this.onEvent=this.onEvent.bind(this);this.handledEvents=c;this.useGenericHandler=
!0;this.registerListeners()}return r.prototype.destroy=function(){this.onHandlerDestroying();this.unregisterListeners();this.onHandlerDestroyed()},r.prototype.onHandlerDestroying=function(){},r.prototype.onHandlerDestroyed=function(){},r.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},r.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(h){if(p[h])throw Error("Forbidden event-name: "+
h);this.hls.on(h,this.onEvent)},this)},r.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(h){this.hls.off(h,this.onEvent)},this)},r.prototype.onEvent=function(h,c){this.onEventGeneric(h,c)},r.prototype.onEventGeneric=function(h,c){try{var b="on"+h.replace("hls","");if("function"!=typeof this[b])throw Error("Event "+h+" has no generic handler in this "+this.constructor.name+" class (tried "+b+")");this[b].bind(this,c).call()}catch(f){A.logger.error("An internal error happened while handling event "+
h+'. Error message: "'+f.message+'". Here is a stacktrace:',f),this.hls.trigger(g.default.ERROR,{type:q.ErrorTypes.OTHER_ERROR,details:q.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:h,err:f})}},r}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=function(){function A(){}return A.isBuffered=function(q,g){try{if(q){var p=q.buffered;for(q=0;q<p.length;q++)if(g>=p.start(q)&&g<=p.end(q))return!0}}catch(r){}return!1},A.bufferInfo=function(q,g,p){try{if(q){var r=q.buffered;
q=[];var h=void 0;for(h=0;h<r.length;h++)q.push({start:r.start(h),end:r.end(h)});return this.bufferedInfo(q,g,p)}}catch(c){}return{len:0,start:g,end:g,nextStart:void 0}},A.bufferedInfo=function(q,g,p){var r,h,c=[];q.sort(function(m,d){return m.start-d.start||d.end-m.end});for(h=0;h<q.length;h++)if(r=c.length){var b=c[r-1].end;q[h].start-b<p?q[h].end>b&&(c[r-1].end=q[h].end):c.push(q[h])}else c.push(q[h]);q=h=0;for(r=b=g;h<c.length;h++){var f=c[h].start,a=c[h].end;if(g+p>=f&&g<a)r=f,q=(b=a)-g;else if(g+
p<f){var e=f;break}}return{len:q,start:r,end:b,nextStart:e}},A}();C.BufferHelper=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});C.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,b){c.__proto__=b}||function(c,b){for(var f in b)b.hasOwnProperty(f)&&(c[f]=b[f])};return function(c,b){function f(){this.constructor=c}h(c,
b);c.prototype=null===b?Object.create(b):(f.prototype=b.prototype,new f)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(4),p=z(1);C.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var r=function(h){function c(b){var f=h.call(this,b,p.default.BUFFER_APPENDED,p.default.FRAG_BUFFERED,p.default.FRAG_LOADED)||this;return f.bufferPadding=.2,f.fragments=Object.create(null),f.timeRanges=Object.create(null),f.config=b.config,f}return q(c,h),c.prototype.destroy=
function(){this.fragments=Object.create(null);this.timeRanges=Object.create(null);this.config=null;g.default.prototype.destroy.call(this);h.prototype.destroy.call(this)},c.prototype.getBufferedFrag=function(b,f){var a=this.fragments,e=Object.keys(a).filter(function(m){m=a[m];if(m.body.type!==f||!m.buffered)return!1;m=m.body;return m.startPTS<=b&&b<=m.endPTS});if(0===e.length)return null;e=e.pop();return a[e].body},c.prototype.detectEvictedFragments=function(b,f){var a,e,m=this;Object.keys(this.fragments).forEach(function(d){d=
m.fragments[d];if(!0===d.buffered){var k=d.range[b];if(k)for(a=k.time,k=0;k<a.length;k++)if(e=a[k],!1===m.isTimeBuffered(e.startPTS,e.endPTS,f)){m.removeFragment(d.body);break}}})},c.prototype.detectPartialFragments=function(b){var f=this,a=this.getFragmentKey(b),e=this.fragments[a];e&&(e.buffered=!0,Object.keys(this.timeRanges).forEach(function(m){b.hasElementaryStream(m)&&(e.range[m]=f.getBufferedTimes(b.startPTS,b.endPTS,f.timeRanges[m]))}))},c.prototype.getBufferedTimes=function(b,f,a){for(var e,
m,d=[],k=!1,t=0;t<a.length;t++){if(e=a.start(t)-this.bufferPadding,m=a.end(t)+this.bufferPadding,b>=e&&f<=m){d.push({startPTS:Math.max(b,a.start(t)),endPTS:Math.min(f,a.end(t))});break}if(b<m&&f>e)d.push({startPTS:Math.max(b,a.start(t)),endPTS:Math.min(f,a.end(t))}),k=!0;else if(f<=e)break}return{time:d,partial:k}},c.prototype.getFragmentKey=function(b){return b.type+"_"+b.level+"_"+b.urlId+"_"+b.sn},c.prototype.getPartialFragment=function(b){var f,a,e,m=this,d=null,k=0;return Object.keys(this.fragments).forEach(function(t){t=
m.fragments[t];m.isPartial(t)&&(a=t.body.startPTS-m.bufferPadding,e=t.body.endPTS+m.bufferPadding,b>=a&&b<=e&&(f=Math.min(b-a,e-b),k<=f&&(d=t.body,k=f)))}),d},c.prototype.getState=function(b){b=this.getFragmentKey(b);b=this.fragments[b];var f=C.FragmentState.NOT_LOADED;return void 0!==b&&(f=b.buffered?!0===this.isPartial(b)?C.FragmentState.PARTIAL:C.FragmentState.OK:C.FragmentState.APPENDING),f},c.prototype.isPartial=function(b){return!0===b.buffered&&(void 0!==b.range.video&&!0===b.range.video.partial||
void 0!==b.range.audio&&!0===b.range.audio.partial)},c.prototype.isTimeBuffered=function(b,f,a){for(var e,m,d=0;d<a.length;d++){if(e=a.start(d)-this.bufferPadding,m=a.end(d)+this.bufferPadding,b>=e&&f<=m)return!0;if(f<=e)break}return!1},c.prototype.onFragLoaded=function(b){b=b.frag;A.isFinite(b.sn)&&!b.bitrateTest&&(this.fragments[this.getFragmentKey(b)]={body:b,range:Object.create(null),buffered:!1})},c.prototype.onBufferAppended=function(b){var f=this;this.timeRanges=b.timeRanges;Object.keys(this.timeRanges).forEach(function(a){f.detectEvictedFragments(a,
f.timeRanges[a])})},c.prototype.onFragBuffered=function(b){this.detectPartialFragments(b.frag)},c.prototype.hasFragment=function(b){b=this.getFragmentKey(b);return void 0!==this.fragments[b]},c.prototype.removeFragment=function(b){b=this.getFragmentKey(b);delete this.fragments[b]},c.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},c}(g.default);C.FragmentTracker=r}).call(this,z(2).Number)},function(F,C,z){(function(A){function q(c,b,f){var a=c[b];c=c[f];var e=c.startPTS;
A.isFinite(e)?f>b?(a.duration=e-a.start,0>a.duration&&h.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):(c.duration=a.start-e,0>c.duration&&h.logger.warn("negative duration computed for frag "+c.sn+",level "+c.level+", there should be some duration drift between playlist and fragment!")):c.start=f>b?a.start+a.duration:Math.max(a.start-c.duration,0)}function g(c,b,f,a,e,m){var d=f;if(A.isFinite(b.startPTS)){var k=
Math.abs(b.startPTS-f);A.isFinite(b.deltaPTS)?b.deltaPTS=Math.max(k,b.deltaPTS):b.deltaPTS=k;d=Math.max(f,b.startPTS);f=Math.min(f,b.startPTS);a=Math.max(a,b.endPTS);e=Math.min(e,b.startDTS);m=Math.max(m,b.endDTS)}k=f-b.start;b.start=b.startPTS=f;b.maxStartPTS=d;b.endPTS=a;b.startDTS=e;b.endDTS=m;b.duration=a-f;f=b.sn;if(!c||f<c.startSN||f>c.endSN)return 0;f-=c.startSN;(a=c.fragments)[f]=b;for(b=f;0<b;b--)q(a,b,b-1);for(b=f;b<a.length-1;b++)q(a,b,b+1);return c.PTSKnown=!0,k}function p(c,b,f){if(c&&
b)for(var a=Math.min(c.endSN,b.endSN)-b.startSN,e=b.startSN-c.startSN,m=Math.max(c.startSN,b.startSN)-b.startSN;m<=a;m++){var d=c.fragments[e+m],k=b.fragments[m];if(!d||!k)break;f(d,k,m)}}function r(c,b){var f=b.startSN-c.startSN;c=c.fragments;b=b.fragments;if(!(0>f||f>c.length))for(var a=0;a<b.length;a++)b[a].start+=c[f].start}Object.defineProperty(C,"__esModule",{value:!0});var h=z(0);C.addGroupId=function(c,b,f){switch(b){case "audio":c.audioGroupIds||(c.audioGroupIds=[]);c.audioGroupIds.push(f);
break;case "text":c.textGroupIds||(c.textGroupIds=[]),c.textGroupIds.push(f)}};C.updatePTS=q;C.updateFragPTSDTS=g;C.mergeDetails=function(c,b){b.initSegment&&c.initSegment&&(b.initSegment=c.initSegment);var f,a=0;if(p(c,b,function(d,k){a=d.cc-k.cc;A.isFinite(d.startPTS)&&(k.start=k.startPTS=d.startPTS,k.endPTS=d.endPTS,k.duration=d.duration,k.backtracked=d.backtracked,k.dropped=d.dropped,f=k);b.PTSKnown=!0}),b.PTSKnown){if(a){h.logger.log("discontinuity sliding from playlist, take drift into account");
for(var e=b.fragments,m=0;m<e.length;m++)e[m].cc+=a}f?g(b,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):r(c,b);b.PTSKnown=c.PTSKnown}};C.mergeSubtitlePlaylists=function(c,b,f){void 0===f&&(f=0);var a=-1;p(c,b,function(e,m,d){m.start=e.start;a=d});c=b.fragments;if(0>a)c.forEach(function(e){e.start+=f});else for(b=a+1;b<c.length;b++)c[b].start=c[b-1].start+c[b-1].duration};C.mapFragmentIntersection=p;C.adjustSliding=r;C.computeReloadInterval=function(c,b,f){var a=1E3*(b.averagetargetduration?b.averagetargetduration:
b.targetduration),e=a/2;return c&&b.endSN===c.endSN&&(a=e),f&&(a=Math.max(e,a-(window.performance.now()-f))),Math.round(a)}}).call(this,z(2).Number)},function(F,C,z){!function(A){var q=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,g=/^([^\/?#]*)(.*)$/,p=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,h={buildAbsoluteURL:function(c,b,f){if(f=f||{},c=c.trim(),!(b=b.trim())){if(!f.alwaysNormalize)return c;f=h.parseURL(c);if(!f)throw Error("Error trying to parse base URL.");
return f.path=h.normalizePath(f.path),h.buildURLFromParts(f)}var a=h.parseURL(b);if(!a)throw Error("Error trying to parse relative URL.");if(a.scheme)return f.alwaysNormalize?(a.path=h.normalizePath(a.path),h.buildURLFromParts(a)):b;b=h.parseURL(c);if(!b)throw Error("Error trying to parse base URL.");!b.netLoc&&b.path&&"/"!==b.path[0]&&(c=g.exec(b.path),b.netLoc=c[1],b.path=c[2]);b.netLoc&&!b.path&&(b.path="/");c={scheme:b.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};
a.netLoc||(c.netLoc=b.netLoc,"/"===a.path[0])||(a.path?(b=b.path,b=b.substring(0,b.lastIndexOf("/")+1)+a.path,c.path=h.normalizePath(b)):(c.path=b.path,a.params||(c.params=b.params,a.query||(c.query=b.query))));return null===c.path&&(c.path=f.alwaysNormalize?h.normalizePath(a.path):a.path),h.buildURLFromParts(c)},parseURL:function(c){return(c=q.exec(c))?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(p,
"");c.length!==(c=c.replace(r,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};F.exports=h}()},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});C.default={search:function(A,q){for(var g=0,p=A.length-1,r,h;g<=p;){var c=q(h=A[r=(g+p)/2|0]);if(0<c)g=r+1;else{if(!(0>c))return h;p=r-1}}return null}}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=function(){function A(){}
return A.isHeader=function(q,g){return g+10<=q.length&&73===q[g]&&68===q[g+1]&&51===q[g+2]&&255>q[g+3]&&255>q[g+4]&&128>q[g+6]&&128>q[g+7]&&128>q[g+8]&&128>q[g+9]},A.isFooter=function(q,g){return g+10<=q.length&&51===q[g]&&68===q[g+1]&&73===q[g+2]&&255>q[g+3]&&255>q[g+4]&&128>q[g+6]&&128>q[g+7]&&128>q[g+8]&&128>q[g+9]},A.getID3Data=function(q,g){for(var p=g,r=0;A.isHeader(q,g);)r+=10,r+=A._readSize(q,g+6),A.isFooter(q,g+10)&&(r+=10),g+=r;if(0<r)return q.subarray(p,p+r)},A._readSize=function(q,g){var p=
0;return p=(127&q[g])<<21,p|=(127&q[g+1])<<14,p|=(127&q[g+2])<<7,p|127&q[g+3]},A.getTimeStamp=function(q){q=A.getID3Frames(q);for(var g=0;g<q.length;g++){var p=q[g];if(A.isTimeStampFrame(p))return A._readTimeStamp(p)}},A.isTimeStampFrame=function(q){return q&&"PRIV"===q.key&&"com.apple.streaming.transportStreamTimestamp"===q.info},A._getFrameData=function(q){var g=String.fromCharCode(q[0],q[1],q[2],q[3]),p=A._readSize(q,4);return{type:g,size:p,data:q.subarray(10,10+p)}},A.getID3Frames=function(q){for(var g=
0,p=[];A.isHeader(q,g);){var r=A._readSize(q,g+6);for(r=(g+=10)+r;g+8<r;){var h=A._getFrameData(q.subarray(g)),c=A._decodeFrame(h);c&&p.push(c);g+=h.size+10}A.isFooter(q,g)&&(g+=10)}return p},A._decodeFrame=function(q){return"PRIV"===q.type?A._decodePrivFrame(q):"T"===q.type[0]?A._decodeTextFrame(q):"W"===q.type[0]?A._decodeURLFrame(q):void 0},A._readTimeStamp=function(q){if(8===q.data.byteLength){var g=new Uint8Array(q.data);q=1&g[3];g=(g[4]<<23)+(g[5]<<15)+(g[6]<<7)+g[7];return g/=45,q&&(g+=4.772185884E7),
Math.round(g)}},A._decodePrivFrame=function(q){if(!(2>q.size)){var g=A._utf8ArrayToStr(q.data,!0),p=new Uint8Array(q.data.subarray(g.length+1));return{key:q.type,info:g,data:p.buffer}}},A._decodeTextFrame=function(q){if(!(2>q.size)){if("TXXX"===q.type){var g=1,p=A._utf8ArrayToStr(q.data.subarray(g));g+=p.length+1;g=A._utf8ArrayToStr(q.data.subarray(g));return{key:q.type,info:p,data:g}}p=A._utf8ArrayToStr(q.data.subarray(1));return{key:q.type,data:p}}},A._decodeURLFrame=function(q){if("WXXX"===q.type){if(2>
q.size)return;var g=1,p=A._utf8ArrayToStr(q.data.subarray(g));g+=p.length+1;g=A._utf8ArrayToStr(q.data.subarray(g));return{key:q.type,info:p,data:g}}p=A._utf8ArrayToStr(q.data);return{key:q.type,data:p}},A._utf8ArrayToStr=function(q,g){void 0===g&&(g=!1);for(var p,r,h,c=q.length,b="",f=0;f<c&&(0!==(p=q[f++])||!g);)if(0!==p&&3!==p)switch(p>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(p);break;case 12:case 13:r=q[f++];b+=String.fromCharCode((31&p)<<6|63&r);break;
case 14:r=q[f++],h=q[f++],b+=String.fromCharCode((15&p)<<12|(63&r)<<6|(63&h)<<0)}return b},A}();C.utf8ArrayToStr=F._utf8ArrayToStr;C.default=F},function(F,C,z){(function(A){Object.defineProperty(C,"__esModule",{value:!0});var q=z(9),g=z(18),p=function(){function r(){var h;this._decryptdata=this._byteRange=this._url=null;this.tagList=[];this.rawProgramDateTime=this.programDateTime=null;this._elementaryStreams=((h={})[r.ElementaryStreamTypes.AUDIO]=!1,h[r.ElementaryStreamTypes.VIDEO]=!1,h)}return Object.defineProperty(r,
"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=q.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(h){this._url=h},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var h=
[];if(this.rawByteRange){var c=this.rawByteRange.split("@",2);h[0]=1===c.length?this.lastByteRangeEndOffset||0:parseInt(c[1]);h[1]=parseInt(c[0])+h[0];this._byteRange=h}return h},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,
"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"endProgramDateTime",{get:function(){if(!A.isFinite(this.programDateTime))return null;var h=A.isFinite(this.duration)?this.duration:0;return this.programDateTime+1E3*h},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"encrypted",{get:function(){return!(!this.decryptdata||
null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),r.prototype.addElementaryStream=function(h){this._elementaryStreams[h]=!0},r.prototype.hasElementaryStream=function(h){return!0===this._elementaryStreams[h]},r.prototype.createInitializationVector=function(h){for(var c=new Uint8Array(16),b=12;16>b;b++)c[b]=h>>8*(15-b)&255;return c},r.prototype.fragmentDecryptdataFromLevelkey=function(h,c){var b=h;return h&&h.method&&h.uri&&!h.iv&&((b=new g.default).method=h.method,
b.baseuri=h.baseuri,b.reluri=h.reluri,b.iv=this.createInitializationVector(c)),b},r}();C.default=p}).call(this,z(2).Number)},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(39),q=z(40),g=z(41),p=z(3),r=z(0),h=z(1),c=z(6).getSelfScope();F=function(){function b(f,a,e){e=(void 0===e?{}:e).removePKCS7Padding;e=void 0===e||e;if(this.logEnabled=!0,this.observer=f,this.config=a,this.removePKCS7Padding=e,e)try{var m=c.crypto;m&&(this.subtle=m.subtle||m.webkitSubtle)}catch(d){}this.disableWebCrypto=
!this.subtle}return b.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},b.prototype.decrypt=function(f,a,e,m){var d=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(r.logger.log("JS AES decrypt"),this.logEnabled=!1);var k=this.decryptor;k||(this.decryptor=k=new g.default);k.expandKey(a);m(k.decrypt(f,0,e,this.removePKCS7Padding))}else{this.logEnabled&&(r.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var t=this.subtle;
this.key!==a&&(this.key=a,this.fastAesKey=new q.default(t,a));this.fastAesKey.expandKey().then(function(n){(new A.default(t,e)).decrypt(f,n).catch(function(l){d.onWebCryptoError(l,f,a,e,m)}).then(function(l){m(l)})}).catch(function(n){d.onWebCryptoError(n,f,a,e,m)})}},b.prototype.onWebCryptoError=function(f,a,e,m,d){this.config.enableSoftwareAES?(r.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(a,e,m,d)):(r.logger.error("decrypting error : "+
f.message),this.observer.trigger(h.default.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:f.message}))},b.prototype.destroy=function(){var f=this.decryptor;f&&(f.destroy(),this.decryptor=void 0)},b}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});C.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var c=
Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,f){b.__proto__=f}||function(b,f){for(var a in f)f.hasOwnProperty(a)&&(b[a]=f[a])};return function(b,f){function a(){this.constructor=b}c(b,f);b.prototype=null===f?Object.create(f):(a.prototype=f.prototype,new a)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(28),p=z(7),r=z(5),h=z(0);C.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",
WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};g=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}return q(b,c),b.prototype.doTick=function(){},b.prototype.startLoad=function(){},b.prototype.stopLoad=function(){var f=this.fragCurrent;f&&(f.loader&&f.loader.abort(),this.fragmentTracker.removeFragment(f));this.demuxer&&(this.demuxer.destroy(),
this.demuxer=null);this.fragPrevious=this.fragCurrent=null;this.clearInterval();this.clearNextTick();this.state=C.State.STOPPED},b.prototype._streamEnded=function(f,a){var e=this.fragCurrent,m=this.fragmentTracker;return a.live||!e||e.backtracked||e.sn!==a.endSN||f.nextStart?!1:(f=m.getState(e),f===p.FragmentState.PARTIAL||f===p.FragmentState.OK)},b.prototype.onMediaSeeking=function(){var f=this.config,a=this.media,e=this.state,m=a?a.currentTime:null,d=r.BufferHelper.bufferInfo(this.mediaBuffer||
a,m,this.config.maxBufferHole);(A.isFinite(m)&&h.logger.log("media seeking to "+m.toFixed(3)),e===C.State.FRAG_LOADING)?(e=this.fragCurrent,0===d.len&&e&&(f=f.maxFragLookUpTolerance,d=e.start+e.duration+f,m<e.start-f||m>d?(e.loader&&(h.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=C.State.IDLE):h.logger.log("seeking outside of buffer but within currently loaded fragment range"))):
e===C.State.ENDED&&(0===d.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=C.State.IDLE);a&&(this.lastCurrentTime=m);this.loadedmetadata||(this.nextLoadPosition=this.startPosition=m);this.tick()},b.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.prototype.onHandlerDestroying=function(){this.stopLoad();c.prototype.onHandlerDestroying.call(this)},b.prototype.onHandlerDestroyed=function(){this.state=C.State.STOPPED;this.fragmentTracker=null},b}(g.default);
C.default=g}).call(this,z(2).Number)},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,k){d.__proto__=k}||function(d,k){for(var t in k)k.hasOwnProperty(t)&&(d[t]=k[t])};return function(d,k){function t(){this.constructor=d}m(d,k);d.prototype=null===k?Object.create(k):(t.prototype=k.prototype,new t)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(1),p=z(4),r=z(3),h=z(0),c=z(17),b=z(32),f=window.performance,
a={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},e={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};p=function(m){function d(k){k=m.call(this,k,g.default.MANIFEST_LOADING,g.default.LEVEL_LOADING,g.default.AUDIO_TRACK_LOADING,g.default.SUBTITLE_TRACK_LOADING)||this;return k.loaders={},k}return q(d,m),Object.defineProperty(d,"ContextType",{get:function(){return a},enumerable:!0,configurable:!0}),Object.defineProperty(d,"LevelType",{get:function(){return e},
enumerable:!0,configurable:!0}),d.canHaveQualityLevels=function(k){return k!==a.AUDIO_TRACK&&k!==a.SUBTITLE_TRACK},d.mapContextToLevelType=function(k){switch(k.type){case a.AUDIO_TRACK:return e.AUDIO;case a.SUBTITLE_TRACK:return e.SUBTITLE;default:return e.MAIN}},d.getResponseUrl=function(k,t){k=k.url;return void 0!==k&&0!==k.indexOf("data:")||(k=t.url),k},d.prototype.createInternalLoader=function(k){var t=this.hls.config,n=t.loader;t=new (t.pLoader||n)(t);return k.loader=t,this.loaders[k.type]=t,
t},d.prototype.getInternalLoader=function(k){return this.loaders[k.type]},d.prototype.resetInternalLoader=function(k){this.loaders[k]&&delete this.loaders[k]},d.prototype.destroyInternalLoaders=function(){for(var k in this.loaders){var t=this.loaders[k];t&&t.destroy();this.resetInternalLoader(k)}},d.prototype.destroy=function(){this.destroyInternalLoaders();m.prototype.destroy.call(this)},d.prototype.onManifestLoading=function(k){this.load(k.url,{type:a.MANIFEST,level:0,id:null})},d.prototype.onLevelLoading=
function(k){this.load(k.url,{type:a.LEVEL,level:k.level,id:k.id})},d.prototype.onAudioTrackLoading=function(k){this.load(k.url,{type:a.AUDIO_TRACK,level:null,id:k.id})},d.prototype.onSubtitleTrackLoading=function(k){this.load(k.url,{type:a.SUBTITLE_TRACK,level:null,id:k.id})},d.prototype.load=function(k,t){var n=this.hls.config;h.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var l,v=this.getInternalLoader(t);if(v){if((l=v.context)&&l.url===k)return h.logger.trace("playlist request ongoing"),
!1;h.logger.warn("aborting previous loader for type: "+t.type);v.abort()}switch(t.type){case a.MANIFEST:l=n.manifestLoadingMaxRetry;var w=n.manifestLoadingTimeOut;var x=n.manifestLoadingRetryDelay;var u=n.manifestLoadingMaxRetryTimeout;break;case a.LEVEL:l=0;w=n.levelLoadingTimeOut;break;default:l=n.levelLoadingMaxRetry,w=n.levelLoadingTimeOut,x=n.levelLoadingRetryDelay,u=n.levelLoadingMaxRetryTimeout}v=this.createInternalLoader(t);t.url=k;t.responseType=t.responseType||"";n={timeout:w,maxRetry:l,
retryDelay:x,maxRetryDelay:u};x={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return h.logger.debug("Calling internal loader delegate for URL: "+k),v.load(t,n,x),!0},d.prototype.loadsuccess=function(k,t,n,l){if(void 0===l&&(l=null),n.isSidxRequest)return this._handleSidxRequest(k,n),void this._handlePlaylistLoaded(k,t,n,l);this.resetInternalLoader(n.type);var v=k.data;t.tload=f.now();0===v.indexOf("#EXTM3U")?0<v.indexOf("#EXTINF:")||
0<v.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(k,t,n,l):this._handleMasterPlaylist(k,t,n,l):this._handleManifestParsingError(k,n,"no EXTM3U delimiter",l)},d.prototype.loaderror=function(k,t,n){void 0===n&&(n=null);this._handleNetworkError(t,n,!1,k)},d.prototype.loadtimeout=function(k,t,n){void 0===n&&(n=null);this._handleNetworkError(t,n,!0)},d.prototype._handleMasterPlaylist=function(k,t,n,l){var v=this.hls,w=k.data,x=d.getResponseUrl(k,n),u=b.default.parseMasterPlaylist(w,
x);if(u.length){k=u.map(function(B){return{id:B.attrs.AUDIO,codec:B.audioCodec}});k=b.default.parseMasterPlaylistMedia(w,x,"AUDIO",k);w=b.default.parseMasterPlaylistMedia(w,x,"SUBTITLES");if(k.length){var y=!1;k.forEach(function(B){B.url||(y=!0)});!1===y&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(h.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),k.unshift({type:"main",name:"main"}))}v.trigger(g.default.MANIFEST_LOADED,{levels:u,audioTracks:k,subtitles:w,
url:x,stats:t,networkDetails:l})}else this._handleManifestParsingError(k,n,"no level found in manifest",l)},d.prototype._handleTrackOrLevelPlaylist=function(k,t,n,l){var v=this.hls,w=n.id,x=n.level,u=n.type,y=d.getResponseUrl(k,n),B=A.isFinite(w)?w:0,E=A.isFinite(x)?x:B,G=d.mapContextToLevelType(n);B=b.default.parseLevelPlaylist(k.data,y,E,G,B);(B.tload=t.tload,u===a.MANIFEST)&&v.trigger(g.default.MANIFEST_LOADED,{levels:[{url:y,details:B}],audioTracks:[],url:y,stats:t,networkDetails:l});(t.tparsed=
f.now(),B.needSidxRanges)?this.load(B.initSegment.url,{isSidxRequest:!0,type:u,level:x,levelDetails:B,id:w,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"}):(n.levelDetails=B,this._handlePlaylistLoaded(k,t,n,l))},d.prototype._handleSidxRequest=function(k,t){if(k=c.default.parseSegmentIndex(new Uint8Array(k.data))){var n=t.levelDetails;k.references.forEach(function(l,v){l=l.info;v=n.fragments[v];0===v.byteRange.length&&(v.rawByteRange=String(1+l.end-l.start)+"@"+String(l.start))});n.initSegment.rawByteRange=
String(k.moovEndOffset)+"@0"}},d.prototype._handleManifestParsingError=function(k,t,n,l){this.hls.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:k.url,reason:n,networkDetails:l})},d.prototype._handleNetworkError=function(k,t,n,l){void 0===n&&(n=!1);void 0===l&&(l=null);h.logger.info("A network error occured while loading a "+k.type+"-type playlist");var v=this.getInternalLoader(k);switch(k.type){case a.MANIFEST:var w=n?r.ErrorDetails.MANIFEST_LOAD_TIMEOUT:
r.ErrorDetails.MANIFEST_LOAD_ERROR;n=!0;break;case a.LEVEL:w=n?r.ErrorDetails.LEVEL_LOAD_TIMEOUT:r.ErrorDetails.LEVEL_LOAD_ERROR;n=!1;break;case a.AUDIO_TRACK:w=n?r.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:r.ErrorDetails.AUDIO_TRACK_LOAD_ERROR;n=!1;break;default:n=!1}v&&(v.abort(),this.resetInternalLoader(k.type));k={type:r.ErrorTypes.NETWORK_ERROR,details:w,fatal:n,url:v.url,loader:v,context:k,networkDetails:t};l&&(k.response=l);this.hls.trigger(g.default.ERROR,k)},d.prototype._handlePlaylistLoaded=
function(k,t,n,l){var v=n.type,w=n.level,x=n.id,u=n.levelDetails;if(u.targetduration)if(d.canHaveQualityLevels(n.type))this.hls.trigger(g.default.LEVEL_LOADED,{details:u,level:w||0,id:x||0,stats:t,networkDetails:l});else switch(v){case a.AUDIO_TRACK:this.hls.trigger(g.default.AUDIO_TRACK_LOADED,{details:u,id:x,stats:t,networkDetails:l});break;case a.SUBTITLE_TRACK:this.hls.trigger(g.default.SUBTITLE_TRACK_LOADED,{details:u,id:x,stats:t,networkDetails:l})}else this._handleManifestParsingError(k,n,
"invalid target duration",l)},d}(p.default);C.default=p}).call(this,z(2).Number)},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(0),q=z(1),g=Math.pow(2,32)-1;F=function(){function p(r,h){this.observer=r;this.remuxer=h}return p.prototype.resetTimeStamp=function(r){this.initPTS=r},p.prototype.resetInitSegment=function(r,h,c,b){if(r&&r.byteLength){var f=this.initData=p.parseInitSegment(r);null==h&&(h="mp4a.40.5");null==c&&(c="avc1.42e01e");var a={};f.audio&&f.video?a.audiovideo=
{container:"video/mp4",codec:h+","+c,initSegment:b?r:null}:(f.audio&&(a.audio={container:"audio/mp4",codec:h,initSegment:b?r:null}),f.video&&(a.video={container:"video/mp4",codec:c,initSegment:b?r:null}));this.observer.trigger(q.default.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else h&&(this.audioCodec=h),c&&(this.videoCodec=c)},p.probe=function(r){return 0<p.findBox({data:r,start:0,end:Math.min(r.length,16384)},["moof"]).length},p.bin2str=function(r){return String.fromCharCode.apply(null,r)},p.readUint16=
function(r,h){r.data&&(h+=r.start,r=r.data);r=r[h]<<8|r[h+1];return 0>r?65536+r:r},p.readUint32=function(r,h){r.data&&(h+=r.start,r=r.data);r=r[h]<<24|r[h+1]<<16|r[h+2]<<8|r[h+3];return 0>r?4294967296+r:r},p.writeUint32=function(r,h,c){r.data&&(h+=r.start,r=r.data);r[h]=c>>24;r[h+1]=c>>16&255;r[h+2]=c>>8&255;r[h+3]=255&c},p.findBox=function(r,h){var c,b,f,a=[];if(r.data?(c=r.start,b=r.end,r=r.data):(c=0,b=r.byteLength),!h.length)return null;for(;c<b;){var e=p.readUint32(r,c);var m=p.bin2str(r.subarray(c+
4,c+8));e=1<e?c+e:b;m===h[0]&&(1===h.length?a.push({data:r,start:c+8,end:e}):(f=p.findBox({data:r,start:c+8,end:e},h.slice(1))).length&&(a=a.concat(f)));c=e}return a},p.parseSegmentIndex=function(r){var h=p.findBox(r,["moov"])[0];h=h?h.end:null;var c=p.findBox(r,["sidx"]);if(!c||!c[0])return null;r=[];var b=(c=c[0]).data[0];var f=0===b?8:16;var a=p.readUint32(c,f);f=f+4+(0===b?8:16)+2;var e=c.end+0,m=p.readUint16(c,f);f+=2;for(var d=0;d<m;d++){var k=p.readUint32(c,f);f+=4;var t=2147483647&k;if(1===
(2147483648&k)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");k=p.readUint32(c,f);f+=4;r.push({referenceSize:t,subsegmentDuration:k,info:{duration:k/a,start:e,end:e+t-1}});e+=t;f+=4}return{earliestPresentationTime:0,timescale:a,version:b,referencesCount:m,references:r,moovEndOffset:h}},p.parseInitSegment=function(r){var h=[];return p.findBox(r,["moov","trak"]).forEach(function(c){var b=p.findBox(c,["tkhd"])[0];if(b){b=p.readUint32(b,0===b.data[b.start]?12:20);var f=
p.findBox(c,["mdia","mdhd"])[0];if(f){var a=0===f.data[f.start]?12:20;a=p.readUint32(f,a);if(f=p.findBox(c,["mdia","hdlr"])[0])if(f={soun:"audio",vide:"video"}[p.bin2str(f.data.subarray(f.start+8,f.start+12))])c=p.findBox(c,["mdia","minf","stbl","stsd"]),c.length&&(c=c[0],c=p.bin2str(c.data.subarray(c.start+12,c.start+16)),A.logger.log("MP4Demuxer:"+f+":"+c+" found")),h[b]={timescale:a,type:f},h[f]={timescale:a,id:b}}}}),h},p.getStartDTS=function(r,h){var c,b,f;return c=p.findBox(h,["moof","traf"]),
b=[].concat.apply([],c.map(function(a){return p.findBox(a,["tfhd"]).map(function(e){var m,d;return m=p.readUint32(e,4),d=r[m].timescale||9E4,p.findBox(a,["tfdt"]).map(function(k){var t,n;return t=k.data[k.start],n=p.readUint32(k,4),1===t&&(n*=Math.pow(2,32),n+=p.readUint32(k,8)),n})[0]/d})})),f=Math.min.apply(null,b),isFinite(f)?f:0},p.offsetStartDTS=function(r,h,c){p.findBox(h,["moof","traf"]).map(function(b){return p.findBox(b,["tfhd"]).map(function(f){f=p.readUint32(f,4);var a=r[f].timescale||
9E4;p.findBox(b,["tfdt"]).map(function(e){var m=e.data[e.start],d=p.readUint32(e,4);0===m?p.writeUint32(e,4,d-c*a):(d*=Math.pow(2,32),d+=p.readUint32(e,8),d-=c*a,d=Math.max(d,0),m=Math.floor(d%(g+1)),p.writeUint32(e,4,Math.floor(d/(g+1))),p.writeUint32(e,8,m))})})})},p.prototype.append=function(r,h,c,b){var f=this.initData;f||(this.resetInitSegment(r,this.audioCodec,this.videoCodec,!1),f=this.initData);var a=this.initPTS;void 0===a&&(this.initPTS=a=p.getStartDTS(f,r)-h,this.observer.trigger(q.default.INIT_PTS_FOUND,
{initPTS:a}));p.offsetStartDTS(f,r,a);h=p.getStartDTS(f,r);this.remuxer.remux(f.audio,f.video,null,null,h,c,b,r)},p.prototype.destroy=function(){},p}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(9);F=function(){function q(){this._uri=this.iv=this.key=this.method=null}return Object.defineProperty(q.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=A.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,
configurable:!0}),q}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,
mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};C.isCodecType=function(q,g){g=A[g];return!!g&&!0===g[q.slice(0,4)]};C.isCodecSupportedInMp4=function(q,g){return window.MediaSource.isTypeSupported((g||"video")+'/mp4;codecs="'+q+'"')}},function(F,C,z){(function(A){Object.defineProperty(C,"__esModule",{value:!0});var q=z(38),g=z(1),p=z(21),r=z(0),h=z(3),c=z(14),b=z(6),f=z(24),a=b.getSelfScope(),e=c.getMediaSource();c=function(){function m(d,k){var t=this;this.hls=
d;this.id=k;var n=this.observer=new f.Observer,l=d.config,v=function(u,y){(y=y||{}).frag=t.frag;y.id=t.id;d.trigger(u,y)};n.on(g.default.FRAG_DECRYPTED,v);n.on(g.default.FRAG_PARSING_INIT_SEGMENT,v);n.on(g.default.FRAG_PARSING_DATA,v);n.on(g.default.FRAG_PARSED,v);n.on(g.default.ERROR,v);n.on(g.default.FRAG_PARSING_METADATA,v);n.on(g.default.FRAG_PARSING_USERDATA,v);n.on(g.default.INIT_PTS_FOUND,v);v={mp4:e.isTypeSupported("video/mp4"),mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"')};
var w=navigator.vendor;if(l.enableWorker&&"undefined"!=typeof Worker){r.logger.log("demuxing in webworker");var x=void 0;try{x=this.w=q(52),this.onwmsg=this.onWorkerMessage.bind(this),x.addEventListener("message",this.onwmsg),x.onerror=function(u){d.trigger(g.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:u.message+" ("+u.filename+":"+u.lineno+")"}})},x.postMessage({cmd:"init",typeSupported:v,vendor:w,id:k,config:JSON.stringify(l)})}catch(u){r.logger.warn("Error in worker:",
u),r.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),x&&a.URL.revokeObjectURL(x.objectURL),this.demuxer=new p.default(n,v,l,w),this.w=void 0}}else this.demuxer=new p.default(n,v,l,w)}return m.prototype.destroy=function(){var d=this.w;d?(d.removeEventListener("message",this.onwmsg),d.terminate(),this.w=null):(d=this.demuxer)&&(d.destroy(),this.demuxer=null);(d=this.observer)&&(d.removeAllListeners(),this.observer=null)},m.prototype.push=function(d,k,t,n,l,v,w,x){var u=
this.w,y=A.isFinite(l.startPTS)?l.startPTS:l.start,B=l.decryptdata,E=this.frag,G=!(E&&l.cc===E.cc),D=!(E&&l.level===E.level);E=E&&l.sn===E.sn+1;E=!D&&E;(G&&r.logger.log(this.id+":discontinuity detected"),D&&r.logger.log(this.id+":switch detected"),this.frag=l,u)?u.postMessage({cmd:"demux",data:d,decryptdata:B,initSegment:k,audioCodec:t,videoCodec:n,timeOffset:y,discontinuity:G,trackSwitch:D,contiguous:E,duration:v,accurateTimeOffset:w,defaultInitPTS:x},d instanceof ArrayBuffer?[d]:[]):(l=this.demuxer)&&
l.push(d,B,k,t,n,y,G,D,E,v,w,x)},m.prototype.onWorkerMessage=function(d){d=d.data;var k=this.hls;switch(d.event){case "init":a.URL.revokeObjectURL(this.w.objectURL);break;case g.default.FRAG_PARSING_DATA:d.data.data1=new Uint8Array(d.data1),d.data2&&(d.data.data2=new Uint8Array(d.data2));default:d.data=d.data||{},d.data.frag=this.frag,d.data.id=this.id,k.trigger(d.event,d.data)}},m}();C.default=c}).call(this,z(2).Number)},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(1),
q=z(3),g=z(13),p=z(42),r=z(17),h=z(43),c=z(46),b=z(47),f=z(50);F=z(6);z=z(0);F=F.getSelfScope();try{var a=F.performance.now.bind(F.performance)}catch(e){z.logger.debug("Unable to use Performance API on this environment"),a=F.Date.now}z=function(){function e(m,d,k,t){this.observer=m;this.typeSupported=d;this.config=k;this.vendor=t}return e.prototype.destroy=function(){var m=this.demuxer;m&&m.destroy()},e.prototype.push=function(m,d,k,t,n,l,v,w,x,u,y,B){var E=this;if(0<m.byteLength&&null!=d&&null!=
d.key&&"AES-128"===d.method){var G=this.decrypter;null==G&&(G=this.decrypter=new g.default(this.observer,this.config));var D=a();G.decrypt(m,d.key.buffer,d.iv.buffer,function(I){var J=a();E.observer.trigger(A.default.FRAG_DECRYPTED,{stats:{tstart:D,tdecrypt:J}});E.pushDecrypted(new Uint8Array(I),d,new Uint8Array(k),t,n,l,v,w,x,u,y,B)})}else this.pushDecrypted(new Uint8Array(m),d,new Uint8Array(k),t,n,l,v,w,x,u,y,B)},e.prototype.pushDecrypted=function(m,d,k,t,n,l,v,w,x,u,y,B){var E=this.demuxer;if(!E||
(v||w)&&!this.probe(m)){for(var G=this.observer,D=this.typeSupported,I=this.config,J=[{demux:h.default,remux:b.default},{demux:r.default,remux:f.default},{demux:p.default,remux:b.default},{demux:c.default,remux:b.default}],K=0,H=J.length;K<H;K++){var M=J[K],L=M.demux.probe;if(L(m)){E=this.remuxer=new M.remux(G,I,D,this.vendor);E=new M.demux(G,E,I,D);this.probe=L;break}}if(!E)return void G.trigger(A.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});
this.demuxer=E}G=this.remuxer;(v||w)&&(E.resetInitSegment(k,t,n,u),G.resetInitSegment());v&&(E.resetTimeStamp(B),G.resetTimeStamp(B));"function"==typeof E.setDecryptData&&E.setDecryptData(d);E.append(m,l,x,y)},e}();C.default=z},function(F,C,z){function A(f,a,e,m){var d,k,t,n,l,v=navigator.userAgent.toLowerCase(),w=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];if(d=1+((192&a[e+2])>>>6),!((k=(60&a[e+2])>>>2)>w.length-1))return n=(1&a[e+2])<<2,n|=(192&a[e+3])>>>6,h.logger.log("manifest codec:"+
m+",ADTS data:type:"+d+",sampleingIndex:"+k+"["+w[k]+"Hz],channelConfig:"+n),/firefox/i.test(v)?6<=k?(d=5,l=Array(4),t=k-3):(d=2,l=Array(2),t=k):-1!==v.indexOf("android")?(d=2,l=Array(2),t=k):(d=5,l=Array(4),m&&(-1!==m.indexOf("mp4a.40.29")||-1!==m.indexOf("mp4a.40.5"))||!m&&6<=k?t=k-3:((m&&-1!==m.indexOf("mp4a.40.2")&&(6<=k&&1===n||/vivaldi/i.test(v))||!m&&1===n)&&(d=2,l=Array(2)),t=k)),l[0]=d<<3,l[0]|=(14&k)>>1,l[1]|=(1&k)<<7,l[1]|=n<<3,5===d&&(l[1]|=(14&t)>>1,l[2]=(1&t)<<7,l[2]|=8,l[3]=0),{config:l,
samplerate:w[k],channelCount:n,codec:"mp4a.40."+d,manifestCodec:m};f.trigger(b.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+k})}function q(f,a){return 255===f[a]&&240==(246&f[a+1])}function g(f,a){return 1&f[a+1]?7:9}function p(f,a){return(3&f[a+3])<<11|f[a+4]<<3|(224&f[a+5])>>>5}function r(f,a,e,m,d){var k,t,n=f.length;if(k=g(f,a),t=p(f,a),0<(t-=k)&&a+k+t<=n)return{headerLength:k,frameLength:t,stamp:e+m*d}}Object.defineProperty(C,
"__esModule",{value:!0});var h=z(0),c=z(3),b=z(1);C.getAudioConfig=A;C.isHeaderPattern=q;C.getHeaderLength=g;C.getFullFrameLength=p;C.isHeader=function(f,a){return!!(a+1<f.length&&q(f,a))};C.probe=function(f,a){if(a+1<f.length&&q(f,a)){var e=g(f,a);a+5<f.length&&(e=p(f,a));a+=e;if(a===f.length||a+1<f.length&&q(f,a))return!0}return!1};C.initTrackConfig=function(f,a,e,m,d){f.samplerate||(a=A(a,e,m,d),f.config=a.config,f.samplerate=a.samplerate,f.channelCount=a.channelCount,f.codec=a.codec,f.manifestCodec=
a.manifestCodec,h.logger.log("parsed codec:"+f.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount))};C.getFrameDuration=function(f){return 9216E4/f};C.parseFrameHeader=r;C.appendFrame=function(f,a,e,m,d){var k=r(a,e,m,d,9216E4/f.samplerate);if(k)return d=k.stamp,m=k.headerLength,k=k.frameLength,a={unit:a.subarray(e+m,e+m+k),pts:d,dts:d},f.samples.push(a),f.len+=k,{sample:a,length:k+m}}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A={BitratesMap:[32,64,96,128,160,192,
224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48E3,32E3,22050,24E3,16E3,11025,12E3,8E3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(q,g,p,r,h){if(!(p+24>g.length)){var c=this.parseHeader(g,p);if(c&&p+c.frameLength<=g.length)return r+=
9E4*c.samplesPerFrame/c.sampleRate*h,g={unit:g.subarray(p,p+c.frameLength),pts:r,dts:r},q.config=[],q.channelCount=c.channelCount,q.samplerate=c.sampleRate,q.samples.push(g),q.len+=c.frameLength,{sample:g,length:c.frameLength}}},parseHeader:function(q,g){var p=q[g+1]>>3&3,r=q[g+1]>>1&3,h=q[g+2]>>4&15,c=q[g+2]>>2&3,b=q[g+2]>>1&1;if(1!==p&&0!==h&&15!==h&&3!==c){c=A.SamplingRateMap[3*(3===p?0:2===p?1:2)+c];var f=A.SamplesCoefficients[p][r],a=A.BytesInSlot[r],e=8*f*a;return{sampleRate:c,channelCount:3==
q[g+3]>>6?1:2,frameLength:parseInt(1E3*f*A.BitratesMap[14*(3===p?3-r:3===r?3:4)+h-1]/c+b,10)*a,samplesPerFrame:e}}},isHeaderPattern:function(q,g){return 255===q[g]&&224==(224&q[g+1])&&0!=(6&q[g+1])},isHeader:function(q,g){return!!(g+1<q.length&&this.isHeaderPattern(q,g))},probe:function(q,g){if(g+1<q.length&&this.isHeaderPattern(q,g)){var p=this.parseHeader(q,g),r=4;p&&p.frameLength&&(r=p.frameLength);g+=r;if(g===q.length||g+1<q.length&&this.isHeaderPattern(q,g))return!0}return!1}};C.default=A},function(F,
C,z){var A=this&&this.__extends||function(){var q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var r in p)p.hasOwnProperty(r)&&(g[r]=p[r])};return function(g,p){function r(){this.constructor=g}q(g,p);g.prototype=null===p?Object.create(p):(r.prototype=p.prototype,new r)}}();Object.defineProperty(C,"__esModule",{value:!0});F=function(q){function g(){return null!==q&&q.apply(this,arguments)||this}return A(g,q),g.prototype.trigger=function(p){for(var r=
[],h=1;h<arguments.length;h++)r[h-1]=arguments[h];this.emit.apply(this,[p,p].concat(r))},g}(z(51).EventEmitter);C.Observer=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});C.default={toString:function(A){for(var q="",g=A.length,p=0;p<g;p++)q+="["+A.start(p).toFixed(3)+","+A.end(p).toFixed(3)+"]";return q}}},function(F,C,z){(function(A){function q(a,e){for(var m=null,d=0;d<a.length;d+=1){var k=a[d];if(k&&k.cc===e){m=k;break}}return m}function g(a,e,m){var d=!1;return e&&e.details&&
m&&(m.endCC>m.startCC||a&&a.cc<m.startCC)&&(d=!0),d}function p(a,e){a=a.fragments;e=e.fragments;if(e.length&&a.length){if((e=q(a,e[0].cc))&&(!e||e.startPTS))return e;f.logger.log("No frag in previous level to align on")}else f.logger.log("No fragments to align")}function r(a,e){e.fragments.forEach(function(m){if(m){var d=m.start+a;m.start=m.startPTS=d;m.endPTS=d+m.duration}});e.PTSKnown=!0}function h(a,e,m){g(a,m,e)&&(a=p(m.details,e))&&(f.logger.log("Adjusting PTS using last level due to CC increase within current level"),
r(a.start,e))}function c(a,e){e&&e.fragments.length&&a.hasProgramDateTime&&e.hasProgramDateTime&&(e=(a.fragments[0].programDateTime-e.fragments[0].programDateTime)/1E3+e.fragments[0].start,A.isFinite(e)&&(f.logger.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),r(e,a)))}Object.defineProperty(C,"__esModule",{value:!0});var b=z(10),f=z(0);C.findFirstFragWithCC=q;C.findFragWithCC=function(a,e){return b.default.search(a,function(m){return m.cc<e?1:m.cc>e?-1:0})};C.shouldAlignOnDiscontinuities=
g;C.findDiscontinuousReferenceFrag=p;C.adjustPts=r;C.alignStream=function(a,e,m){h(a,m,e);!m.PTSKnown&&e&&c(m,e.details)};C.alignDiscontinuities=h;C.alignPDT=c}).call(this,z(2).Number)},function(F,C,z){(function(A){function q(r,h,c){void 0===r&&(r=0);void 0===h&&(h=0);h=Math.min(h,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-h<=r?1:c.start-h>r&&c.start?-1:0}function g(r,h,c){return c.endProgramDateTime-1E3*Math.min(h,c.duration+(c.deltaPTS?c.deltaPTS:0))>r}Object.defineProperty(C,
"__esModule",{value:!0});var p=z(10);C.findFragmentByPDT=function(r,h,c){if(!Array.isArray(r)||!r.length||!A.isFinite(h)||h<r[0].programDateTime||h>=r[r.length-1].endProgramDateTime)return null;c=c||0;for(var b=0;b<r.length;++b){var f=r[b];if(g(h,c,f))return f}return null};C.findFragmentByPTS=function(r,h,c,b){void 0===c&&(c=0);void 0===b&&(b=0);return(r=r?h[r.sn-h[0].sn+1]:null)&&!q(c,b,r)?r:p.default.search(h,q.bind(null,c,b))};C.fragmentWithinToleranceTest=q;C.pdtWithinToleranceTest=g}).call(this,
z(2).Number)},function(F,C,z){var A=this&&this.__extends||function(){var q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var r in p)p.hasOwnProperty(r)&&(g[r]=p[r])};return function(g,p){function r(){this.constructor=g}q(g,p);g.prototype=null===p?Object.create(p):(r.prototype=p.prototype,new r)}}();Object.defineProperty(C,"__esModule",{value:!0});F=function(q){function g(p){for(var r=[],h=1;h<arguments.length;h++)r[h-1]=arguments[h];r=q.apply(this,
[p].concat(r))||this;return r._tickInterval=null,r._tickTimer=null,r._tickCallCount=0,r._boundTick=r.tick.bind(r),r}return A(g,q),g.prototype.onHandlerDestroying=function(){this.clearNextTick();this.clearInterval()},g.prototype.hasInterval=function(){return!!this._tickInterval},g.prototype.hasNextTick=function(){return!!this._tickTimer},g.prototype.setInterval=function(p){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,p),!0)},g.prototype.clearInterval=function(){return!!this._tickInterval&&
(clearInterval(this._tickInterval),this._tickInterval=null,!0)},g.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},g.prototype.tick=function(){this._tickCallCount++;1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},g.prototype.doTick=function(){},g}(z(4).default);C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",
{value:!0});C.sendAddTrackEvent=function(A,q){var g=null;try{g=new window.Event("addtrack")}catch(p){(g=document.createEvent("Event")).initEvent("addtrack",!1,!1)}g.track=A;q.dispatchEvent(g)};C.clearCurrentCues=function(A){if(A&&A.cues)for(;0<A.cues.length;)A.removeCue(A.cues[0])}},function(F,C,z){function A(){this.window=window;this.state="INITIAL";this.buffer="";this.decoder=new c;this.regionList=[]}function q(){this.values=Object.create(null)}function g(a,e,m,d){a=d?a.split(d):[a];for(var k in a)"string"==
typeof a[k]&&(d=a[k].split(m),2===d.length&&e(d[0],d[1]))}function p(a,e,m){function d(){var n=function(l){function v(w,x,u,y){return 3600*(0|w)+60*(0|x)+(0|u)+(0|y)/1E3}return(l=l.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/))?l[3]?v(l[1],l[2],l[3].replace(":",""),l[4]):59<l[1]?v(l[1],l[2],0,l[4]):v(0,l[1],l[2],l[4]):null}(a);if(null===n)throw Error("Malformed timestamp: "+t);return a=a.replace(/^[^\sa-zA-Z-]+/,""),n}function k(){a=a.replace(/^\s+/,"")}var t=a;if(k(),e.startTime=d(),k(),"--\x3e"!==a.substr(0,
3))throw Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+t);a=a.substr(3);k();e.endTime=d();k();(function(n,l){var v=new q;g(n,function(w,x){switch(w){case "region":for(var u=m.length-1;0<=u;u--)if(m[u].id===x){v.set(w,m[u].region);break}break;case "vertical":v.alt(w,x,["rl","lr"]);break;case "line":x=x.split(",");u=x[0];v.integer(w,u);v.percent(w,u)&&v.set("snapToLines",!1);v.alt(w,u,["auto"]);2===x.length&&v.alt("lineAlign",x[1],["start",f,"end"]);break;case "position":x=
x.split(",");v.percent(w,x[0]);2===x.length&&v.alt("positionAlign",x[1],["start",f,"end","line-left","line-right","auto"]);break;case "size":v.percent(w,x);break;case "align":v.alt(w,x,["start",f,"end","left","right"])}},/:/,/\s/);l.region=v.get("region",null);l.vertical=v.get("vertical","");n=v.get("line","auto");"auto"===n&&-1===b.line&&(n=-1);l.line=n;l.lineAlign=v.get("lineAlign","start");l.snapToLines=v.get("snapToLines",!0);l.size=v.get("size",100);l.align=v.get("align",f);n=v.get("position",
"auto");"auto"===n&&50===b.position&&(n="start"===l.align||"left"===l.align?0:"end"===l.align||"right"===l.align?100:50);l.position=n})(a,e)}function r(a){return a.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(C,"__esModule",{value:!0});var h=z(69),c=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};q.prototype={set:function(a,e){this.get(a)||""===e||(this.values[a]=e)},
get:function(a,e,m){return m?this.has(a)?this.values[a]:e[m]:this.has(a)?this.values[a]:e},has:function(a){return a in this.values},alt:function(a,e,m){for(var d=0;d<m.length;++d)if(e===m[d]){this.set(a,e);break}},integer:function(a,e){/^-?\d+$/.test(e)&&this.set(a,parseInt(e,10))},percent:function(a,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(e=parseFloat(e))&&100>=e)&&(this.set(a,e),!0)}};var b=new h.default(0,0,0),f="middle"===b.align?"middle":"center";C.fixLineBreaks=r;A.prototype={parse:function(a){function e(){var n=
d.buffer,l=0;for(n=r(n);l<n.length&&"\r"!==n[l]&&"\n"!==n[l];)++l;var v=n.substr(0,l);return"\r"===n[l]&&++l,"\n"===n[l]&&++l,d.buffer=n.substr(l),v}function m(n){g(n,function(l,v){l},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{a=void 0;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;var k=(a=e()).match(/^(\u00ef\u00bb\u00bf)?WEBVTT([ \t].*)?$/);if(!k||!k[0])throw Error("Malformed WebVTT signature.");d.state="HEADER"}for(k=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;
switch(k?k=!1:a=e(),d.state){case "HEADER":/:/.test(a)?m(a):a||(d.state="ID");continue;case "NOTE":a||(d.state="ID");continue;case "ID":if(/^NOTE($|[ \t])/.test(a)){d.state="NOTE";break}if(!a)continue;if(d.cue=new h.default(0,0,""),d.state="CUE",-1===a.indexOf("--\x3e")){d.cue.id=a;continue}case "CUE":try{p(a,d.cue,d.regionList)}catch(n){d.cue=null;d.state="BADCUE";continue}d.state="CUETEXT";continue;case "CUETEXT":var t=-1!==a.indexOf("--\x3e");if(!a||t&&(k=!0)){d.oncue&&d.oncue(d.cue);d.cue=null;
d.state="ID";continue}d.cue.text&&(d.cue.text+="\n");d.cue.text+=a;continue;case "BADCUE":a||(d.state="ID")}}}catch(n){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw Error("Malformed WebVTT signature.");}catch(a){throw a;}return this.onflush&&this.onflush(),this}};
C.default=A},function(F,C,z){var A=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,l){n.__proto__=l}||function(n,l){for(var v in l)l.hasOwnProperty(v)&&(n[v]=l[v])};return function(n,l){function v(){this.constructor=n}t(n,l);n.prototype=null===l?Object.create(l):(v.prototype=l.prototype,new v)}}();Object.defineProperty(C,"__esModule",{value:!0});var q=z(9),g=z(3),p=z(16),r=z(35),h=z(36),c=z(7),b=z(37),f=z(55),a=z(56),e=z(57),m=z(0),d=z(58),
k=z(1);F=function(t){function n(l){void 0===l&&(l={});var v=t.call(this)||this,w=n.DefaultConfig;if((l.liveSyncDurationCount||l.liveMaxLatencyDurationCount)&&(l.liveSyncDuration||l.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var x in w)x in l||(l[x]=w[x]);if(void 0!==l.liveMaxLatencyDurationCount&&l.liveMaxLatencyDurationCount<=l.liveSyncDurationCount)throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');
if(void 0!==l.liveMaxLatencyDuration&&(l.liveMaxLatencyDuration<=l.liveSyncDuration||void 0===l.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');m.enableLogs(l.debug);v.config=l;v._autoLevelCapping=-1;var u=v.abrController=new l.abrController(v),y=new l.bufferController(v),B=new l.capLevelController(v),E=new l.fpsController(v),G=new p.default(v),D=new r.default(v),I=new h.default(v),J=new a.default(v);x=v.levelController=new f.default(v);
w=new c.FragmentTracker(v);x=[x,v.streamController=new b.default(v,w)];var K=l.audioStreamController;K&&x.push(new K(v,w));v.networkControllers=x;u=[G,D,I,u,y,B,E,J,w];if(K=l.audioTrackController)K=new K(v),v.audioTrackController=K,u.push(K);if(K=l.subtitleTrackController)K=new K(v),v.subtitleTrackController=K,x.push(K);if(K=l.emeController)y=new K(v),v.emeController=y,u.push(y);return(K=l.subtitleStreamController)&&x.push(new K(v,w)),(K=l.timelineController)&&u.push(new K(v)),v.coreComponents=u,
v}return A(n,t),Object.defineProperty(n,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),n.isSupported=function(){return e.isSupported()},Object.defineProperty(n,"Events",{get:function(){return k.default},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ErrorTypes",{get:function(){return g.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ErrorDetails",{get:function(){return g.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(n,
"DefaultConfig",{get:function(){return n.defaultConfig?n.defaultConfig:d.hlsDefaultConfig},set:function(l){n.defaultConfig=l},enumerable:!0,configurable:!0}),n.prototype.destroy=function(){m.logger.log("destroy");this.trigger(k.default.DESTROYING);this.detachMedia();this.coreComponents.concat(this.networkControllers).forEach(function(l){l.destroy()});this.url=null;this.removeAllListeners();this._autoLevelCapping=-1},n.prototype.attachMedia=function(l){m.logger.log("attachMedia");this.media=l;this.trigger(k.default.MEDIA_ATTACHING,
{media:l})},n.prototype.detachMedia=function(){m.logger.log("detachMedia");this.trigger(k.default.MEDIA_DETACHING);this.media=null},n.prototype.loadSource=function(l){l=q.buildAbsoluteURL(window.location.href,l,{alwaysNormalize:!0});m.logger.log("loadSource:"+l);this.url=l;this.trigger(k.default.MANIFEST_LOADING,{url:l})},n.prototype.startLoad=function(l){void 0===l&&(l=-1);m.logger.log("startLoad("+l+")");this.networkControllers.forEach(function(v){v.startLoad(l)})},n.prototype.stopLoad=function(){m.logger.log("stopLoad");
this.networkControllers.forEach(function(l){l.stopLoad()})},n.prototype.swapAudioCodec=function(){m.logger.log("swapAudioCodec");this.streamController.swapAudioCodec()},n.prototype.recoverMediaError=function(){m.logger.log("recoverMediaError");var l=this.media;this.detachMedia();this.attachMedia(l)},Object.defineProperty(n.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},
set:function(l){m.logger.log("set currentLevel:"+l);this.loadLevel=l;this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(l){m.logger.log("set nextLevel:"+l);this.levelController.manualLevel=l;this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loadLevel",{get:function(){return this.levelController.level},
set:function(l){m.logger.log("set loadLevel:"+l);this.levelController.manualLevel=l},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(l){this.levelController.nextLoadLevel=l},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(l){m.logger.log("set firstLevel:"+l);this.levelController.firstLevel=
l},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(l){m.logger.log("set startLevel:"+l);-1!==l&&(l=Math.max(l,this.minAutoLevel));this.levelController.startLevel=l},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(l){m.logger.log("set autoLevelCapping:"+l);this._autoLevelCapping=l},enumerable:!0,configurable:!0}),
Object.defineProperty(n.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"minAutoLevel",{get:function(){for(var l=this.levels,v=this.config.minAutoBitrate,w=l?l.length:0,x=0;x<w;x++)if((l[x].realBitrate?Math.max(l[x].realBitrate,l[x].bitrate):l[x].bitrate)>
v)return x;return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxAutoLevel",{get:function(){var l=this.levels,v=this.autoLevelCapping;return-1===v&&l&&l.length?l.length-1:v},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextAutoLevel",{get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(l){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,l)},enumerable:!0,configurable:!0}),
Object.defineProperty(n.prototype,"audioTracks",{get:function(){var l=this.audioTrackController;return l?l.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"audioTrack",{get:function(){var l=this.audioTrackController;return l?l.audioTrack:-1},set:function(l){var v=this.audioTrackController;v&&(v.audioTrack=l)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,
configurable:!0}),Object.defineProperty(n.prototype,"subtitleTracks",{get:function(){var l=this.subtitleTrackController;return l?l.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"subtitleTrack",{get:function(){var l=this.subtitleTrackController;return l?l.subtitleTrack:-1},set:function(l){var v=this.subtitleTrackController;v&&(v.subtitleTrack=l)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"subtitleDisplay",{get:function(){var l=this.subtitleTrackController;
return!!l&&l.subtitleDisplay},set:function(l){var v=this.subtitleTrackController;v&&(v.subtitleDisplay=l)},enumerable:!0,configurable:!0}),n}(z(24).Observer);C.default=F},function(F,C,z){(function(A){function q(n,l){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):l&&l.programDateTime&&(n.programDateTime=l.endProgramDateTime);A.isFinite(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}Object.defineProperty(C,"__esModule",{value:!0});var g=z(9),p=z(12),
r=z(33),h=z(18),c=z(34),b=z(0),f=z(19),a=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,e=/#EXT-X-MEDIA:(.*)/g,m=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),d=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,
k=/\.(mp4|m4s|m4v|m4a)$/i,t=function(){function n(){}return n.findGroup=function(l,v){if(!l)return null;for(var w=null,x=0;x<l.length;x++){var u=l[x];u.id===v&&(w=u)}return w},n.convertAVC1ToAVCOTI=function(l){var v,w=l.split(".");return 2<w.length?(v=w.shift()+".",v+=parseInt(w.shift()).toString(16),v+=("000"+parseInt(w.shift()).toString(16)).substr(-4)):v=l,v},n.resolve=function(l,v){return g.buildAbsoluteURL(v,l,{alwaysNormalize:!0})},n.parseMasterPlaylist=function(l,v){function w(E,G){["video",
"audio"].forEach(function(D){var I=E.filter(function(K){return f.isCodecType(K,D)});if(I.length){var J=I.filter(function(K){return 0===K.lastIndexOf("avc1",0)||0===K.lastIndexOf("mp4a",0)});G[D+"Codec"]=0<J.length?J[0]:I[0];E=E.filter(function(K){return-1===I.indexOf(K)})}});G.unknownCodecs=E}var x,u=[];for(a.lastIndex=0;null!=(x=a.exec(l));){var y={},B=y.attrs=new c.default(x[1]);y.url=n.resolve(x[2],v);(x=B.decimalResolution("RESOLUTION"))&&(y.width=x.width,y.height=x.height);y.bitrate=B.decimalInteger("AVERAGE-BANDWIDTH")||
B.decimalInteger("BANDWIDTH");y.name=B.NAME;w([].concat((B.CODECS||"").split(/[ ,]+/)),y);y.videoCodec&&-1!==y.videoCodec.indexOf("avc1")&&(y.videoCodec=n.convertAVC1ToAVCOTI(y.videoCodec));u.push(y)}return u},n.parseMasterPlaylistMedia=function(l,v,w,x){var u;void 0===x&&(x=[]);var y=[],B=0;for(e.lastIndex=0;null!==(u=e.exec(l));){var E={};u=new c.default(u[1]);if(u.TYPE===w){if(E.groupId=u["GROUP-ID"],E.name=u.NAME,E.type=w,E.default="YES"===u.DEFAULT,E.autoselect="YES"===u.AUTOSELECT,E.forced=
"YES"===u.FORCED,u.URI&&(E.url=n.resolve(u.URI,v)),E.lang=u.LANGUAGE,E.name||(E.name=E.lang),x.length)u=n.findGroup(x,E.groupId),E.audioCodec=u?u.codec:x[0].codec;E.id=B++;y.push(E)}}return y},n.parseLevelPlaylist=function(l,v,w,x,u){var y,B,E=0,G=0,D=new r.default(v),I=new h.default,J=0,K=null,H=new p.default,M=null;for(m.lastIndex=0;null!==(y=m.exec(l));)if(B=y[1])H.duration=parseFloat(B),y=(" "+y[2]).slice(1),H.title=y||null,H.tagList.push(y?["INF",B,y]:["INF",B]);else if(y[3])A.isFinite(H.duration)&&
(B=E++,H.type=x,H.start=G,H.levelkey=I,H.sn=B,H.level=w,H.cc=J,H.urlId=u,H.baseurl=v,H.relurl=(" "+y[3]).slice(1),q(H,K),D.fragments.push(H),K=H,G+=H.duration,H=new p.default);else if(y[4])(H.rawByteRange=(" "+y[4]).slice(1),K)&&(y=K.byteRangeEndOffset)&&(H.lastByteRangeEndOffset=y);else if(y[5])H.rawProgramDateTime=(" "+y[5]).slice(1),H.tagList.push(["PROGRAM-DATE-TIME",H.rawProgramDateTime]),null===M&&(M=D.fragments.length);else{y=y[0].match(d);for(B=1;B<y.length&&void 0===y[B];B++);var L=(" "+
y[B+1]).slice(1),O=(" "+y[B+2]).slice(1);switch(y[B]){case "#":H.tagList.push(O?[L,O]:[L]);break;case "PLAYLIST-TYPE":D.type=L.toUpperCase();break;case "MEDIA-SEQUENCE":E=D.startSN=parseInt(L);break;case "TARGETDURATION":D.targetduration=parseFloat(L);break;case "VERSION":D.version=parseInt(L);break;case "EXTM3U":break;case "ENDLIST":D.live=!1;break;case "DIS":J++;H.tagList.push(["DIS"]);break;case "DISCONTINUITY-SEQ":J=parseInt(L);break;case "KEY":L=new c.default(L);y=L.enumeratedString("METHOD");
B=L.URI;L=L.hexadecimalInteger("IV");y&&(I=new h.default,B&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(y)&&(I.method=y,I.baseuri=v,I.reluri=B,I.key=null,I.iv=L));break;case "START":y=(new c.default(L)).decimalFloatingPoint("TIME-OFFSET");A.isFinite(y)&&(D.startTimeOffset=y);break;case "MAP":y=new c.default(L);H.relurl=y.URI;H.rawByteRange=y.BYTERANGE;H.baseurl=v;H.level=w;H.type=x;H.sn="initSegment";D.initSegment=H;(H=new p.default).rawProgramDateTime=D.initSegment.rawProgramDateTime;break;
default:b.logger.warn("line parsed but not handled: "+y)}}return(H=K)&&!H.relurl&&(D.fragments.pop(),G-=H.duration),D.totalduration=G,D.averagetargetduration=G/D.fragments.length,D.endSN=E-1,D.startCC=D.fragments[0]?D.fragments[0].cc:0,D.endCC=J,!D.initSegment&&D.fragments.length&&D.fragments.every(function(N){return k.test(N.relurl)})&&(b.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(H=new p.default).relurl=D.fragments[0].relurl,
H.baseurl=v,H.level=w,H.type=x,H.sn="initSegment",D.initSegment=H,D.needSidxRanges=!0),M&&function(N,P){var R=N[P];for(--P;0<=P;P--){var Q=N[P];Q.programDateTime=R.programDateTime-1E3*Q.duration;R=Q}}(D.fragments,M),D},n}();C.default=t}).call(this,z(2).Number)},function(F,C,z){(function(A){Object.defineProperty(C,"__esModule",{value:!0});var q=function(){function g(p){this.endSN=this.endCC=0;this.fragments=[];this.initSegment=null;this.live=!0;this.needSidxRanges=!1;this.startSN=this.startCC=0;this.startTimeOffset=
null;this.totalduration=this.targetduration=0;this.type=null;this.url=p;this.version=null}return Object.defineProperty(g.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!A.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),g}();C.default=q}).call(this,z(2).Number)},function(F,C,z){(function(A){Object.defineProperty(C,"__esModule",{value:!0});var q=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:".*?")|.*?)(?:,|$)/g,p=function(){function r(h){for(var c in"string"==
typeof h&&(h=r.parseAttrList(h)),h)h.hasOwnProperty(c)&&(this[c]=h[c])}return r.prototype.decimalInteger=function(h){h=parseInt(this[h],10);return h>A.MAX_SAFE_INTEGER?1/0:h},r.prototype.hexadecimalInteger=function(h){if(this[h]){h=(this[h]||"0x").slice(2);h=(1&h.length?"0":"")+h;for(var c=new Uint8Array(h.length/2),b=0;b<h.length/2;b++)c[b]=parseInt(h.slice(2*b,2*b+2),16);return c}return null},r.prototype.hexadecimalIntegerAsNumber=function(h){h=parseInt(this[h],16);return h>A.MAX_SAFE_INTEGER?1/
0:h},r.prototype.decimalFloatingPoint=function(h){return parseFloat(this[h])},r.prototype.enumeratedString=function(h){return this[h]},r.prototype.decimalResolution=function(h){h=q.exec(this[h]);if(null!==h)return{width:parseInt(h[1],10),height:parseInt(h[2],10)}},r.parseAttrList=function(h){var c,b={};for(g.lastIndex=0;null!==(c=g.exec(h));){var f=c[2];0===f.indexOf('"')&&f.lastIndexOf('"')===f.length-1&&(f=f.slice(1,-1));b[c[1]]=f}return b},r}();C.default=p}).call(this,z(2).Number)},function(F,
C,z){(function(A){var q=this&&this.__extends||function(){var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,f){b.__proto__=f}||function(b,f){for(var a in f)f.hasOwnProperty(a)&&(b[a]=f[a])};return function(b,f){function a(){this.constructor=b}c(b,f);b.prototype=null===f?Object.create(f):(a.prototype=f.prototype,new a)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(1),p=z(4),r=z(3),h=z(0);p=function(c){function b(f){f=c.call(this,f,g.default.FRAG_LOADING)||this;return f.loaders=
{},f}return q(b,c),b.prototype.destroy=function(){var f=this.loaders,a;for(a in f){var e=f[a];e&&e.destroy()}this.loaders={};c.prototype.destroy.call(this)},b.prototype.onFragLoading=function(f){var a=f.frag,e=a.type,m=this.loaders,d=this.hls.config,k=d.fLoader,t=d.loader;a.loaded=0;(f=m[e])&&(h.logger.warn("abort previous fragment loader for type: "+e),f.abort());f=m[e]=a.loader=d.fLoader?new k(d):new t(d);e={url:a.url,frag:a,responseType:"arraybuffer",progressData:!1};m=a.byteRangeStartOffset;a=
a.byteRangeEndOffset;A.isFinite(m)&&A.isFinite(a)&&(e.rangeStart=m,e.rangeEnd=a);d={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:d.fragLoadingMaxRetryTimeout};a={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)};f.load(e,d,a)},b.prototype.loadsuccess=function(f,a,e,m){void 0===m&&(m=null);f=f.data;e=e.frag;e.loader=void 0;this.loaders[e.type]=void 0;this.hls.trigger(g.default.FRAG_LOADED,
{payload:f,frag:e,stats:a,networkDetails:m})},b.prototype.loaderror=function(f,a,e){void 0===e&&(e=null);var m=a.frag,d=m.loader;d&&d.abort();this.loaders[m.type]=void 0;this.hls.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a.frag,response:f,networkDetails:e})},b.prototype.loadtimeout=function(f,a,e){void 0===e&&(e=null);f=a.frag;var m=f.loader;m&&m.abort();this.loaders[f.type]=void 0;this.hls.trigger(g.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,
details:r.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a.frag,networkDetails:e})},b.prototype.loadprogress=function(f,a,e,m){void 0===m&&(m=null);a=a.frag;a.loaded=f.loaded;this.hls.trigger(g.default.FRAG_LOAD_PROGRESS,{frag:a,stats:f,networkDetails:m})},b}(p.default);C.default=p}).call(this,z(2).Number)},function(F,C,z){var A=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,b){c.__proto__=b}||function(c,b){for(var f in b)b.hasOwnProperty(f)&&
(c[f]=b[f])};return function(c,b){function f(){this.constructor=c}h(c,b);c.prototype=null===b?Object.create(b):(f.prototype=b.prototype,new f)}}();Object.defineProperty(C,"__esModule",{value:!0});var q=z(1),g=z(4),p=z(3),r=z(0);F=function(h){function c(b){b=h.call(this,b,q.default.KEY_LOADING)||this;return b.loaders={},b.decryptkey=null,b.decrypturl=null,b}return A(c,h),c.prototype.destroy=function(){for(var b in this.loaders){var f=this.loaders[b];f&&f.destroy()}this.loaders={};g.default.prototype.destroy.call(this)},
c.prototype.onKeyLoading=function(b){b=b.frag;var f=b.type,a=this.loaders[f],e=b.decryptdata,m=e.uri;m!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,a&&(r.logger.warn("abort previous key loader for type:"+f),a.abort()),b.loader=this.loaders[f]=new e.loader(e),this.decrypturl=m,this.decryptkey=null,f={url:m,frag:b,responseType:"arraybuffer"},a={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout},m={onSuccess:this.loadsuccess.bind(this),
onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(f,a,m)):this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(q.default.KEY_LOADED,{frag:b}))},c.prototype.loadsuccess=function(b,f,a){f=a.frag;this.decryptkey=f.decryptdata.key=new Uint8Array(b.data);f.loader=void 0;this.loaders[f.type]=void 0;this.hls.trigger(q.default.KEY_LOADED,{frag:f})},c.prototype.loaderror=function(b,f){var a=f.frag,e=a.loader;e&&e.abort();this.loaders[f.type]=void 0;this.hls.trigger(q.default.ERROR,
{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:a,response:b})},c.prototype.loadtimeout=function(b,f){b=f.frag;var a=b.loader;a&&a.abort();this.loaders[f.type]=void 0;this.hls.trigger(q.default.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:b})},c}(g.default);C.default=F},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,u){x.__proto__=
u}||function(x,u){for(var y in u)u.hasOwnProperty(y)&&(x[y]=u[y])};return function(x,u){function y(){this.constructor=x}w(x,u);x.prototype=null===u?Object.create(u):(y.prototype=u.prototype,new y)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(10),p=z(5),r=z(20),h=z(1),c=z(7),b=z(12),f=z(16),a=z(8),e=z(25),m=z(3),d=z(0),k=z(26),t=z(27),n=z(54),l=z(15),v=function(w){function x(u,y){var B=w.call(this,u,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.MANIFEST_LOADING,h.default.MANIFEST_PARSED,
h.default.LEVEL_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_LOAD_EMERGENCY_ABORTED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_SWITCHED,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED)||this;return B.fragmentTracker=y,B.config=u.config,B.audioCodecSwap=!1,B._state=l.State.STOPPED,B.stallReported=!1,B.gapController=null,B}return q(x,w),x.prototype.startLoad=
function(u){if(this.levels){var y=this.lastCurrentTime,B=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var E=B.startLevel;-1===E&&(E=0,this.bitrateTest=!0);this.level=B.nextLoadLevel=E;this.loadedmetadata=!1}0<y&&-1===u&&(d.logger.log("override startPosition with lastCurrentTime @"+y.toFixed(3)),u=y);this.state=l.State.IDLE;this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u;this.tick()}else this.forceStartLoad=!0,this.state=
l.State.STOPPED},x.prototype.stopLoad=function(){this.forceStartLoad=!1;w.prototype.stopLoad.call(this)},x.prototype.doTick=function(){switch(this.state){case l.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case l.State.IDLE:this._doTickIdle();break;case l.State.WAITING_LEVEL:var u=this.levels[this.level];u&&u.details&&(this.state=l.State.IDLE);break;case l.State.FRAG_LOADING_WAITING_RETRY:u=window.performance.now();var y=this.retryDate;(!y||u>=y||this.media&&this.media.seeking)&&(d.logger.log("mediaController: retryDate reached, switch back to IDLE state"),
this.state=l.State.IDLE)}this._checkBuffer();this._checkFragmentChanged()},x.prototype._doTickIdle=function(){var u=this.hls,y=u.config,B=this.media;if(void 0!==this.levelLastLoaded&&(B||!this.startFragRequested&&y.startFragPrefetch)){var E=this.loadedmetadata?B.currentTime:this.nextLoadPosition;var G=u.nextLoadLevel,D=this.levels[G];if(D){var I=(I=D.bitrate)?Math.max(8*y.maxBufferSize/I,y.maxBufferLength):y.maxBufferLength;I=Math.min(I,y.maxMaxBufferLength);y=p.BufferHelper.bufferInfo(this.mediaBuffer?
this.mediaBuffer:B,E,y.maxBufferHole);B=y.len;if(!(B>=I))if(d.logger.trace("buffer length of "+B.toFixed(3)+" is below max of "+I.toFixed(3)+". checking for more payload ..."),this.level=u.nextLoadLevel=G,u=D.details,!u||u.live&&this.levelLastLoaded!==G)this.state=l.State.WAITING_LEVEL;else{if(this._streamEnded(y,u))return E={},this.altAudio&&(E.type="video"),this.hls.trigger(h.default.BUFFER_EOS,E),void(this.state=l.State.ENDED);this._fetchPayloadOrEos(E,y,u)}}}},x.prototype._fetchPayloadOrEos=function(u,
y,B){var E=this.fragPrevious,G=this.level,D=B.fragments,I=D.length;if(0!==I){var J=D[0].start,K=D[I-1].start+D[I-1].duration;y=y.end;if(B.initSegment&&!B.initSegment.data)var H=B.initSegment;else if(B.live){H=this.config.initialLiveManifestSize;if(I<H)return void d.logger.warn("Can not start playback of a level, reason: not enough fragments "+I+" < "+H);if(null===(H=this._ensureFragmentAtLivePoint(B,y,J,K,E,D,I)))return}else y<J&&(H=D[0]);H||(H=this._findFragment(J,E,I,D,y,K,B));H&&(H.encrypted?(d.logger.log("Loading key for "+
H.sn+" of ["+B.startSN+" ,"+B.endSN+"],level "+G),this._loadKey(H)):(d.logger.log("Loading "+H.sn+" of ["+B.startSN+" ,"+B.endSN+"],level "+G+", currentTime:"+u.toFixed(3)+",bufferEnd:"+y.toFixed(3)),this._loadFragment(H)))}},x.prototype._ensureFragmentAtLivePoint=function(u,y,B,E,G,D,I){var J=this.hls.config,K=this.media;y<Math.max(B-J.maxFragLookUpTolerance,E-(void 0!==J.liveMaxLatencyDuration?J.liveMaxLatencyDuration:J.liveMaxLatencyDurationCount*u.targetduration))&&(B=this.liveSyncPosition=this.computeLivePosition(B,
u),d.logger.log("buffer end: "+y.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+B.toFixed(3)),y=B,K&&K.readyState&&K.duration>B&&(K.currentTime=B),this.nextLoadPosition=B);if(u.PTSKnown&&y>E&&K&&K.readyState)return null;if(this.startFragRequested&&!u.PTSKnown){if(G)if(u.hasProgramDateTime){d.logger.log("live playlist, switching playlist, load frag with same PDT: "+G.programDateTime);var H=t.findFragmentByPDT(D,G.endProgramDateTime,J.maxFragLookUpTolerance)}else y=
G.sn+1,y>=u.startSN&&y<=u.endSN&&(u=D[y-u.startSN],G.cc===u.cc&&(H=u,d.logger.log("live playlist, switching playlist, load frag with next SN: "+H.sn))),H||(H=g.default.search(D,function(M){return G.cc-M.cc}))&&d.logger.log("live playlist, switching playlist, load frag with same CC: "+H.sn);H||(H=D[Math.min(I-1,Math.round(I/2))],d.logger.log("live playlist, switching playlist, unknown, load middle frag : "+H.sn))}return H},x.prototype._findFragment=function(u,y,B,E,G,D,I){u=this.hls.config;if(B=G<
D?t.findFragmentByPTS(y,E,G,G>D-u.maxFragLookUpTolerance?0:u.maxFragLookUpTolerance):E[B-1]){G=B.sn-I.startSN;var J=y&&B.level===y.level;D=E[G-1];E=E[G+1];y&&B.sn===y.sn&&(J&&!B.backtracked?B.sn<I.endSN?(I=y.deltaPTS)&&I>u.maxBufferHole&&y.dropped&&G?(B=D,d.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(B=E,d.logger.log("SN just loaded, load next one: "+B.sn,B)):B=null:B.backtracked&&
(E&&E.backtracked?(d.logger.warn("Already backtracked from fragment "+E.sn+", will not backtrack to fragment "+B.sn+". Loading fragment "+E.sn),B=E):(d.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),B.dropped=0,D?(B=D).backtracked=!0:G&&(B=null))))}return B},x.prototype._loadKey=function(u){this.state=l.State.KEY_LOADING;this.hls.trigger(h.default.KEY_LOADING,{frag:u})},x.prototype._loadFragment=function(u){var y=this.fragmentTracker.getState(u);this.fragCurrent=
u;this.startFragRequested=!0;A.isFinite(u.sn)&&!u.bitrateTest&&(this.nextLoadPosition=u.start+u.duration);u.backtracked||y===c.FragmentState.NOT_LOADED||y===c.FragmentState.PARTIAL?(u.autoLevel=this.hls.autoLevelEnabled,u.bitrateTest=this.bitrateTest,this.hls.trigger(h.default.FRAG_LOADING,{frag:u}),this.demuxer||(this.demuxer=new r.default(this.hls,"main")),this.state=l.State.FRAG_LOADING):y===c.FragmentState.APPENDING&&this._reduceMaxBufferLength(u.duration)&&this.fragmentTracker.removeFragment(u)},
Object.defineProperty(x.prototype,"state",{get:function(){return this._state},set:function(u){if(this.state!==u){var y=this.state;this._state=u;d.logger.log("main stream:"+y+"->"+u);this.hls.trigger(h.default.STREAM_STATE_TRANSITION,{previousState:y,nextState:u})}},enumerable:!0,configurable:!0}),x.prototype.getBufferedFrag=function(u){return this.fragmentTracker.getBufferedFrag(u,f.default.LevelType.MAIN)},Object.defineProperty(x.prototype,"currentLevel",{get:function(){var u=this.media;return u&&
(u=this.getBufferedFrag(u.currentTime))?u.level:-1},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"nextBufferedFrag",{get:function(){var u=this.media;return u?this.followingBufferedFrag(this.getBufferedFrag(u.currentTime)):null},enumerable:!0,configurable:!0}),x.prototype.followingBufferedFrag=function(u){return u?this.getBufferedFrag(u.endPTS+.5):null},Object.defineProperty(x.prototype,"nextLevel",{get:function(){var u=this.nextBufferedFrag;return u?u.level:-1},enumerable:!0,
configurable:!0}),x.prototype._checkFragmentChanged=function(){var u,y,B=this.media;B&&B.readyState&&!1===B.seeking&&((y=B.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=y),p.BufferHelper.isBuffered(B,y)?u=this.getBufferedFrag(y):p.BufferHelper.isBuffered(B,y+.1)&&(u=this.getBufferedFrag(y+.1)),u)&&u!==this.fragPlaying&&(this.hls.trigger(h.default.FRAG_CHANGED,{frag:u}),y=u.level,this.fragPlaying&&this.fragPlaying.level===y||this.hls.trigger(h.default.LEVEL_SWITCHED,{level:y}),this.fragPlaying=
u)},x.prototype.immediateLevelSwitch=function(){if(d.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var u=this.media,y=void 0;u?(y=u.paused,u.pause()):y=!0;this.previouslyPaused=y}(u=this.fragCurrent)&&u.loader&&u.loader.abort();this.fragCurrent=null;this.flushMainBuffer(0,A.POSITIVE_INFINITY)},x.prototype.immediateLevelSwitchEnd=function(){var u=this.media;u&&u.buffered.length&&(this.immediateSwitch=!1,p.BufferHelper.isBuffered(u,u.currentTime)&&(u.currentTime-=
1E-4),this.previouslyPaused||u.play())},x.prototype.nextLevelSwitch=function(){var u=this.media;if(u&&u.readyState){var y,B=void 0;if((y=this.getBufferedFrag(u.currentTime))&&1<y.startPTS&&this.flushMainBuffer(0,y.startPTS-1),u.paused)y=0;else{y=this.levels[this.hls.nextLoadLevel];var E=this.fragLastKbps;y=E&&this.fragCurrent?this.fragCurrent.duration*y.bitrate/(1E3*E)+1:0}(B=this.getBufferedFrag(u.currentTime+y))&&(B=this.followingBufferedFrag(B))&&((u=this.fragCurrent)&&u.loader&&u.loader.abort(),
this.fragCurrent=null,this.flushMainBuffer(B.maxStartPTS,A.POSITIVE_INFINITY))}},x.prototype.flushMainBuffer=function(u,y){this.state=l.State.BUFFER_FLUSHING;u={startOffset:u,endOffset:y};this.altAudio&&(u.type="video");this.hls.trigger(h.default.BUFFER_FLUSHING,u)},x.prototype.onMediaAttached=function(u){u=this.media=this.mediaBuffer=u.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvended=this.onMediaEnded.bind(this);u.addEventListener("seeking",
this.onvseeking);u.addEventListener("seeked",this.onvseeked);u.addEventListener("ended",this.onvended);var y=this.config;this.levels&&y.autoStartLoad&&this.hls.startLoad(y.startPosition);this.gapController=new n.default(y,u,this.fragmentTracker,this.hls)},x.prototype.onMediaDetaching=function(){var u=this.media;u&&u.ended&&(d.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var y=this.levels;y&&y.forEach(function(B){B.details&&B.details.fragments.forEach(function(E){E.backtracked=
void 0})});u&&(u.removeEventListener("seeking",this.onvseeking),u.removeEventListener("seeked",this.onvseeked),u.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null);this.media=this.mediaBuffer=null;this.loadedmetadata=!1;this.stopLoad()},x.prototype.onMediaSeeked=function(){var u=this.media;u=u?u.currentTime:void 0;A.isFinite(u)&&d.logger.log("media seeked to "+u.toFixed(3));this.tick()},x.prototype.onManifestLoading=function(){d.logger.log("trigger BUFFER_RESET");
this.hls.trigger(h.default.BUFFER_RESET);this.fragmentTracker.removeAllFragments();this.stalled=!1;this.startPosition=this.lastCurrentTime=0},x.prototype.onManifestParsed=function(u){var y,B=!1,E=!1;u.levels.forEach(function(G){(y=G.audioCodec)&&(-1!==y.indexOf("mp4a.40.2")&&(B=!0),-1!==y.indexOf("mp4a.40.5")&&(E=!0))});(this.audioCodecSwitch=B&&E)&&d.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC");this.levels=u.levels;this.startFragRequested=!1;u=this.config;
(u.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(u.startPosition)},x.prototype.onLevelLoaded=function(u){var y=u.details,B=u.level,E=this.levels[this.levelLastLoaded],G=this.levels[B];u=y.totalduration;var D=0;if(d.logger.log("level "+B+" loaded ["+y.startSN+","+y.endSN+"],duration:"+u),y.live){var I=G.details;I&&0<y.fragments.length?(a.mergeDetails(I,y),D=y.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(D,I),y.PTSKnown&&A.isFinite(D)?d.logger.log("live playlist sliding:"+
D.toFixed(3)):(d.logger.log("live playlist - outdated PTS, unknown sliding"),k.alignStream(this.fragPrevious,E,y))):(d.logger.log("live playlist - first load, unknown sliding"),y.PTSKnown=!1,k.alignStream(this.fragPrevious,E,y))}else y.PTSKnown=!1;if(G.details=y,this.levelLastLoaded=B,this.hls.trigger(h.default.LEVEL_UPDATED,{details:y,level:B}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime)B=y.startTimeOffset,A.isFinite(B)?(0>B&&(d.logger.log("negative start time offset "+
B+", count from end of last fragment"),B=D+u+B),d.logger.log("start time offset found in playlist, adjust startPosition to "+B),this.startPosition=B):y.live?(this.startPosition=this.computeLivePosition(D,y),d.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition;this.nextLoadPosition=this.startPosition}this.state===l.State.WAITING_LEVEL&&(this.state=l.State.IDLE);this.tick()},x.prototype.onKeyLoaded=function(){this.state===l.State.KEY_LOADING&&
(this.state=l.State.IDLE,this.tick())},x.prototype.onFragLoaded=function(u){var y=this.fragCurrent,B=this.hls,E=this.levels,G=this.media,D=u.frag;if(this.state===l.State.FRAG_LOADING&&y&&"main"===D.type&&D.level===y.level&&D.sn===y.sn){var I=u.stats;E=E[y.level];var J=E.details;(this.bitrateTest=!1,this.stats=I,d.logger.log("Loaded "+y.sn+" of ["+J.startSN+" ,"+J.endSN+"],level "+y.level),D.bitrateTest&&B.nextLoadLevel)?(this.state=l.State.IDLE,this.startFragRequested=!1,I.tparsed=I.tbuffered=window.performance.now(),
B.trigger(h.default.FRAG_BUFFERED,{stats:I,frag:y,id:"main"}),this.tick()):"initSegment"===D.sn?(this.state=l.State.IDLE,I.tparsed=I.tbuffered=window.performance.now(),J.initSegment.data=u.payload,B.trigger(h.default.FRAG_BUFFERED,{stats:I,frag:y,id:"main"}),this.tick()):(d.logger.log("Parsing "+y.sn+" of ["+J.startSN+" ,"+J.endSN+"],level "+y.level+", cc "+y.cc),this.state=l.State.PARSING,this.pendingBuffering=!0,this.appended=!1,D.bitrateTest&&(D.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:D})),
B=!(G&&G.seeking)&&(J.PTSKnown||!J.live),G=J.initSegment?J.initSegment.data:[],D=this._getAudioCodec(E),(this.demuxer=this.demuxer||new r.default(this.hls,"main")).push(u.payload,G,D,E.videoCodec,y,J.totalduration,B))}this.fragLoadError=0},x.prototype.onFragParsingInitSegment=function(u){var y=this.fragCurrent,B=u.frag;if(y&&"main"===u.id&&B.sn===y.sn&&B.level===y.level&&this.state===l.State.PARSING){y=u.tracks;B=void 0;var E;if(y.audio&&this.altAudio&&delete y.audio,E=y.audio){var G=this.levels[this.level].audioCodec,
D=navigator.userAgent.toLowerCase();G&&this.audioCodecSwap&&(d.logger.log("swapping playlist audio codec"),G=-1!==G.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");this.audioCodecSwitch&&1!==E.metadata.channelCount&&-1===D.indexOf("firefox")&&(G="mp4a.40.5");-1!==D.indexOf("android")&&"audio/mpeg"!==E.container&&(G="mp4a.40.2",d.logger.log("Android: force audio codec to "+G));E.levelCodec=G;E.id=u.id}for(B in(E=y.video)&&(E.levelCodec=this.levels[this.level].videoCodec,E.id=u.id),this.hls.trigger(h.default.BUFFER_CODECS,
y),y)E=y[B],d.logger.log("main track:"+B+",container:"+E.container+",codecs[level/parsed]=["+E.levelCodec+"/"+E.codec+"]"),(u=E.initSegment)&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,{type:B,data:u,parent:"main",content:"initSegment"}));this.tick()}},x.prototype.onFragParsingData=function(u){var y=this,B=this.fragCurrent,E=u.frag;if(B&&"main"===u.id&&E.sn===B.sn&&E.level===B.level&&("audio"!==u.type||!this.altAudio)&&this.state===l.State.PARSING){E=this.levels[this.level];
if(A.isFinite(u.endPTS)||(u.endPTS=u.startPTS+B.duration,u.endDTS=u.startDTS+B.duration),!0===u.hasAudio&&B.addElementaryStream(b.default.ElementaryStreamTypes.AUDIO),!0===u.hasVideo&&B.addElementaryStream(b.default.ElementaryStreamTypes.VIDEO),d.logger.log("Parsed "+u.type+",PTS:["+u.startPTS.toFixed(3)+","+u.endPTS.toFixed(3)+"],DTS:["+u.startDTS.toFixed(3)+"/"+u.endDTS.toFixed(3)+"],nb:"+u.nb+",dropped:"+(u.dropped||0)),"video"===u.type)if(B.dropped=u.dropped,B.dropped)if(B.backtracked)d.logger.warn("Already backtracked on this fragment, appending with the gap",
B.sn);else{var G=E.details;if(!G||B.sn!==G.startSN)return d.logger.warn("missing video frame(s), backtracking fragment",B.sn),this.fragmentTracker.removeFragment(B),B.backtracked=!0,this.nextLoadPosition=u.startPTS,this.state=l.State.IDLE,this.fragPrevious=B,void this.tick();d.logger.warn("missing video frame(s) on first frag, appending with gap",B.sn)}else B.backtracked=!1;B=a.updateFragPTSDTS(E.details,B,u.startPTS,u.endPTS,u.startDTS,u.endDTS);var D=this.hls;D.trigger(h.default.LEVEL_PTS_UPDATED,
{details:E.details,level:this.level,drift:B,type:u.type,start:u.startPTS,end:u.endPTS});[u.data1,u.data2].forEach(function(I){I&&I.length&&y.state===l.State.PARSING&&(y.appended=!0,y.pendingBuffering=!0,D.trigger(h.default.BUFFER_APPENDING,{type:u.type,data:I,parent:"main",content:"data"}))});this.tick()}},x.prototype.onFragParsed=function(u){var y=this.fragCurrent,B=u.frag;y&&"main"===u.id&&B.sn===y.sn&&B.level===y.level&&this.state===l.State.PARSING&&(this.stats.tparsed=window.performance.now(),
this.state=l.State.PARSED,this._checkAppendedParsed())},x.prototype.onAudioTrackSwitching=function(u){var y=u.id;u.url||(this.mediaBuffer!==this.media&&(d.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,u=this.fragCurrent,u.loader&&(d.logger.log("switching to main audio track, cancel main fragment load"),u.loader.abort()),this.fragPrevious=this.fragCurrent=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=
l.State.IDLE),u=this.hls,u.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:A.POSITIVE_INFINITY,type:"audio"}),u.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:y}),this.altAudio=!1)},x.prototype.onAudioTrackSwitched=function(u){if(u=!!this.hls.audioTracks[u.id].url){var y=this.videoBuffer;y&&this.mediaBuffer!==y&&(d.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=y)}this.altAudio=u;this.tick()},x.prototype.onBufferCreated=function(u){var y,
B;u=u.tracks;var E=!1,G;for(G in u){var D=u[G];"main"===D.id?(B=G,y=D,"video"===G&&(this.videoBuffer=u[G].buffer)):E=!0}E&&y?(d.logger.log("alternate track found, use "+B+".buffered to schedule main fragment loading"),this.mediaBuffer=y.buffer):this.mediaBuffer=this.media},x.prototype.onBufferAppended=function(u){if("main"===u.parent){var y=this.state;y!==l.State.PARSING&&y!==l.State.PARSED||(this.pendingBuffering=0<u.pending,this._checkAppendedParsed())}},x.prototype._checkAppendedParsed=function(){if(!(this.state!==
l.State.PARSED||this.appended&&this.pendingBuffering)){var u=this.fragCurrent;if(u){d.logger.log("main buffered : "+e.default.toString((this.mediaBuffer?this.mediaBuffer:this.media).buffered));this.fragPrevious=u;var y=this.stats;y.tbuffered=window.performance.now();this.fragLastKbps=Math.round(8*y.total/(y.tbuffered-y.tfirst));this.hls.trigger(h.default.FRAG_BUFFERED,{stats:y,frag:u,id:"main"});this.state=l.State.IDLE}this.tick()}},x.prototype.onError=function(u){var y=u.frag||this.fragCurrent;if(!y||
"main"===y.type)switch(y=!!this.media&&p.BufferHelper.isBuffered(this.media,this.media.currentTime)&&p.BufferHelper.isBuffered(this.media,this.media.currentTime+.5),u.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:u.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(u=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),
d.logger.warn("mediaController: frag loading failed, retry in "+u+" ms"),this.retryDate=window.performance.now()+u,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=l.State.FRAG_LOADING_WAITING_RETRY):(d.logger.error("mediaController: "+u.details+" reaches max retry, redispatch as fatal ..."),u.fatal=!0,this.state=l.State.ERROR));break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==l.State.ERROR&&
(u.fatal?(this.state=l.State.ERROR,d.logger.warn("streamController: "+u.details+",switch to "+this.state+" state ...")):u.levelRetry||this.state!==l.State.WAITING_LEVEL||(this.state=l.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:"main"!==u.parent||this.state!==l.State.PARSING&&this.state!==l.State.PARSED||(y?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=l.State.IDLE):(d.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=
null,this.flushMainBuffer(0,A.POSITIVE_INFINITY)))}},x.prototype._reduceMaxBufferLength=function(u){var y=this.config;return y.maxMaxBufferLength>=u&&(y.maxMaxBufferLength/=2,d.logger.warn("main:reduce max buffer length to "+y.maxMaxBufferLength+"s"),!0)},x.prototype._checkBuffer=function(){var u=this.media;u&&0!==u.readyState&&(u=(this.mediaBuffer?this.mediaBuffer:u).buffered,!this.loadedmetadata&&u.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():
this.gapController.poll(this.lastCurrentTime,u))},x.prototype.onFragLoadEmergencyAborted=function(){this.state=l.State.IDLE;this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);this.tick()},x.prototype.onBufferFlushed=function(){var u=this.mediaBuffer?this.mediaBuffer:this.media;u&&this.fragmentTracker.detectEvictedFragments(b.default.ElementaryStreamTypes.VIDEO,u.buffered);this.state=l.State.IDLE;this.fragPrevious=null},x.prototype.swapAudioCodec=function(){this.audioCodecSwap=
!this.audioCodecSwap},x.prototype.computeLivePosition=function(u,y){return u+Math.max(0,y.totalduration-(void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*y.targetduration))},x.prototype._seekToStartPos=function(){var u=this.media,y=u.currentTime,B=u.seeking?y:this.startPosition;y!==B&&(d.logger.log("target start position not buffered, seek to buffered.start(0) "+B+" from current time "+y+" "),u.currentTime=B)},x.prototype._getAudioCodec=function(u){u=
this.config.defaultAudioCodec||u.audioCodec;return this.audioCodecSwap&&(d.logger.log("swapping playlist audio codec"),u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),u},Object.defineProperty(x.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(u){this._liveSyncPosition=u},enumerable:!0,configurable:!0}),x}(l.default);C.default=v}).call(this,z(2).Number)},function(F,C,z){function A(p){function r(b){if(h[b])return h[b].exports;var f=h[b]={i:b,l:!1,
exports:{}};return p[b].call(f.exports,f,f.exports,r),f.l=!0,f.exports}var h={};r.m=p;r.c=h;r.i=function(b){return b};r.d=function(b,f,a){r.o(b,f)||Object.defineProperty(b,f,{configurable:!1,enumerable:!0,get:a})};r.r=function(b){Object.defineProperty(b,"__esModule",{value:!0})};r.n=function(b){var f=b&&b.__esModule?function(){return b.default}:function(){return b};return r.d(f,"a",f),f};r.o=function(b,f){return Object.prototype.hasOwnProperty.call(b,f)};r.p="/";r.oe=function(b){throw console.error(b),
b;};var c=r(r.s=ENTRY_MODULE);return c.default||c}function q(p){return(p+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function g(p){return Object.keys(p).reduce(function(r,h){return r||0<p[h].length},!1)}F.exports=function(p,r){r=r||{};var h={main:z.m},c=r.all?{main:Object.keys(h.main)}:function(f,a){a={main:[a]};for(var e={main:[]},m={main:{}};g(a);)for(var d=Object.keys(a),k=0;k<d.length;k++){var t=d[k],n=a[t].pop();if(m[t]=m[t]||{},!m[t][n]&&f[t][n]){m[t][n]=!0;e[t]=e[t]||[];e[t].push(n);var l,v=
f,w=f[t][n];n=t;t={};t[n]=[];w=w.toString();if(l=w.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/)){for(var x=l[1],u=new RegExp("(\\\\n|\\W)"+q(x)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");l=u.exec(w);)"dll-reference"!==l[3]&&t[n].push(l[3]);for(u=new RegExp("\\("+q(x)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");l=u.exec(w);)v[l[2]]||(t[n].push(l[1]),v[l[2]]=z(l[1]).m),t[l[2]]=t[l[2]]||[],t[l[2]].push(l[4]);v=Object.keys(t);
for(n=0;n<v.length;n++)for(w=0;w<t[v[n]].length;w++)!isNaN(1*t[v[n]][w])&&(t[v[n]][w]*=1)}v=Object.keys(t);for(n=0;n<v.length;n++)a[v[n]]=a[v[n]]||[],a[v[n]]=a[v[n]].concat(t[v[n]])}}return e}(h,p),b="";Object.keys(c).filter(function(f){return"main"!==f}).forEach(function(f){for(var a=0;c[f][a];)a++;c[f].push(a);h[f][a]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })";b=b+"var "+f+" = ("+A.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+c[f].map(function(e){return JSON.stringify(e)+
": "+h[f][e].toString()}).join(",")+"});\n"});b=b+"new (("+A.toString().replace("ENTRY_MODULE",JSON.stringify(p))+")({"+c.main.map(function(f){return JSON.stringify(f)+": "+h.main[f].toString()}).join(",")+"}))(self);";p=new window.Blob([b],{type:"text/javascript"});if(r.bare)return p;r=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(p);p=new window.Worker(r);return p.objectURL=r,p}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=function(){function A(q,
g){this.subtle=q;this.aesIV=g}return A.prototype.decrypt=function(q,g){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},g,q)},A}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=function(){function A(q,g){this.subtle=q;this.key=g}return A.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},A}();C.default=F},function(F,C,z){function A(q){var g=q.byteLength,p=g&&(new DataView(q)).getUint8(g-
1);return p?q.slice(0,g-p):q}Object.defineProperty(C,"__esModule",{value:!0});C.removePadding=A;F=function(){function q(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54];this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)];this.sBox=new Uint32Array(256);this.invSBox=new Uint32Array(256);this.key=new Uint32Array(0);this.initTable()}return q.prototype.uint8ArrayToUint32Array_=
function(g){g=new DataView(g);for(var p=new Uint32Array(4),r=0;4>r;r++)p[r]=g.getUint32(4*r);return p},q.prototype.initTable=function(){var g=this.sBox,p=this.invSBox,r=this.subMix,h=r[0],c=r[1],b=r[2];r=r[3];var f=this.invSubMix,a=f[0],e=f[1],m=f[2];f=f[3];var d=new Uint32Array(256),k=0,t=0,n;for(n=0;256>n;n++)d[n]=128>n?n<<1:n<<1^283;for(n=0;256>n;n++){var l=t^t<<1^t<<2^t<<3^t<<4;l=l>>>8^255&l^99;g[k]=l;p[l]=k;var v=d[k],w=d[v],x=d[w],u=257*d[l]^16843008*l;h[k]=u<<24|u>>>8;c[k]=u<<16|u>>>16;b[k]=
u<<8|u>>>24;r[k]=u;u=16843009*x^65537*w^257*v^16843008*k;a[l]=u<<24|u>>>8;e[l]=u<<16|u>>>16;m[l]=u<<8|u>>>24;f[l]=u;k?(k=v^d[d[d[x^v]]],t^=d[d[t]]):k=t=1}},q.prototype.expandKey=function(g){g=this.uint8ArrayToUint32Array_(g);for(var p=!0,r=0;r<g.length&&p;)p=g[r]===this.key[r],r++;if(!p){this.key=g;var h=this.keySize=g.length;if(4!==h&&6!==h&&8!==h)throw Error("Invalid aes key size="+h);var c,b;p=this.ksRows=4*(h+6+1);r=this.keySchedule=new Uint32Array(p);var f=this.invKeySchedule=new Uint32Array(p),
a=this.sBox,e=this.rcon;var m=this.invSubMix;var d=m[0],k=m[1],t=m[2],n=m[3];for(m=0;m<p;m++)m<h?c=r[m]=g[m]:(b=c,0==m%h?(b=a[(b=b<<8|b>>>24)>>>24]<<24|a[b>>>16&255]<<16|a[b>>>8&255]<<8|a[255&b],b^=e[m/h|0]<<24):6<h&&4==m%h&&(b=a[b>>>24]<<24|a[b>>>16&255]<<16|a[b>>>8&255]<<8|a[255&b]),r[m]=c=(r[m-h]^b)>>>0);for(c=0;c<p;c++)m=p-c,b=3&c?r[m]:r[m-4],f[c]=4>c||4>=m?b:d[a[b>>>24]]^k[a[b>>>16&255]]^t[a[b>>>8&255]]^n[a[255&b]],f[c]>>>=0}},q.prototype.networkToHostOrderSwap=function(g){return g<<24|(65280&
g)<<8|(16711680&g)>>8|g>>>24},q.prototype.decrypt=function(g,p,r,h){var c,b=this.keySize+6,f=this.invKeySchedule,a=this.invSBox,e=this.invSubMix,m=e[0],d=e[1],k=e[2];e=e[3];var t=this.uint8ArrayToUint32Array_(r);r=t[0];var n=t[1],l=t[2];t=t[3];for(var v=new Int32Array(g),w=new Int32Array(v.length),x=this.networkToHostOrderSwap;p<v.length;){var u=x(v[p]);var y=x(v[p+1]);var B=x(v[p+2]);var E=x(v[p+3]);var G=u^f[0];var D=E^f[1];var I=B^f[2];var J=y^f[3];var K=4;for(c=1;c<b;c++){g=m[G>>>24]^d[D>>16&
255]^k[I>>8&255]^e[255&J]^f[K];var H=m[D>>>24]^d[I>>16&255]^k[J>>8&255]^e[255&G]^f[K+1];var M=m[I>>>24]^d[J>>16&255]^k[G>>8&255]^e[255&D]^f[K+2];J=m[J>>>24]^d[G>>16&255]^k[D>>8&255]^e[255&I]^f[K+3];G=g;D=H;I=M;K+=4}g=a[G>>>24]<<24^a[D>>16&255]<<16^a[I>>8&255]<<8^a[255&J]^f[K];H=a[D>>>24]<<24^a[I>>16&255]<<16^a[J>>8&255]<<8^a[255&G]^f[K+1];M=a[I>>>24]<<24^a[J>>16&255]<<16^a[G>>8&255]<<8^a[255&D]^f[K+2];J=a[J>>>24]<<24^a[G>>16&255]<<16^a[D>>8&255]<<8^a[255&I]^f[K+3];w[p]=x(g^r);w[p+1]=x(J^n);w[p+2]=
x(M^l);w[p+3]=x(H^t);r=u;n=y;l=B;t=E;p+=4}return h?A(w.buffer):w.buffer},q.prototype.destroy=function(){this.rcon=this.invKeySchedule=this.keySchedule=this.invSubMix=this.subMix=this.invSBox=this.sBox=this.ksRows=this.keySize=this.key=void 0},q}();C.default=F},function(F,C,z){(function(A){Object.defineProperty(C,"__esModule",{value:!0});var q=z(22),g=z(0),p=z(11),r=function(){function h(c,b,f){this.observer=c;this.config=f;this.remuxer=b}return h.prototype.resetInitSegment=function(c,b,f,a){this._audioTrack=
{container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:a,inputTimeScale:9E4}},h.prototype.resetTimeStamp=function(){},h.probe=function(c){if(!c)return!1;for(var b=(p.default.getID3Data(c,0)||[]).length,f=c.length;b<f;b++)if(q.probe(c,b))return g.logger.log("ADTS sync word found !"),!0;return!1},h.prototype.append=function(c,b,f,a){var e=this._audioTrack,m=p.default.getID3Data(c,0)||[],d=p.default.getTimeStamp(m);d=A.isFinite(d)?90*d:9E4*b;for(var k=
0,t=d,n=c.length,l=m.length,v=[{pts:t,dts:t,data:m}];l<n-1;)if(q.isHeader(c,l)&&l+5<n){q.initTrackConfig(e,this.observer,c,l,e.manifestCodec);t=q.appendFrame(e,c,l,d,k);if(!t){g.logger.log("Unable to parse AAC frame");break}l+=t.length;t=t.sample.pts;k++}else p.default.isHeader(c,l)?(m=p.default.getID3Data(c,l),v.push({pts:t,dts:t,data:m}),l+=m.length):l++;this.remuxer.remux(e,{samples:[]},{samples:v,inputTimeScale:9E4},{samples:[]},b,f,a)},h.prototype.destroy=function(){},h}();C.default=r}).call(this,
z(2).Number)},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(22),q=z(23),g=z(1),p=z(44),r=z(45),h=z(0),c=z(3),b={video:1,audio:2,id3:3,text:4};F=function(){function f(a,e,m,d){this.observer=a;this.config=m;this.typeSupported=d;this.remuxer=e;this.sampleAes=null}return f.prototype.setDecryptData=function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new r.default(this.observer,this.config,a,this.discardEPB):this.sampleAes=null},f.probe=function(a){a=f._syncOffset(a);
return!(0>a)&&(a&&h.logger.warn("MPEG2-TS detected but first sync word found @ offset "+a+", junk ahead ?"),!0)},f._syncOffset=function(a){for(var e=Math.min(1E3,a.length-564),m=0;m<e;){if(71===a[m]&&71===a[m+188]&&71===a[m+376])return m;m++}return-1},f.createTrack=function(a,e){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:b[a],pid:-1,inputTimeScale:9E4,sequenceNumber:0,samples:[],len:0,dropped:"video"===a?0:void 0,isAAC:"audio"===a||void 0,duration:"audio"===a?e:void 0}},
f.prototype.resetInitSegment=function(a,e,m,d){this.pmtParsed=!1;this._pmtId=-1;this._avcTrack=f.createTrack("video",d);this._audioTrack=f.createTrack("audio",d);this._id3Track=f.createTrack("id3",d);this._txtTrack=f.createTrack("text",d);this.avcSample=this.aacLastPTS=this.aacOverFlow=null;this.audioCodec=e;this.videoCodec=m;this._duration=d},f.prototype.resetTimeStamp=function(){},f.prototype.append=function(a,e,m,d){var k,t,n,l,v,w=a.length,x=!1;this.contiguous=m;var u=this.pmtParsed,y=this._avcTrack,
B=this._audioTrack,E=this._id3Track,G=y.pid,D=B.pid,I=E.pid,J=this._pmtId,K=y.pesData,H=B.pesData,M=E.pesData,L=this._parsePAT,O=this._parsePMT,N=this._parsePES,P=this._parseAVCPES.bind(this),R=this._parseAACPES.bind(this),Q=this._parseMPEGPES.bind(this),T=this._parseID3PES.bind(this),S=f._syncOffset(a);w-=(w+S)%188;for(k=S;k<w;k+=188)if(71===a[k]){if(t=!!(64&a[k+1]),n=((31&a[k+1])<<8)+a[k+2],1<(48&a[k+3])>>4){if((l=k+5+a[k+4])===k+188)continue}else l=k+4;switch(n){case G:t&&(K&&(v=N(K))&&void 0!==
v.pts&&P(v,!1),K={data:[],size:0});K&&(K.data.push(a.subarray(l,k+188)),K.size+=k+188-l);break;case D:t&&(H&&(v=N(H))&&void 0!==v.pts&&(B.isAAC?R(v):Q(v)),H={data:[],size:0});H&&(H.data.push(a.subarray(l,k+188)),H.size+=k+188-l);break;case I:t&&(M&&(v=N(M))&&void 0!==v.pts&&T(v),M={data:[],size:0});M&&(M.data.push(a.subarray(l,k+188)),M.size+=k+188-l);break;case 0:t&&(l+=a[l]+1);J=this._pmtId=L(a,l);break;case J:t&&(l+=a[l]+1);t=O(a,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=
this.sampleAes);0<(G=t.avc)&&(y.pid=G);0<(D=t.audio)&&(B.pid=D,B.isAAC=t.isAAC);0<(I=t.id3)&&(E.pid=I);x&&!u&&(h.logger.log("reparse from beginning"),x=!1,k=S-188);u=this.pmtParsed=!0;break;case 17:case 8191:break;default:x=!0}}else this.observer.trigger(g.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});K&&(v=N(K))&&void 0!==v.pts?(P(v,!0),y.pesData=null):y.pesData=K;H&&(v=N(H))&&void 0!==v.pts?(B.isAAC?R(v):
Q(v),B.pesData=null):(H&&H.size&&h.logger.log("last AAC PES packet truncated,might overlap between fragments"),B.pesData=H);M&&(v=N(M))&&void 0!==v.pts?(T(v),E.pesData=null):E.pesData=M;null==this.sampleAes?this.remuxer.remux(B,y,E,this._txtTrack,e,m,d):this.decryptAndRemux(B,y,E,this._txtTrack,e,m,d)},f.prototype.decryptAndRemux=function(a,e,m,d,k,t,n){if(a.samples&&a.isAAC){var l=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){l.decryptAndRemuxAvc(a,e,m,d,k,t,n)})}else this.decryptAndRemuxAvc(a,
e,m,d,k,t,n)},f.prototype.decryptAndRemuxAvc=function(a,e,m,d,k,t,n){if(e.samples){var l=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){l.remuxer.remux(a,e,m,d,k,t,n)})}else this.remuxer.remux(a,e,m,d,k,t,n)},f.prototype.destroy=function(){this._initPTS=this._initDTS=void 0;this._duration=0},f.prototype._parsePAT=function(a,e){return(31&a[e+10])<<8|a[e+11]},f.prototype._parsePMT=function(a,e,m,d){var k,t={audio:-1,avc:-1,id3:-1,isAAC:!0};var n=e+3+((15&a[e+1])<<8|a[e+2])-4;for(e+=
12+((15&a[e+10])<<8|a[e+11]);e<n;){switch(k=(31&a[e+1])<<8|a[e+2],a[e]){case 207:if(!d){h.logger.log("unkown stream type:"+a[e]);break}case 15:-1===t.audio&&(t.audio=k);break;case 21:-1===t.id3&&(t.id3=k);break;case 219:if(!d){h.logger.log("unkown stream type:"+a[e]);break}case 27:-1===t.avc&&(t.avc=k);break;case 3:case 4:m?-1===t.audio&&(t.audio=k,t.isAAC=!1):h.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:h.logger.warn("HEVC stream type found, not supported for now");
break;default:h.logger.log("unkown stream type:"+a[e])}e+=5+((15&a[e+3])<<8|a[e+4])}return t},f.prototype._parsePES=function(a){var e,m,d,k,t,n=0,l=a.data;if(!a||0===a.size)return null;for(;19>l[0].length&&1<l.length;){var v=new Uint8Array(l[0].length+l[1].length);v.set(l[0]);v.set(l[1],l[0].length);l[0]=v;l.splice(1,1)}if(1===((e=l[0])[0]<<16)+(e[1]<<8)+e[2]){if((d=(e[4]<<8)+e[5])&&d>a.size-6)return null;192&(m=e[7])&&(4294967295<(k=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&
e[12])+(254&e[13])/2)&&(k-=8589934592),64&m?(4294967295<(t=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)&&(t-=8589934592),54E5<k-t&&(h.logger.warn(Math.round((k-t)/9E4)+"s delta between PTS and DTS, align them"),k=t)):t=k);v=(m=e[8])+9;a.size-=v;a=new Uint8Array(a.size);for(var w=0,x=l.length;w<x;w++){var u=(e=l[w]).byteLength;if(v){if(v>u){v-=u;continue}e=e.subarray(v);u-=v;v=0}a.set(e,n);n+=u}return d&&(d-=m+3),{data:a,pts:k,dts:t,len:d}}return null},
f.prototype.pushAccesUnit=function(a,e){if(a.units.length&&a.frame){var m=e.samples,d=m.length;!this.config.forceKeyFrameOnDiscontinuity||!0===a.key||e.sps&&(d||this.contiguous)?(a.id=d,m.push(a)):e.dropped++}a.debug.length&&h.logger.log(a.pts+"/"+a.dts+":"+a.debug)},f.prototype._parseAVCPES=function(a,e){var m,d,k,t=this,n=this._avcTrack,l=this._parseAVCNALu(a.data),v=this.avcSample,w=!1,x=this.pushAccesUnit.bind(this),u=function(y,B,E,G){return{key:y,pts:B,dts:E,units:[],debug:G}};a.data=null;v&&
l.length&&!n.audFound&&(x(v,n),v=this.avcSample=u(!1,a.pts,a.dts,""));l.forEach(function(y){switch(y.type){case 1:d=!0;v||(v=t.avcSample=u(!0,a.pts,a.dts,""));v.frame=!0;var B=y.data;w&&4<B.length&&(B=(new p.default(B)).readSliceType(),2!==B&&4!==B&&7!==B&&9!==B||(v.key=!0));break;case 5:d=!0;v||(v=t.avcSample=u(!0,a.pts,a.dts,""));v.key=!0;v.frame=!0;break;case 6:d=!0;(m=new p.default(t.discardEPB(y.data))).readUByte();B=!1;for(var E;!B&&1<m.bytesAvailable;){var G=0;do G+=E=m.readUByte();while(255===
E);var D=0;do D+=E=m.readUByte();while(255===E);if(4===G&&0!==m.bytesAvailable){if((B=!0,181===m.readUByte())&&49===m.readUShort()&&1195456820===m.readUInt()&&3===m.readUByte()){D=m.readUByte();G=31&D;D=[D,m.readUByte()];for(k=0;k<G;k++)D.push(m.readUByte()),D.push(m.readUByte()),D.push(m.readUByte());t._insertSampleInOrder(t._txtTrack.samples,{type:3,pts:a.pts,bytes:D})}}else if(D<m.bytesAvailable)for(k=0;k<D;k++)m.readUByte()}break;case 7:if(d=!0,w=!0,!n.sps){B=(m=new p.default(y.data)).readSPS();
n.width=B.width;n.height=B.height;n.pixelRatio=B.pixelRatio;n.sps=[y.data];n.duration=t._duration;B=y.data.subarray(1,4);G="avc1.";for(k=0;3>k;k++)D=B[k].toString(16),2>D.length&&(D="0"+D),G+=D;n.codec=G}break;case 8:d=!0;n.pps||(n.pps=[y.data]);break;case 9:d=!1;n.audFound=!0;v&&x(v,n);v=t.avcSample=u(!1,a.pts,a.dts,"");break;case 12:d=!1;break;default:d=!1,v&&(v.debug+="unknown NAL "+y.type+" ")}v&&d&&v.units.push(y)});e&&v&&(x(v,n),this.avcSample=null)},f.prototype._insertSampleInOrder=function(a,
e){var m=a.length;if(0<m)if(e.pts>=a[m-1].pts)a.push(e);else for(--m;0<=m;m--){if(e.pts<a[m].pts){a.splice(m,0,e);break}}else a.push(e)},f.prototype._getLastNalUnit=function(){var a=this.avcSample;a&&0!==a.units.length||(a=this._avcTrack.samples,a=a[a.length-1]);if(a){var e=a.units;e=e[e.length-1]}return e},f.prototype._parseAVCNALu=function(a){var e,m,d=0,k=a.byteLength,t=this._avcTrack,n=t.naluState||0,l=n,v=[],w=-1;for(-1===n&&(w=0,m=31&a[0],n=0,d=1);d<k;)if(e=a[d++],n)if(1!==n)if(e)if(1===e){var x,
u;if(0<=w){var y={data:a.subarray(w,d-n-1),type:m};v.push(y)}else if(x=this._getLastNalUnit())if(l&&d<=4-l&&x.state&&(x.data=x.data.subarray(0,x.data.byteLength-l)),0<(e=d-n-1))(u=new Uint8Array(x.data.byteLength+e)).set(x.data,0),u.set(a.subarray(0,e),x.data.byteLength),x.data=u;d<k?(w=d,m=31&a[d],n=0):n=-1}else n=0;else n=3;else n=e?0:2;else n=e?0:1;(0<=w&&0<=n&&(y={data:a.subarray(w,k),type:m,state:n},v.push(y)),0===v.length)&&(x=this._getLastNalUnit())&&((u=new Uint8Array(x.data.byteLength+a.byteLength)).set(x.data,
0),u.set(a,x.data.byteLength),x.data=u);return t.naluState=n,v},f.prototype.discardEPB=function(a){var e=a.byteLength;for(var m=[],d=1;d<e-2;)0===a[d]&&0===a[d+1]&&3===a[d+2]?(m.push(d+2),d+=2):d++;if(0===m.length)return a;e-=m.length;var k=new Uint8Array(e);var t=0;for(d=0;d<e;t++,d++)t===m[0]&&(t++,m.shift()),k[d]=a[t];return k},f.prototype._parseAACPES=function(a){var e,m,d=this._audioTrack,k=a.data;a=a.pts;var t=this.aacOverFlow,n=this.aacLastPTS;if(t){var l=new Uint8Array(t.byteLength+k.byteLength);
l.set(t,0);l.set(k,t.byteLength);k=l}l=0;for(m=k.length;l<m-1&&!A.isHeader(k,l);l++);if(l){var v=e=void 0;if(l<m-1?(e="AAC PES did not start with ADTS header,offset:"+l,v=!1):(e="no ADTS header found in AAC PES",v=!0),h.logger.warn("parsing error:"+e),this.observer.trigger(g.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:v,reason:e}),v)return}if(A.initTrackConfig(d,this.observer,k,l,this.audioCodec),e=0,v=A.getFrameDuration(d.samplerate),t&&n)t=n+v,1<
Math.abs(t-a)&&(h.logger.log("AAC: align PTS for overlapping frames by "+Math.round((t-a)/90)),a=t);for(;l<m;)if(A.isHeader(k,l)&&l+5<m){t=A.appendFrame(d,k,l,a,e);if(!t)break;l+=t.length;var w=t.sample.pts;e++}else l++;this.aacOverFlow=t=l<m?k.subarray(l,m):null;this.aacLastPTS=w},f.prototype._parseMPEGPES=function(a){var e=a.data,m=e.length,d=0,k=0;for(a=a.pts;k<m;)if(q.default.isHeader(e,k)){var t=q.default.appendFrame(this._audioTrack,e,k,a,d);if(!t)break;k+=t.length;d++}else k++},f.prototype._parseID3PES=
function(a){this._id3Track.samples.push(a)},f}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(0);F=function(){function q(g){this.data=g;this.bytesAvailable=g.byteLength;this.bitsAvailable=this.word=0}return q.prototype.loadWord=function(){var g=this.data,p=this.bytesAvailable,r=g.byteLength-p,h=new Uint8Array(4);p=Math.min(4,p);if(0===p)throw Error("no bytes available");h.set(g.subarray(r,r+p));this.word=(new DataView(h.buffer)).getUint32(0);this.bitsAvailable=
8*p;this.bytesAvailable-=p},q.prototype.skipBits=function(g){var p;this.bitsAvailable>g?(this.word<<=g,this.bitsAvailable-=g):(g-=this.bitsAvailable,g-=(p=g>>3)>>3,this.bytesAvailable-=p,this.loadWord(),this.word<<=g,this.bitsAvailable-=g)},q.prototype.readBits=function(g){var p=Math.min(this.bitsAvailable,g),r=this.word>>>32-p;return 32<g&&A.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=p,0<this.bitsAvailable?this.word<<=p:0<this.bytesAvailable&&this.loadWord(),0<(p=
g-p)&&this.bitsAvailable?r<<p|this.readBits(p):r},q.prototype.skipLZ=function(){var g;for(g=0;g<this.bitsAvailable;++g)if(0!=(this.word&2147483648>>>g))return this.word<<=g,this.bitsAvailable-=g,g;return this.loadWord(),g+this.skipLZ()},q.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},q.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},q.prototype.readUEG=function(){var g=this.skipLZ();return this.readBits(g+1)-1},q.prototype.readEG=function(){var g=this.readUEG();return 1&
g?1+g>>>1:-1*(g>>>1)},q.prototype.readBoolean=function(){return 1===this.readBits(1)},q.prototype.readUByte=function(){return this.readBits(8)},q.prototype.readUShort=function(){return this.readBits(16)},q.prototype.readUInt=function(){return this.readBits(32)},q.prototype.skipScalingList=function(g){var p,r=8,h=8;for(p=0;p<g;p++)0!==h&&(h=(r+this.readEG()+256)%256),r=0===h?r:h},q.prototype.readSPS=function(){var g,p=0,r=0,h=0,c=0,b=this.readUByte.bind(this);var f=this.readBits.bind(this);var a=this.readUEG.bind(this),
e=this.readBoolean.bind(this),m=this.skipBits.bind(this);var d=this.skipEG.bind(this);var k=this.skipUEG.bind(this);var t=this.skipScalingList.bind(this);if(b(),g=b(),f(5),m(3),b(),k(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g)if(g=a(),3===g&&m(1),k(),k(),m(1),e()){var n=3!==g?8:12;for(g=0;g<n;g++)e()&&t(6>g?16:64)}k();t=a();if(0===t)a();else if(1===t)for(m(1),d(),d(),t=a(),g=0;g<t;g++)d();k();m(1);d=a();k=a();0===(f=f(1))&&m(1);m(1);e()&&(p=a(),r=a(),h=a(),c=a());
a=[1,1];if(e()&&e())switch(b()){case 1:a=[1,1];break;case 2:a=[12,11];break;case 3:a=[10,11];break;case 4:a=[16,11];break;case 5:a=[40,33];break;case 6:a=[24,11];break;case 7:a=[20,11];break;case 8:a=[32,11];break;case 9:a=[80,33];break;case 10:a=[18,11];break;case 11:a=[15,11];break;case 12:a=[64,33];break;case 13:a=[160,99];break;case 14:a=[4,3];break;case 15:a=[3,2];break;case 16:a=[2,1];break;case 255:a=[b()<<8|b(),b()<<8|b()]}return{width:Math.ceil(16*(d+1)-2*p-2*r),height:(2-f)*(k+1)*16-(f?
2:4)*(h+c),pixelRatio:a}},q.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},q}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(13);F=function(){function q(g,p,r,h){this.decryptdata=r;this.discardEPB=h;this.decrypter=new A.default(g,p,{removePKCS7Padding:!1})}return q.prototype.decryptBuffer=function(g,p){this.decrypter.decrypt(g,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,p)},q.prototype.decryptAacSample=
function(g,p,r,h){var c=g[p].unit,b=c.subarray(16,c.length-c.length%16);b=b.buffer.slice(b.byteOffset,b.byteOffset+b.length);var f=this;this.decryptBuffer(b,function(a){a=new Uint8Array(a);c.set(a,16);h||f.decryptAacSamples(g,p+1,r)})},q.prototype.decryptAacSamples=function(g,p,r){for(;;p++){if(p>=g.length)return void r();if(!(32>g[p].unit.length)){var h=this.decrypter.isSync();if(this.decryptAacSample(g,p,r,h),!h)break}}},q.prototype.getAvcEncryptedData=function(g){for(var p=new Int8Array(16*Math.floor((g.length-
48)/160)+16),r=0,h=32;h<=g.length-16;h+=160,r+=16)p.set(g.subarray(h,h+16),r);return p},q.prototype.getAvcDecryptedUnit=function(g,p){p=new Uint8Array(p);for(var r=0,h=32;h<=g.length-16;h+=160,r+=16)g.set(p.subarray(r,r+16),h);return g},q.prototype.decryptAvcSample=function(g,p,r,h,c,b){var f=this.discardEPB(c.data),a=this.getAvcEncryptedData(f),e=this;this.decryptBuffer(a.buffer,function(m){c.data=e.getAvcDecryptedUnit(f,m);b||e.decryptAvcSamples(g,p,r+1,h)})},q.prototype.decryptAvcSamples=function(g,
p,r,h){for(;;p++,r=0){if(p>=g.length)return void h();for(var c=g[p].units;!(r>=c.length);r++){var b=c[r];if(!(48>=b.length||1!==b.type&&5!==b.type)){var f=this.decrypter.isSync();if(this.decryptAvcSample(g,p,r,h,b,f),!f)return}}}},q}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(11),q=z(0),g=z(23);F=function(){function p(r,h,c){this.observer=r;this.config=c;this.remuxer=h}return p.prototype.resetInitSegment=function(r,h,c,b){this._audioTrack={container:"audio/mpeg",
type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:h,duration:b,inputTimeScale:9E4}},p.prototype.resetTimeStamp=function(){},p.probe=function(r){var h,c;if((h=A.default.getID3Data(r,0))&&void 0!==A.default.getTimeStamp(h))for(h=h.length,c=Math.min(r.length-1,h+100);h<c;h++)if(g.default.probe(r,h))return q.logger.log("MPEG Audio sync word found !"),!0;return!1},p.prototype.append=function(r,h,c,b){var f=A.default.getID3Data(r,0),a=A.default.getTimeStamp(f);a=a?90*a:9E4*h;for(var e=
f.length,m=r.length,d=0,k=0,t=this._audioTrack,n=[{pts:a,dts:a,data:f}];e<m;)if(g.default.isHeader(r,e)){k=g.default.appendFrame(t,r,e,a,d);if(!k)break;e+=k.length;k=k.sample.pts;d++}else A.default.isHeader(r,e)?(f=A.default.getID3Data(r,e),n.push({pts:k,dts:k,data:f}),e+=f.length):e++;this.remuxer.remux(t,{samples:[]},{samples:n,inputTimeScale:9E4},{samples:[]},h,c,b)},p.prototype.destroy=function(){},p}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(48),
q=z(49),g=z(1),p=z(3),r=z(0);F=function(){function h(c,b,f,a){this.observer=c;this.config=b;this.typeSupported=f;c=navigator.userAgent;this.isSafari=a&&-1<a.indexOf("Apple")&&c&&!c.match("CriOS");this.ISGenerated=!1}return h.prototype.destroy=function(){},h.prototype.resetTimeStamp=function(c){this._initPTS=this._initDTS=c},h.prototype.resetInitSegment=function(){this.ISGenerated=!1},h.prototype.remux=function(c,b,f,a,e,m,d){if(this.ISGenerated||this.generateIS(c,b,e),this.ISGenerated){var k=c.samples.length,
t=b.samples.length,n=e,l=e;if(k&&t){var v=(c.samples[0].pts-b.samples[0].pts)/b.inputTimeScale;n+=Math.max(0,v);l+=Math.max(0,-v)}k?(c.timescale||(r.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(c,b,e)),n=this.remuxAudio(c,n,m,d),t&&(t=void 0,n&&(t=n.endPTS-n.startPTS),b.timescale||(r.logger.warn("regenerate InitSegment as video detected"),this.generateIS(c,b,e)),this.remuxVideo(b,l,m,t,d))):t&&(b=this.remuxVideo(b,l,m,0,d))&&c.codec&&this.remuxEmptyAudio(c,n,m,b)}f.samples.length&&
this.remuxID3(f,e);a.samples.length&&this.remuxText(a,e);this.observer.trigger(g.default.FRAG_PARSED)},h.prototype.generateIS=function(c,b,f){var a,e,m=this.observer,d=c.samples,k=b.samples,t=this.typeSupported,n="audio/mp4",l={},v={tracks:l},w=void 0===this._initPTS;if(w&&(a=e=1/0),c.config&&d.length&&(c.timescale=c.samplerate,r.logger.log("audio sampling rate : "+c.samplerate),c.isAAC||(t.mpeg?(n="audio/mpeg",c.codec=""):t.mp3&&(c.codec="mp3")),l.audio={container:n,codec:c.codec,initSegment:!c.isAAC&&
t.mpeg?new Uint8Array:q.default.initSegment([c]),metadata:{channelCount:c.channelCount}},w&&(a=e=d[0].pts-c.inputTimeScale*f)),b.sps&&b.pps&&k.length)c=b.inputTimeScale,b.timescale=c,l.video={container:"video/mp4",codec:b.codec,initSegment:q.default.initSegment([b]),metadata:{width:b.width,height:b.height}},w&&(a=Math.min(a,k[0].pts-c*f),e=Math.min(e,k[0].dts-c*f),this.observer.trigger(g.default.INIT_PTS_FOUND,{initPTS:a}));Object.keys(l).length?(m.trigger(g.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=
!0,w&&(this._initPTS=a,this._initDTS=e)):m.trigger(g.default.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},h.prototype.remuxVideo=function(c,b,f,a,e){var m;var d=8;var k=c.timescale,t=c.samples,n=[],l=t.length,v=this._PTSNormalize,w=this._initPTS,x=this.nextAvcDts,u=this.isSafari;if(0!==l){u&&(f|=t.length&&x&&(e&&.1>Math.abs(b-x/k)||Math.abs(t[0].pts-x-w)<k/5));f||(x=b*k);t.forEach(function(O){O.pts=v(O.pts-w,x);O.dts=
v(O.dts-w,x)});t.sort(function(O,N){var P=O.pts-N.pts;return O.dts-N.dts||P||O.id-N.id});b=t.reduce(function(O,N){return Math.max(Math.min(O,N.pts-N.dts),-18E3)},0);if(0>b){r.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var y=0;y<t.length;y++)t[y].dts+=b}y=t[0];e=Math.max(y.dts,0);b=Math.max(y.pts,0);var B=Math.round((e-x)/90);f&&B&&(1<B?r.logger.log("AVC:"+B+" ms hole between fragments detected,filling it"):-1>B&&r.logger.log("AVC:"+
-B+" ms overlapping between fragments detected"),e=x,t[0].dts=e,b=Math.max(b-B,x),t[0].pts=b,r.logger.log("Video/PTS/DTS adjusted: "+Math.round(b/90)+"/"+Math.round(e/90)+",delta:"+B+" ms"));y=t[t.length-1];B=Math.max(y.dts,0);f=Math.max(y.pts,0,B);u&&(m=Math.round((B-e)/(t.length-1)));var E=0,G=0;for(y=0;y<l;y++){for(var D=t[y],I=D.units,J=I.length,K=0,H=0;H<J;H++)K+=I[H].data.length;G+=K;E+=J;D.length=K;D.dts=u?e+y*m:Math.max(D.dts,e);D.pts=Math.max(D.pts,D.dts)}y=G+4*E+8;try{var M=new Uint8Array(y)}catch(O){return void this.observer.trigger(g.default.ERROR,
{type:p.ErrorTypes.MUX_ERROR,details:p.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:y,reason:"fail allocating video mdat "+y})}E=new DataView(M.buffer);E.setUint32(0,y);M.set(q.default.types.mdat,4);for(y=0;y<l;y++){G=t[y];I=G.units;D=0;J=void 0;H=0;for(J=I.length;H<J;H++){var L=I[H];K=L.data;L=L.data.byteLength;E.setUint32(d,L);d+=4;M.set(K,d);d+=L;D+=4+L}u?J=Math.max(0,m*Math.round((G.pts-G.dts)/m)):(y<l-1?m=t[y+1].dts-G.dts:(J=this.config,H=G.dts-t[0<y?y-1:y].dts,J.stretchShortVideoTrack?(I=(a?
b+a*k:this.nextAudioPts)-G.pts,I>Math.floor(J.maxBufferHole*k)?(0>(m=I-H)&&(m=H),r.logger.log("It is approximately "+I/90+" ms to the next segment; using duration "+m/90+" ms for the last video frame.")):m=H):m=H),J=Math.round(G.pts-G.dts));n.push({size:D,duration:m,cts:J,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:G.key?2:1,isNonSync:G.key?0:1}})}this.nextAvcDts=B+m;a=c.dropped;if(c.len=0,c.nbNalu=0,c.dropped=0,n.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome"))d=
n[0].flags,d.dependsOn=2,d.isNonSync=0;c.samples=n;d=q.default.moof(c.sequenceNumber++,e,c);c.samples=[];c={data1:d,data2:M,startPTS:b/k,endPTS:(f+m)/k,startDTS:e/k,endDTS:this.nextAvcDts/k,type:"video",hasAudio:!1,hasVideo:!0,nb:n.length,dropped:a};return this.observer.trigger(g.default.FRAG_PARSING_DATA,c),c}},h.prototype.remuxAudio=function(c,b,f,a){var e,m,d=c.inputTimeScale;var k=d/c.timescale;var t=(c.isAAC?1024:1152)*k,n=this._PTSNormalize,l=this._initPTS,v=!c.isAAC&&this.typeSupported.mpeg,
w=c.samples,x=[],u=this.nextAudioPts;if(f|=w.length&&u&&(a&&.1>Math.abs(b-u/d)||Math.abs(w[0].pts-u-l)<20*t),w.forEach(function(L){L.pts=L.dts=n(L.pts-l,b*d)}),0!==(w=w.filter(function(L){return 0<=L.pts})).length){if(f||(u=a?b*d:w[0].pts),c.isAAC)for(var y=this.config.maxAudioFramesDrift,B=0,E=u;B<w.length;){var G=w[B];a=(I=G.pts)-E;I=Math.abs(1E3*a/d);if(a<=-y*t)r.logger.warn("Dropping 1 audio frame @ "+(E/d).toFixed(3)+"s due to "+Math.round(I)+" ms overlap."),w.splice(B,1),c.len-=G.unit.length;
else{if(a>=y*t&&1E4>I&&E)for(I=Math.round(a/t),r.logger.warn("Injecting "+I+" audio frame @ "+(E/d).toFixed(3)+"s due to "+Math.round(1E3*a/d)+" ms gap."),a=0;a<I;a++){var D=Math.max(E,0);(e=A.default.getSilentFrame(c.manifestCodec||c.codec,c.channelCount))||(r.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),e=G.unit.subarray());w.splice(B,0,{unit:e,pts:D,dts:D});c.len+=e.length;E+=t;B++}else Math.abs(a);G.pts=G.dts=E;E+=t;B++}}a=0;for(y=w.length;a<
y;a++){B=w[a];E=B.unit;var I=B.pts;if(void 0!==M)J.duration=Math.round((I-M)/k);else{B=Math.round(1E3*(I-u)/d);G=0;if(f&&c.isAAC&&B){if(0<B&&1E4>B)G=Math.round((I-u)/t),r.logger.log(B+" ms hole between AAC samples detected,filling it"),0<G&&((e=A.default.getSilentFrame(c.manifestCodec||c.codec,c.channelCount))||(e=E.subarray()),c.len+=G*e.length);else if(-12>B){r.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(u/d).toFixed(3)+"s/"+(I/d).toFixed(3)+"s/"+-B+"ms");c.len-=E.byteLength;
continue}I=u}if(m=I,!(0<c.len))return;var J=v?c.len:c.len+8;var K=v?0:8;try{var H=new Uint8Array(J)}catch(L){return void this.observer.trigger(g.default.ERROR,{type:p.ErrorTypes.MUX_ERROR,details:p.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:J,reason:"fail allocating audio mdat "+J})}v||((new DataView(H.buffer)).setUint32(0,J),H.set(q.default.types.mdat,4));for(B=0;B<G;B++)(e=A.default.getSilentFrame(c.manifestCodec||c.codec,c.channelCount))||(r.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),
e=E.subarray()),H.set(e,K),K+=e.byteLength,J={size:e.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},x.push(J)}H.set(E,K);J=E.byteLength;K+=J;J={size:J,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};x.push(J);var M=I}u=0;f=x.length;return(2<=f&&(u=x[f-2].duration,J.duration=u),f)?(this.nextAudioPts=u=M+k*u,c.len=0,c.samples=x,k=v?new Uint8Array:q.default.moof(c.sequenceNumber++,m/k,c),c.samples=
[],c=m/d,m=u/d,H={data1:k,data2:H,startPTS:c,endPTS:m,startDTS:c,endDTS:m,type:"audio",hasAudio:!0,hasVideo:!1,nb:f},this.observer.trigger(g.default.FRAG_PARSING_DATA,H),H):null}},h.prototype.remuxEmptyAudio=function(c,b,f,a){var e=c.inputTimeScale,m=this.nextAudioPts;m=(void 0!==m?m:a.startDTS*e)+this._initDTS;var d=e/(c.samplerate?c.samplerate:e)*1024;a=Math.ceil((a.endDTS*e+this._initDTS-m)/d);e=A.default.getSilentFrame(c.manifestCodec||c.codec,c.channelCount);if(r.logger.warn("remux empty Audio"),
e){for(var k=[],t=0;t<a;t++){var n=m+t*d;k.push({unit:e,pts:n,dts:n});c.len+=e.length}c.samples=k;this.remuxAudio(c,b,f)}else r.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},h.prototype.remuxID3=function(c){var b,f=c.samples.length,a=c.inputTimeScale,e=this._initPTS,m=this._initDTS;if(f){for(var d=0;d<f;d++)(b=c.samples[d]).pts=(b.pts-e)/a,b.dts=(b.dts-m)/a;this.observer.trigger(g.default.FRAG_PARSING_METADATA,{samples:c.samples})}c.samples=
[]},h.prototype.remuxText=function(c){c.samples.sort(function(d,k){return d.pts-k.pts});var b,f=c.samples.length,a=c.inputTimeScale,e=this._initPTS;if(f){for(var m=0;m<f;m++)(b=c.samples[m]).pts=(b.pts-e)/a;this.observer.trigger(g.default.FRAG_PARSING_USERDATA,{samples:c.samples})}c.samples=[]},h.prototype._PTSNormalize=function(c,b){var f;if(void 0===b)return c;for(f=b<c?-8589934592:8589934592;4294967296<Math.abs(c-b);)c+=f;return c},h}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",
{value:!0});F=function(){function A(){}return A.getSilentFrame=function(q,g){switch(q){case "mp4a.40.2":if(1===g)return new Uint8Array([0,200,0,128,35,128]);if(2===g)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===g)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===g)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===g)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===g)return new Uint8Array([0,
200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===g)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===g||3===g)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,
90,90,90,90,94])}return null},A}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=Math.pow(2,32)-1;F=function(){function q(){}return q.init=function(){for(var g in q.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},
q.types)q.types.hasOwnProperty(g)&&(q.types[g]=[g.charCodeAt(0),g.charCodeAt(1),g.charCodeAt(2),g.charCodeAt(3)]);g=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var p=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);q.HDLR_TYPES={video:g,audio:p};g=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);p=new Uint8Array([0,0,0,0,0,0,0,0]);q.STTS=
q.STSC=q.STCO=p;q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);p=new Uint8Array([105,115,111,109]);var r=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);q.FTYP=q.box(q.types.ftyp,p,h,p,r);q.DINF=q.box(q.types.dinf,q.box(q.types.dref,g))},q.box=function(g){for(var p,r=Array.prototype.slice.call(arguments,1),h=8,c=r.length,b=c;c--;)h+=r[c].byteLength;(p=new Uint8Array(h))[0]=
h>>24&255;p[1]=h>>16&255;p[2]=h>>8&255;p[3]=255&h;p.set(g,4);c=0;for(h=8;c<b;c++)p.set(r[c],h),h+=r[c].byteLength;return p},q.hdlr=function(g){return q.box(q.types.hdlr,q.HDLR_TYPES[g])},q.mdat=function(g){return q.box(q.types.mdat,g)},q.mdhd=function(g,p){p*=g;var r=Math.floor(p/(A+1));p=Math.floor(p%(A+1));return q.box(q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,255&g,r>>24,r>>16&255,r>>8&255,255&r,p>>24,p>>16&255,p>>8&255,255&p,85,196,0,0]))},
q.mdia=function(g){return q.box(q.types.mdia,q.mdhd(g.timescale,g.duration),q.hdlr(g.type),q.minf(g))},q.mfhd=function(g){return q.box(q.types.mfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,255&g]))},q.minf=function(g){return"audio"===g.type?q.box(q.types.minf,q.box(q.types.smhd,q.SMHD),q.DINF,q.stbl(g)):q.box(q.types.minf,q.box(q.types.vmhd,q.VMHD),q.DINF,q.stbl(g))},q.moof=function(g,p,r){return q.box(q.types.moof,q.mfhd(g),q.traf(r,p))},q.moov=function(g){for(var p=g.length,r=[];p--;)r[p]=
q.trak(g[p]);return q.box.apply(null,[q.types.moov,q.mvhd(g[0].timescale,g[0].duration)].concat(r).concat(q.mvex(g)))},q.mvex=function(g){for(var p=g.length,r=[];p--;)r[p]=q.trex(g[p]);return q.box.apply(null,[q.types.mvex].concat(r))},q.mvhd=function(g,p){p*=g;var r=Math.floor(p/(A+1));p=Math.floor(p%(A+1));g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,255&g,r>>24,r>>16&255,r>>8&255,255&r,p>>24,p>>16&255,p>>8&255,255&p,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return q.box(q.types.mvhd,g)},q.sdtp=function(g){var p,r=g.samples||[],h=new Uint8Array(4+r.length);for(p=0;p<r.length;p++)g=r[p].flags,h[p+4]=g.dependsOn<<4|g.isDependedOn<<2|g.hasRedundancy;return q.box(q.types.sdtp,h)},q.stbl=function(g){return q.box(q.types.stbl,q.stsd(g),q.box(q.types.stts,q.STTS),q.box(q.types.stsc,q.STSC),q.box(q.types.stsz,q.STSZ),q.box(q.types.stco,
q.STCO))},q.avc1=function(g){var p,r,h=[],c=[];for(p=0;p<g.sps.length;p++){var b=(r=g.sps[p]).byteLength;h.push(b>>>8&255);h.push(255&b);h=h.concat(Array.prototype.slice.call(r))}for(p=0;p<g.pps.length;p++)b=(r=g.pps[p]).byteLength,c.push(b>>>8&255),c.push(255&b),c=c.concat(Array.prototype.slice.call(r));p=q.box(q.types.avcC,new Uint8Array([1,h[3],h[4],h[5],255,224|g.sps.length].concat(h).concat([g.pps.length]).concat(c)));r=g.width;b=g.height;h=g.pixelRatio[0];g=g.pixelRatio[1];return q.box(q.types.avc1,
new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>8&255,255&r,b>>8&255,255&b,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,g>>24,g>>16&255,g>>8&255,255&g])))},q.esds=function(g){var p=g.config.length;return new Uint8Array([0,0,0,0,3,23+p,0,1,0,
4,15+p,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([p]).concat(g.config).concat([6,1,2]))},q.mp4a=function(g){var p=g.samplerate;return q.box(q.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g.channelCount,0,16,0,0,0,0,p>>8&255,255&p,0,0]),q.box(q.types.esds,q.esds(g)))},q.mp3=function(g){var p=g.samplerate;return q.box(q.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g.channelCount,0,16,0,0,0,0,p>>8&255,255&p,0,0]))},q.stsd=function(g){return"audio"===g.type?g.isAAC||"mp3"!==
g.codec?q.box(q.types.stsd,q.STSD,q.mp4a(g)):q.box(q.types.stsd,q.STSD,q.mp3(g)):q.box(q.types.stsd,q.STSD,q.avc1(g))},q.tkhd=function(g){var p=g.id,r=g.duration*g.timescale,h=g.width;g=g.height;var c=Math.floor(r/(A+1));r=Math.floor(r%(A+1));return q.box(q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,p>>24&255,p>>16&255,p>>8&255,255&p,0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,h>>8&255,255&h,0,0,g>>8&255,255&g,0,0]))},q.traf=function(g,p){var r=q.sdtp(g),h=g.id,c=Math.floor(p/(A+1));p=Math.floor(p%(A+1));return q.box(q.types.traf,q.box(q.types.tfhd,new Uint8Array([0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h])),q.box(q.types.tfdt,new Uint8Array([1,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,p>>24,p>>16&255,p>>8&255,255&p])),q.trun(g,r.length+16+20+8+16+8+8),r)},q.trak=function(g){return g.duration=g.duration||4294967295,q.box(q.types.trak,q.tkhd(g),
q.mdia(g))},q.trex=function(g){g=g.id;return q.box(q.types.trex,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},q.trun=function(g,p){var r;g=g.samples||[];var h=g.length;var c=12+16*h;var b=new Uint8Array(c);p+=8+c;b.set([0,0,15,1,h>>>24&255,h>>>16&255,h>>>8&255,255&h,p>>>24&255,p>>>16&255,p>>>8&255,255&p],0);for(p=0;p<h;p++){c=(r=g[p]).duration;var f=r.size;var a=r.flags;r=r.cts;b.set([c>>>24&255,c>>>16&255,c>>>8&255,255&c,f>>>24&255,f>>>16&255,f>>>8&255,
255&f,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,r>>>24&255,r>>>16&255,r>>>8&255,255&r],12+16*p)}return q.box(q.types.trun,b)},q.initSegment=function(g){q.types||q.init();var p;g=q.moov(g);return(p=new Uint8Array(q.FTYP.byteLength+g.byteLength)).set(q.FTYP),p.set(g,q.FTYP.byteLength),p},q}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(1);F=function(){function q(g){this.observer=
g}return q.prototype.destroy=function(){},q.prototype.resetTimeStamp=function(){},q.prototype.resetInitSegment=function(){},q.prototype.remux=function(g,p,r,h,c,b,f,a){r=this.observer;h="";g&&(h+="audio");p&&(h+="video");r.trigger(A.default.FRAG_PARSING_DATA,{data1:a,startPTS:c,startDTS:c,type:h,hasAudio:!!g,hasVideo:!!p,nb:1,dropped:0});r.trigger(A.default.FRAG_PARSED)},q}();C.default=F},function(F,C,z){function A(){}function q(c,b,f,a,e){if("function"!=typeof f)throw new TypeError("The listener must be a function");
f=new function(m,d,k){this.fn=m;this.context=d;this.once=k||!1}(f,a||c,e);b=h?h+b:b;return c._events[b]?c._events[b].fn?c._events[b]=[c._events[b],f]:c._events[b].push(f):(c._events[b]=f,c._eventsCount++),c}function g(c,b){0==--c._eventsCount?c._events=new A:delete c._events[b]}function p(){this._events=new A;this._eventsCount=0}var r=Object.prototype.hasOwnProperty,h="~";Object.create&&(A.prototype=Object.create(null),(new A).__proto__||(h=!1));p.prototype.eventNames=function(){var c,b,f=[];if(0===
this._eventsCount)return f;for(b in c=this._events)r.call(c,b)&&f.push(h?b.slice(1):b);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(c)):f};p.prototype.listeners=function(c){c=this._events[h?h+c:c];if(!c)return[];if(c.fn)return[c.fn];for(var b=0,f=c.length,a=Array(f);b<f;b++)a[b]=c[b].fn;return a};p.prototype.listenerCount=function(c){return(c=this._events[h?h+c:c])?c.fn?1:c.length:0};p.prototype.emit=function(c,b,f,a,e,m){var d=h?h+c:c;if(!this._events[d])return!1;var k,
t=this._events[d],n=arguments.length;if(t.fn){switch(t.once&&this.removeListener(c,t.fn,void 0,!0),n){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,b),!0;case 3:return t.fn.call(t.context,b,f),!0;case 4:return t.fn.call(t.context,b,f,a),!0;case 5:return t.fn.call(t.context,b,f,a,e),!0;case 6:return t.fn.call(t.context,b,f,a,e,m),!0}d=1;for(k=Array(n-1);d<n;d++)k[d-1]=arguments[d];t.fn.apply(t.context,k)}else{var l=t.length;for(d=0;d<l;d++)switch(t[d].once&&this.removeListener(c,
t[d].fn,void 0,!0),n){case 1:t[d].fn.call(t[d].context);break;case 2:t[d].fn.call(t[d].context,b);break;case 3:t[d].fn.call(t[d].context,b,f);break;case 4:t[d].fn.call(t[d].context,b,f,a);break;default:if(!k){var v=1;for(k=Array(n-1);v<n;v++)k[v-1]=arguments[v]}t[d].fn.apply(t[d].context,k)}}return!0};p.prototype.on=function(c,b,f){return q(this,c,b,f,!1)};p.prototype.once=function(c,b,f){return q(this,c,b,f,!0)};p.prototype.removeListener=function(c,b,f,a){c=h?h+c:c;if(!this._events[c])return this;
if(!b)return g(this,c),this;var e=this._events[c];if(e.fn)e.fn!==b||a&&!e.once||f&&e.context!==f||g(this,c);else{for(var m=0,d=[],k=e.length;m<k;m++)(e[m].fn!==b||a&&!e[m].once||f&&e[m].context!==f)&&d.push(e[m]);d.length?this._events[c]=1===d.length?d[0]:d:g(this,c)}return this};p.prototype.removeAllListeners=function(c){var b;return c?(b=h?h+c:c,this._events[b]&&g(this,b)):(this._events=new A,this._eventsCount=0),this};p.prototype.off=p.prototype.removeListener;p.prototype.addListener=p.prototype.on;
p.prefixed=h;p.EventEmitter=p;F.exports=p},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(21),q=z(1),g=z(0),p=z(53);C.default=function(r){var h=new p.EventEmitter;h.trigger=function(b){for(var f=[],a=1;a<arguments.length;a++)f[a-1]=arguments[a];h.emit.apply(h,[b,b].concat(f))};h.off=function(b){for(var f=[],a=1;a<arguments.length;a++)f[a-1]=arguments[a];h.removeListener.apply(h,[b].concat(f))};var c=function(b,f){r.postMessage({event:b,data:f})};r.addEventListener("message",
function(b){b=b.data;switch(b.cmd){case "init":var f=JSON.parse(b.config);r.demuxer=new A.default(h,b.typeSupported,f,b.vendor);g.enableLogs(f.debug);c("init",null);break;case "demux":r.demuxer.push(b.data,b.decryptdata,b.initSegment,b.audioCodec,b.videoCodec,b.timeOffset,b.discontinuity,b.trackSwitch,b.contiguous,b.duration,b.accurateTimeOffset,b.defaultInitPTS)}});h.on(q.default.FRAG_DECRYPTED,c);h.on(q.default.FRAG_PARSING_INIT_SEGMENT,c);h.on(q.default.FRAG_PARSED,c);h.on(q.default.ERROR,c);h.on(q.default.FRAG_PARSING_METADATA,
c);h.on(q.default.FRAG_PARSING_USERDATA,c);h.on(q.default.INIT_PTS_FOUND,c);h.on(q.default.FRAG_PARSING_DATA,function(b,f){var a=[];b={event:b,data:f};f.data1&&(b.data1=f.data1.buffer,a.push(f.data1.buffer),delete f.data1);f.data2&&(b.data2=f.data2.buffer,a.push(f.data2.buffer),delete f.data2);r.postMessage(b,a)})}},function(F,C){function z(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function A(g){return"function"==typeof g}function q(g){return"object"==typeof g&&
null!==g}F.exports=z;z.EventEmitter=z;z.prototype._events=void 0;z.prototype._maxListeners=void 0;z.defaultMaxListeners=10;z.prototype.setMaxListeners=function(g){if("number"!=typeof g||0>g||isNaN(g))throw TypeError("n must be a positive number");return this._maxListeners=g,this};z.prototype.emit=function(g){var p,r,h;if(this._events||(this._events={}),"error"===g&&(!this._events.error||q(this._events.error)&&!this._events.error.length)){if((p=arguments[1])instanceof Error)throw p;var c=Error('Uncaught, unspecified "error" event. ('+
p+")");throw c.context=p,c;}if(void 0===(c=this._events[g]))return!1;if(A(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:p=Array.prototype.slice.call(arguments,1),c.apply(this,p)}else if(q(c))for(p=Array.prototype.slice.call(arguments,1),c=(h=c.slice()).length,r=0;r<c;r++)h[r].apply(this,p);return!0};z.prototype.addListener=function(g,p){var r;if(!A(p))throw TypeError("listener must be a function");
return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",g,A(p.listener)?p.listener:p),this._events[g]?q(this._events[g])?this._events[g].push(p):this._events[g]=[this._events[g],p]:this._events[g]=p,q(this._events[g])&&!this._events[g].warned&&(r=void 0===this._maxListeners?z.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[g].length>r&&(this._events[g].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this._events[g].length),"function"==typeof console.trace&&console.trace()),this};z.prototype.on=z.prototype.addListener;z.prototype.once=function(g,p){function r(){this.removeListener(g,r);h||(h=!0,p.apply(this,arguments))}if(!A(p))throw TypeError("listener must be a function");var h=!1;return r.listener=p,this.on(g,r),this};z.prototype.removeListener=function(g,p){var r,h,c;if(!A(p))throw TypeError("listener must be a function");if(!this._events||!this._events[g])return this;if(c=(r=this._events[g]).length,
h=-1,r===p||A(r.listener)&&r.listener===p)delete this._events[g],this._events.removeListener&&this.emit("removeListener",g,p);else if(q(r)){for(;0<c--;)if(r[c]===p||r[c].listener&&r[c].listener===p){h=c;break}if(0>h)return this;1===r.length?(r.length=0,delete this._events[g]):r.splice(h,1);this._events.removeListener&&this.emit("removeListener",g,p)}return this};z.prototype.removeAllListeners=function(g){var p;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?
this._events={}:this._events[g]&&delete this._events[g],this;if(0===arguments.length){for(p in this._events)"removeListener"!==p&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events={},this}if(A(p=this._events[g]))this.removeListener(g,p);else if(p)for(;p.length;)this.removeListener(g,p[p.length-1]);return delete this._events[g],this};z.prototype.listeners=function(g){return this._events&&this._events[g]?A(this._events[g])?[this._events[g]]:this._events[g].slice():
[]};z.prototype.listenerCount=function(g){if(this._events){g=this._events[g];if(A(g))return 1;if(g)return g.length}return 0};z.listenerCount=function(g,p){return g.listenerCount(p)}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(5),q=z(3),g=z(1),p=z(0);F=function(){function r(h,c,b,f){this.config=h;this.media=c;this.fragmentTracker=b;this.hls=f;this.stallReported=!1}return r.prototype.poll=function(h,c){var b=this.config,f=this.media,a=f.currentTime;c=window.performance.now();
if(a!==h)return this.stallReported&&(p.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(c-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);f.ended||!f.buffered.length||2<f.readyState||f.seeking&&A.BufferHelper.isBuffered(f,a)||(h=c-this.stalled,b=A.BufferHelper.bufferInfo(f,a,b.maxBufferHole),this.stalled?(1E3<=h&&this._reportStall(b.len),this._tryFixBufferStall(b,h)):this.stalled=c)},r.prototype._tryFixBufferStall=function(h,c){var b=this.config,
f=this.fragmentTracker.getPartialFragment(this.media.currentTime);f&&this._trySkipBufferHole(f);.5<h.len&&c>1E3*b.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},r.prototype._reportStall=function(h){var c=this.hls,b=this.media;this.stallReported||(this.stallReported=!0,p.logger.warn("Playback stalling at @"+b.currentTime+" due to low buffer"),c.trigger(g.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h}))},r.prototype._trySkipBufferHole=
function(h){for(var c=this.hls,b=this.media,f=b.currentTime,a=0,e=0;e<b.buffered.length;e++){var m=b.buffered.start(e);if(f>=a&&f<m)return b.currentTime=Math.max(m,b.currentTime+.1),p.logger.warn("skipping hole, adjusting currentTime from "+f+" to "+b.currentTime),this.stalled=null,void c.trigger(g.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+f+" to "+b.currentTime,frag:h});a=b.buffered.end(e)}},
r.prototype._tryNudgeBuffer=function(){var h=this.config,c=this.hls,b=this.media,f=b.currentTime,a=(this.nudgeRetry||0)+1;(this.nudgeRetry=a,a<h.nudgeMaxRetry)?(h=f+a*h.nudgeOffset,p.logger.log("adjust currentTime from "+f+" to "+h),b.currentTime=h,c.trigger(g.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(p.logger.error("still stuck in high buffer @"+f+" after "+h.nudgeMaxRetry+", raise fatal error"),c.trigger(g.default.ERROR,{type:q.ErrorTypes.MEDIA_ERROR,
details:q.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))},r}();C.default=F},function(F,C,z){var A=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,a){f.__proto__=a}||function(f,a){for(var e in a)a.hasOwnProperty(e)&&(f[e]=a[e])};return function(f,a){function e(){this.constructor=f}b(f,a);f.prototype=null===a?Object.create(a):(e.prototype=a.prototype,new e)}}();Object.defineProperty(C,"__esModule",{value:!0});var q,g=z(1);F=z(4);var p=z(0),r=z(3),
h=z(19),c=z(8);z=(window.performance,function(b){function f(a){a=b.call(this,a,g.default.MANIFEST_LOADED,g.default.LEVEL_LOADED,g.default.AUDIO_TRACK_SWITCHED,g.default.FRAG_LOADED,g.default.ERROR)||this;return a.canload=!1,a.currentLevelIndex=null,a.manualLevelIndex=-1,a.timer=null,q=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),a}return A(f,b),f.prototype.onHandlerDestroying=function(){this.clearTimer();this.manualLevelIndex=-1},f.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),
this.timer=null)},f.prototype.startLoad=function(){var a=this._levels;this.canload=!0;this.levelRetryCount=0;a&&a.forEach(function(e){e.loadError=0;var m=e.details;m&&m.live&&(e.details=void 0)});null!==this.timer&&this.loadLevel()},f.prototype.stopLoad=function(){this.canload=!1},f.prototype.onManifestLoaded=function(a){var e=[],m=[],d={},k=null,t=!1,n=!1;if(a.levels.forEach(function(w){var x=w.attrs;w.loadError=0;w.fragmentError=!1;t=t||!!w.videoCodec;n=n||!!w.audioCodec;q&&w.audioCodec&&-1!==w.audioCodec.indexOf("mp4a.40.34")&&
(w.audioCodec=void 0);(k=d[w.bitrate])?k.url.push(w.url):(w.url=[w.url],w.urlId=0,d[w.bitrate]=w,e.push(w));x&&(x.AUDIO&&(n=!0,c.addGroupId(k||w,"audio",x.AUDIO)),x.SUBTITLES&&c.addGroupId(k||w,"text",x.SUBTITLES))}),t&&n&&(e=e.filter(function(w){return!!w.videoCodec})),e=e.filter(function(w){var x=w.audioCodec;w=w.videoCodec;return(!x||h.isCodecSupportedInMp4(x,"audio"))&&(!w||h.isCodecSupportedInMp4(w,"video"))}),a.audioTracks&&(m=a.audioTracks.filter(function(w){return!w.audioCodec||h.isCodecSupportedInMp4(w.audioCodec,
"audio")})).forEach(function(w,x){w.id=x}),0<e.length){var l=e[0].bitrate;e.sort(function(w,x){return w.bitrate-x.bitrate});this._levels=e;for(var v=0;v<e.length;v++)if(e[v].bitrate===l){this._firstLevel=v;p.logger.log("manifest loaded,"+e.length+" level(s) found, first bitrate:"+l);break}this.hls.trigger(g.default.MANIFEST_PARSED,{levels:e,audioTracks:m,firstLevel:this._firstLevel,stats:a.stats,audio:n,video:t,altAudio:m.some(function(w){return!!w.url})})}else this.hls.trigger(g.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,
details:r.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(f.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(a){var e=this._levels;e&&(a=Math.min(a,e.length-1),this.currentLevelIndex===a&&e[a].details||this.setLevelInternal(a))},enumerable:!0,configurable:!0}),
f.prototype.setLevelInternal=function(a){var e=this._levels,m=this.hls;if(0<=a&&a<e.length){if(this.clearTimer(),this.currentLevelIndex!==a){p.logger.log("switching to level "+a);this.currentLevelIndex=a;var d=e[a];d.level=a;m.trigger(g.default.LEVEL_SWITCHING,d)}e=e[a];d=e.details;if(!d||d.live)d=e.urlId,m.trigger(g.default.LEVEL_LOADING,{url:e.url[d],level:a,id:d})}else m.trigger(g.default.ERROR,{type:r.ErrorTypes.OTHER_ERROR,details:r.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})},
Object.defineProperty(f.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a;void 0===this._startLevel&&(this._startLevel=a);-1!==a&&(this.level=a)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(a){this._firstLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;
return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a},enumerable:!0,configurable:!0}),f.prototype.onError=function(a){if(a.fatal)a.type===r.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var e=!1,m=!1;switch(a.details){case r.ErrorDetails.FRAG_LOAD_ERROR:case r.ErrorDetails.FRAG_LOAD_TIMEOUT:case r.ErrorDetails.KEY_LOAD_ERROR:case r.ErrorDetails.KEY_LOAD_TIMEOUT:var d=a.frag.level;m=!0;break;case r.ErrorDetails.LEVEL_LOAD_ERROR:case r.ErrorDetails.LEVEL_LOAD_TIMEOUT:d=
a.context.level;e=!0;break;case r.ErrorDetails.REMUX_ALLOC_ERROR:d=a.level,e=!0}void 0!==d&&this.recoverLevel(a,d,e,m)}},f.prototype.recoverLevel=function(a,e,m,d){var k,t,n=this;var l=this.hls.config;var v=a.details,w=this._levels[e];if(w.loadError++,w.fragmentError=d,m){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return p.logger.error("level controller, cannot recover from "+v+" error"),this.currentLevelIndex=null,this.clearTimer(),void(a.fatal=!0);l=Math.min(Math.pow(2,this.levelRetryCount)*
l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout);this.timer=setTimeout(function(){return n.loadLevel()},l);a.levelRetry=!0;this.levelRetryCount++;p.logger.warn("level controller, "+v+", retry in "+l+" ms, current retry count is "+this.levelRetryCount)}(m||d)&&(1<(k=w.url.length)&&w.loadError<k?(w.urlId=(w.urlId+1)%k,w.details=void 0,p.logger.warn("level controller, "+v+" for level "+e+": switching to redundant URL-id "+w.urlId)):-1===this.manualLevelIndex?(t=0===e?this._levels.length-1:e-1,
p.logger.warn("level controller, "+v+": switch to "+t),this.hls.nextAutoLevel=this.currentLevelIndex=t):d&&(p.logger.warn("level controller, "+v+": reload a fragment"),this.currentLevelIndex=null))},f.prototype.onFragLoaded=function(a){a=a.frag;void 0!==a&&"main"===a.type&&(a=this._levels[a.level],void 0!==a&&(a.fragmentError=!1,a.loadError=0,this.levelRetryCount=0))},f.prototype.onLevelLoaded=function(a){var e=this,m=a.level,d=a.details;m===this.currentLevelIndex&&(m=this._levels[m],(m.fragmentError||
(m.loadError=0,this.levelRetryCount=0),d.live)?(a=c.computeReloadInterval(m.details,d,a.stats.trequest),p.logger.log("live playlist, reload in "+Math.round(a)+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},a)):this.clearTimer())},f.prototype.onAudioTrackSwitched=function(a){a=this.hls.audioTracks[a.id].groupId;var e=this.hls.levels[this.currentLevelIndex];if(e&&e.audioGroupIds){for(var m=-1,d=0;d<e.audioGroupIds.length;d++)if(e.audioGroupIds[d]===a){m=d;break}m!==e.urlId&&(e.urlId=
m,this.startLoad())}},f.prototype.loadLevel=function(){if(p.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var a=this._levels[this.currentLevelIndex];if("object"==typeof a&&0<a.url.length){var e=this.currentLevelIndex,m=a.urlId;a=a.url[m];p.logger.log("Attempt loading level index "+e+" with URL-id "+m);this.hls.trigger(g.default.LEVEL_LOADING,{url:a,level:e,id:m})}}},Object.defineProperty(f.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?
this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a;-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)},enumerable:!0,configurable:!0}),f}(F.default));C.default=z},function(F,C,z){var A=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,b){c.__proto__=b}||function(c,b){for(var f in b)b.hasOwnProperty(f)&&(c[f]=b[f])};return function(c,b){function f(){this.constructor=c}h(c,b);c.prototype=null===b?Object.create(b):(f.prototype=
b.prototype,new f)}}();Object.defineProperty(C,"__esModule",{value:!0});var q=z(1),g=z(4),p=z(11),r=z(29);F=function(h){function c(b){b=h.call(this,b,q.default.MEDIA_ATTACHED,q.default.MEDIA_DETACHING,q.default.FRAG_PARSING_METADATA)||this;return b.id3Track=void 0,b.media=void 0,b}return A(c,h),c.prototype.destroy=function(){g.default.prototype.destroy.call(this)},c.prototype.onMediaAttached=function(b){this.media=b.media;this.media},c.prototype.onMediaDetaching=function(){r.clearCurrentCues(this.id3Track);
this.media=this.id3Track=void 0},c.prototype.getID3Track=function(b){for(var f=0;f<b.length;f++){var a=b[f];if("metadata"===a.kind&&"id3"===a.label)return r.sendAddTrackEvent(a,this.media),a}return this.media.addTextTrack("metadata","id3")},c.prototype.onFragParsingMetadata=function(b){var f=b.frag;b=b.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var a=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<b.length;e++){var m=
p.default.getID3Frames(b[e].data);if(m){var d=b[e].pts,k=e<b.length-1?b[e+1].pts:f.endPTS;d===k&&(k+=1E-4);for(var t=0;t<m.length;t++){var n=m[t];if(!p.default.isTimeStampFrame(n)){var l=new a(d,k,"");l.value=n;this.id3Track.addCue(l)}}}}},c}(g.default);C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(14);C.isSupported=function(){var q=A.getMediaSource(),g=window.SourceBuffer||window.WebKitSourceBuffer;q=q&&"function"==typeof q.isTypeSupported&&q.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');
g=!g||g.prototype&&"function"==typeof g.prototype.appendBuffer&&"function"==typeof g.prototype.remove;return!!q&&!!g}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=z(59);var A=z(62),q=z(63),g=z(64),p=z(65),r=z(66),h=z(67),c=z(68),b=z(70),f=z(74),a=z(75),e=z(76);z=z(77);C.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6E7,maxBufferHole:.5,
lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1E4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1E3,manifestLoadingMaxRetryTimeout:64E3,startLevel:void 0,levelLoadingTimeOut:1E4,levelLoadingMaxRetry:4,
levelLoadingRetryDelay:1E3,levelLoadingMaxRetryTimeout:64E3,fragLoadingTimeOut:2E4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1E3,fragLoadingMaxRetryTimeout:64E3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5E3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:F.default,bufferController:A.default,capLevelController:q.default,fpsController:g.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,
forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5E5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:z.requestMediaKeySystemAccess};C.hlsDefaultConfig.subtitleStreamController=a.SubtitleStreamController;C.hlsDefaultConfig.subtitleTrackController=f.default;C.hlsDefaultConfig.timelineController=
b.default;C.hlsDefaultConfig.cueHandler=c;C.hlsDefaultConfig.enableCEA708Captions=!0;C.hlsDefaultConfig.enableWebVTT=!0;C.hlsDefaultConfig.captionsTextTrack1Label="English";C.hlsDefaultConfig.captionsTextTrack1LanguageCode="en";C.hlsDefaultConfig.captionsTextTrack2Label="Spanish";C.hlsDefaultConfig.captionsTextTrack2LanguageCode="es";C.hlsDefaultConfig.audioStreamController=h.default;C.hlsDefaultConfig.audioTrackController=r.default;C.hlsDefaultConfig.emeController=e.default},function(F,C,z){(function(A){var q=
this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,d){m.__proto__=d}||function(m,d){for(var k in d)d.hasOwnProperty(k)&&(m[k]=d[k])};return function(m,d){function k(){this.constructor=m}e(m,d);m.prototype=null===d?Object.create(d):(k.prototype=d.prototype,new k)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(1),p=z(4),r=z(5),h=z(3),c=z(0),b=z(60),f=window.performance,a=function(e){function m(d){var k=e.call(this,d,g.default.FRAG_LOADING,
g.default.FRAG_LOADED,g.default.FRAG_BUFFERED,g.default.ERROR)||this;return k.lastLoadedFragLevel=0,k._nextAutoLevel=-1,k.hls=d,k.timer=null,k._bwEstimator=null,k.onCheck=k._abandonRulesCheck.bind(k),k}return q(m,e),m.prototype.destroy=function(){this.clearTimer();p.default.prototype.destroy.call(this)},m.prototype.onFragLoading=function(d){d=d.frag;if("main"===d.type&&(this.timer||(this.fragCurrent=d,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var k=this.hls,t=k.config,n=void 0,
l=void 0;k.levels[d.level].details.live?(n=t.abrEwmaFastLive,l=t.abrEwmaSlowLive):(n=t.abrEwmaFastVoD,l=t.abrEwmaSlowVoD);this._bwEstimator=new b.default(k,l,n,t.abrEwmaDefaultEstimate)}},m.prototype._abandonRulesCheck=function(){var d=this.hls,k=d.media,t=this.fragCurrent;if(t){var n=t.loader,l=d.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var v=n.stats;if(k&&v&&(!k.paused&&
0!==k.playbackRate||!k.readyState)&&t.autoLevel&&t.level){var w=f.now()-v.trequest,x=Math.abs(k.playbackRate);if(w>500*t.duration/x){var u=d.levels,y=Math.max(1,v.bw?v.bw/8:1E3*v.loaded/w),B=u[t.level];B=B.realBitrate?Math.max(B.realBitrate,B.bitrate):B.bitrate;var E=k.currentTime;B=((v.total?v.total:Math.max(v.loaded,Math.round(t.duration*B/8)))-v.loaded)/y;k=(r.BufferHelper.bufferInfo(k,E,d.config.maxBufferHole).end-E)/x;if(k<2*t.duration/x&&B>k){x=void 0;for(E=t.level-1;E>l&&!((x=t.duration*(u[E].realBitrate?
Math.max(u[E].realBitrate,u[E].bitrate):u[E].bitrate)/(6.4*y))<k);E--);x<B&&(c.logger.warn("loading too slow, abort fragment loading and switch to level "+E+":fragLoadedDelay["+E+"]<fragLoadedDelay["+(t.level-1)+"];bufferStarvationDelay:"+x.toFixed(1)+"<"+B.toFixed(1)+":"+k.toFixed(1)),d.nextLoadLevel=E,this._bwEstimator.sample(w,v.loaded),n.abort(),this.clearTimer(),d.trigger(g.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,stats:v}))}}}}},m.prototype.onFragLoaded=function(d){var k=d.frag;if("main"===
k.type&&A.isFinite(k.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=k.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){k=this.hls.levels[k.level];var t=(k.loaded?k.loaded.bytes:0)+d.stats.loaded,n=(k.loaded?k.loaded.duration:0)+d.frag.duration;k.loaded={bytes:t,duration:n};k.realBitrate=Math.round(8*t/n)}d.frag.bitrateTest&&(k=d.stats,k.tparsed=k.tbuffered=k.tload,this.onFragBuffered(d))}},m.prototype.onFragBuffered=function(d){var k=d.stats;d=d.frag;if(!0!==k.aborted&&"main"===
d.type&&A.isFinite(d.sn)&&(!d.bitrateTest||k.tload===k.tbuffered)){var t=k.tparsed-k.trequest;c.logger.log("latency/loading/parsing/append/kbps:"+Math.round(k.tfirst-k.trequest)+"/"+Math.round(k.tload-k.tfirst)+"/"+Math.round(k.tparsed-k.tload)+"/"+Math.round(k.tbuffered-k.tparsed)+"/"+Math.round(8*k.loaded/(k.tbuffered-k.trequest)));this._bwEstimator.sample(t,k.loaded);k.bwEstimate=this._bwEstimator.getEstimate();d.bitrateTest?this.bitrateTestDelay=t/1E3:this.bitrateTestDelay=0}},m.prototype.onError=
function(d){switch(d.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},m.prototype.clearTimer=function(){clearInterval(this.timer);this.timer=null},Object.defineProperty(m.prototype,"nextAutoLevel",{get:function(){var d=this._nextAutoLevel,k=this._bwEstimator;if(!(-1===d||k&&k.canEstimate()))return d;k=this._nextABRAutoLevel;return-1!==d&&(k=Math.min(d,k)),k},set:function(d){this._nextAutoLevel=d},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,
"_nextABRAutoLevel",{get:function(){var d=this.hls,k=d.maxAutoLevel,t=d.levels,n=d.config,l=d.minAutoLevel,v=d.media;d=this.lastLoadedFragLevel;var w=this.fragCurrent?this.fragCurrent.duration:0,x=v?v.currentTime:0,u=v&&0!==v.playbackRate?Math.abs(v.playbackRate):1,y=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate;v=(r.BufferHelper.bufferInfo(v,x,n.maxBufferHole).end-x)/u;x=this._findBestLevel(d,w,y,l,k,v,n.abrBandWidthFactor,n.abrBandWidthUpFactor,t);if(0<=x)return x;c.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");
u=w?Math.min(w,n.maxStarvationDelay):n.maxStarvationDelay;var B=n.abrBandWidthFactor,E=n.abrBandWidthUpFactor;if(0===v){var G=this.bitrateTestDelay;G&&(u=(w?Math.min(w,n.maxLoadingDelay):n.maxLoadingDelay)-G,c.logger.trace("bitrate test took "+Math.round(1E3*G)+"ms, set first fragment max fetchDuration to "+Math.round(1E3*u)+" ms"),B=E=1)}return x=this._findBestLevel(d,w,y,l,k,v+u,B,E,t),Math.max(x,0)},enumerable:!0,configurable:!0}),m.prototype._findBestLevel=function(d,k,t,n,l,v,w,x,u){for(;l>=
n;l--){var y=u[l];if(y){var B=y.details;y=B?B.totalduration/B.fragments.length:k;B=!!B&&B.live;var E=l<=d?w*t:x*t;var G=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,D=G*y/E;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(E)+"/"+G+"/"+y+"/"+v+"/"+D),E>G&&(!D||B&&!this.bitrateTestDelay||D<v))return l}}return-1},m}(p.default);C.default=a}).call(this,z(2).Number)},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});
var A=z(61);F=function(){function q(g,p,r,h){this.hls=g;this.defaultEstimate_=h;this.minWeight_=.001;this.minDelayMs_=50;this.slow_=new A.default(p);this.fast_=new A.default(r)}return q.prototype.sample=function(g,p){p=8E3*p/(g=Math.max(g,this.minDelayMs_));g/=1E3;this.fast_.sample(g,p);this.slow_.sample(g,p)},q.prototype.canEstimate=function(){var g=this.fast_;return g&&g.getTotalWeight()>=this.minWeight_},q.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),
this.slow_.getEstimate()):this.defaultEstimate_},q.prototype.destroy=function(){},q}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=function(){function A(q){this.alpha_=q?Math.exp(Math.log(.5)/q):0;this.totalWeight_=this.estimate_=0}return A.prototype.sample=function(q,g){var p=Math.pow(this.alpha_,q);this.estimate_=g*(1-p)+p*this.estimate_;this.totalWeight_+=q},A.prototype.getTotalWeight=function(){return this.totalWeight_},A.prototype.getEstimate=function(){return this.alpha_?
this.estimate_/(1-Math.pow(this.alpha_,this.totalWeight_)):this.estimate_},A}();C.default=F},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var m in e)e.hasOwnProperty(m)&&(a[m]=e[m])};return function(a,e){function m(){this.constructor=a}f(a,e);a.prototype=null===e?Object.create(e):(m.prototype=e.prototype,new m)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=
z(1),p=z(4),r=z(0),h=z(3),c=z(14).getMediaSource(),b=function(f){function a(e){e=f.call(this,e,g.default.MEDIA_ATTACHING,g.default.MEDIA_DETACHING,g.default.MANIFEST_PARSED,g.default.BUFFER_RESET,g.default.BUFFER_APPENDING,g.default.BUFFER_CODECS,g.default.BUFFER_EOS,g.default.BUFFER_FLUSHING,g.default.LEVEL_PTS_UPDATED,g.default.LEVEL_UPDATED)||this;return e._msDuration=null,e._levelDuration=null,e._levelTargetDuration=10,e._live=null,e._objectUrl=null,e.bufferCodecEventsExpected=0,e.onsbue=e.onSBUpdateEnd.bind(e),
e.onsbe=e.onSBUpdateError.bind(e),e.pendingTracks={},e.tracks={},e}return q(a,f),a.prototype.destroy=function(){p.default.prototype.destroy.call(this)},a.prototype.onLevelPtsUpdated=function(e){var m=this.tracks.audio;if("audio"===e.type&&m&&"audio/mpeg"===m.container&&(m=this.sourceBuffer.audio,.1<Math.abs(m.timestampOffset-e.start))){var d=m.updating;try{m.abort()}catch(k){r.logger.warn("can not abort audio buffer: "+k)}d?this.audioTimestampOffset=e.start:(r.logger.warn("change mpeg audio timestamp offset from "+
m.timestampOffset+" to "+e.start),m.timestampOffset=e.start)}},a.prototype.onManifestParsed=function(e){this.bufferCodecEventsExpected=e.altAudio?2:1;r.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},a.prototype.onMediaAttaching=function(e){if(e=this.media=e.media){var m=this.mediaSource=new c;this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);m.addEventListener("sourceopen",this.onmso);
m.addEventListener("sourceended",this.onmse);m.addEventListener("sourceclose",this.onmsc);e.src=window.URL.createObjectURL(m);this._objectUrl=e.src}},a.prototype.onMediaDetaching=function(){r.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(m){r.logger.warn("onMediaDetaching:"+m.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso);e.removeEventListener("sourceended",this.onmse);e.removeEventListener("sourceclose",
this.onmsc);this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):r.logger.warn("media.src was changed by a third party - skip cleanup"));this._objectUrl=this.media=this.mediaSource=null;this.pendingTracks={};this.tracks={};this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(g.default.MEDIA_DETACHED)},a.prototype.onMediaSourceOpen=function(){r.logger.log("media source opened");
this.hls.trigger(g.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso);this.checkPendingTracks()},a.prototype.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,m=this.pendingTracks,d=Object.keys(m).length;(d&&!e||2===d)&&(this.createSourceBuffers(m),this.pendingTracks={},this.doAppending())},a.prototype.onMediaSourceClose=function(){r.logger.log("media source closed")},a.prototype.onMediaSourceEnded=function(){r.logger.log("media source ended")},
a.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;r.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset);e.timestampOffset=this.audioTimestampOffset;delete this.audioTimestampOffset}this._needsFlush&&this.doFlush();this._needsEos&&this.checkEos();this.appending=!1;var m=this.parent;e=this.segments.reduce(function(n,l){return l.parent===m?n+1:n},0);var d={},k=this.sourceBuffer,t;for(t in k)d[t]=k[t].buffered;
this.hls.trigger(g.default.BUFFER_APPENDED,{parent:m,pending:e,timeRanges:d});this._needsFlush||this.doAppending();this.updateMediaElementDuration();0===e&&this.flushLiveBackBuffer()},a.prototype.onSBUpdateError=function(e){r.logger.error("sourceBuffer error:",e);this.hls.trigger(g.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},a.prototype.onBufferReset=function(){var e=this.sourceBuffer,m;for(m in e){var d=e[m];try{this.mediaSource.removeSourceBuffer(d),
d.removeEventListener("updateend",this.onsbue),d.removeEventListener("error",this.onsbe)}catch(k){}}this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0},a.prototype.onBufferCodecs=function(e){var m=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(e).forEach(function(k){m.pendingTracks[k]=e[k]});var d=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0);d&&"open"===d.readyState&&this.checkPendingTracks()}},a.prototype.createSourceBuffers=
function(e){var m=this.sourceBuffer,d=this.mediaSource,k;for(k in e)if(!m[k]){var t=e[k],n=t.levelCodec||t.codec,l=t.container+";codecs="+n;r.logger.log("creating sourceBuffer("+l+")");try{var v=m[k]=d.addSourceBuffer(l);v.addEventListener("updateend",this.onsbue);v.addEventListener("error",this.onsbe);this.tracks[k]={codec:n,container:t.container};t.buffer=v}catch(w){r.logger.error("error while trying to add sourceBuffer:"+w.message),this.hls.trigger(g.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,
details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:w,mimeType:l})}}this.hls.trigger(g.default.BUFFER_CREATED,{tracks:e})},a.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},a.prototype.onBufferAppendFail=function(e){r.logger.error("sourceBuffer error:",e.event);this.hls.trigger(g.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},a.prototype.onBufferEos=
function(e){var m=this.sourceBuffer;e=e.type;for(var d in m)e&&d!==e||m[d].ended||(m[d].ended=!0,r.logger.log(d+" sourceBuffer now EOS"));this.checkEos()},a.prototype.checkEos=function(){var e=this.sourceBuffer,m=this.mediaSource;if(m&&"open"===m.readyState){for(var d in e){var k=e[d];if(!k.ended)return;if(k.updating)return void(this._needsEos=!0)}r.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{m.endOfStream()}catch(t){r.logger.warn("exception while calling mediaSource.endOfStream()")}}this._needsEos=
!1},a.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type});this.flushBufferCounter=0;this.doFlush()},a.prototype.flushLiveBackBuffer=function(){if(this._live){var e=this.hls.config.liveBackBufferLength;if(isFinite(e)&&!(0>e)){var m=this.media.currentTime,d=this.sourceBuffer,k=Object.keys(d);e=m-Math.max(e,this._levelTargetDuration);for(m=k.length-1;0<=m;m--){var t=k[m],n=d[t].buffered;0<n.length&&e>n.start(0)&&this.removeBufferRange(t,d[t],
0,e)}}}},a.prototype.onLevelUpdated=function(e){e=e.details;0<e.fragments.length&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._levelTargetDuration=e.averagetargetduration||e.targetduration||10,this._live=e.live,this.updateMediaElementDuration())},a.prototype.updateMediaElementDuration=function(){var e=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(m in this.sourceBuffer)if(!0===
this.sourceBuffer[m].updating)return;var m=this.media.duration;null===this._msDuration&&(this._msDuration=this.mediaSource.duration);!0===this._live&&!0===e.liveDurationInfinity?(r.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>m||!A.isFinite(m))&&(r.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},
a.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift();this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;e=0;var m=this.sourceBuffer;try{for(var d in m)e+=m[d].buffered.length}catch(k){r.logger.error("error while accessing sourceBuffer.buffered")}this.appended=e;this.hls.trigger(g.default.BUFFER_FLUSHED)}},a.prototype.doAppending=function(){var e=
this.hls,m=this.segments,d=this.sourceBuffer;if(Object.keys(d).length){if(this.media.error)return this.segments=[],void r.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending&&m&&m.length){var k=m.shift();try{var t=d[k.type];t?t.updating?m.unshift(k):(t.ended=!1,this.parent=k.parent,t.appendBuffer(k.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(n){r.logger.error("error while trying to append buffer:"+n.message),
m.unshift(k),m={type:h.ErrorTypes.MEDIA_ERROR,parent:k.parent},22!==n.code?(this.appendError?this.appendError++:this.appendError=1,m.details=h.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(r.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],m.fatal=!0,e.trigger(g.default.ERROR,m)):(m.fatal=!1,e.trigger(g.default.ERROR,m))):(this.segments=[],m.details=h.ErrorDetails.BUFFER_FULL_ERROR,m.fatal=!1,e.trigger(g.default.ERROR,
m))}}}},a.prototype.flushBuffer=function(e,m,d){var k,t=this.sourceBuffer;if(Object.keys(t).length){if(r.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+m),this.flushBufferCounter<this.appended)for(var n in t){if(!d||n===d){if((k=t[n]).ended=!1,k.updating)return r.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,k,e,m))return this.flushBufferCounter++,!1}}else r.logger.warn("abort flushing too many retries");r.logger.log("buffer flushed")}return!0},
a.prototype.removeBufferRange=function(e,m,d,k){try{for(var t=0;t<m.buffered.length;t++){var n=m.buffered.start(t),l=m.buffered.end(t),v=Math.max(n,d),w=Math.min(l,k);if(.5<Math.min(w,l)-v)return r.logger.log("sb remove "+e+" ["+v+","+w+"], of ["+n+","+l+"], pos:"+this.media.currentTime),m.remove(v,w),!0}}catch(x){r.logger.warn("removeBufferRange failed",x)}return!1},a}(p.default);C.default=b}).call(this,z(2).Number)},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var r=Object.setPrototypeOf||
{__proto__:[]}instanceof Array&&function(h,c){h.__proto__=c}||function(h,c){for(var b in c)c.hasOwnProperty(b)&&(h[b]=c[b])};return function(h,c){function b(){this.constructor=h}r(h,c);h.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(1),p=function(r){function h(c){c=r.call(this,c,g.default.FPS_DROP_LEVEL_CAPPING,g.default.MEDIA_ATTACHING,g.default.MANIFEST_PARSED,g.default.BUFFER_CODECS,g.default.MEDIA_DETACHING)||this;
return c.autoLevelCapping=A.POSITIVE_INFINITY,c.firstLevel=null,c.levels=[],c.media=null,c.restrictedLevels=[],c.timer=null,c}return q(h,r),h.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},h.prototype.onFpsDropLevelCapping=function(c){h.isLevelAllowed(c.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(c.droppedLevel)},h.prototype.onMediaAttaching=function(c){this.media=c.media instanceof window.HTMLVideoElement?c.media:null},
h.prototype.onManifestParsed=function(c){var b=this.hls;this.restrictedLevels=[];this.levels=c.levels;this.firstLevel=c.firstLevel;b.config.capLevelToPlayerSize&&c.video&&this._startCapping()},h.prototype.onBufferCodecs=function(c){this.hls.config.capLevelToPlayerSize&&c.video&&this._startCapping()},h.prototype.onLevelsUpdated=function(c){this.levels=c.levels},h.prototype.onMediaDetaching=function(){this._stopCapping()},h.prototype.detectPlayerSize=function(){if(this.media){var c=this.levels?this.levels.length:
0;if(c){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(c-1);b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch();this.autoLevelCapping=b.autoLevelCapping}}},h.prototype.getMaxLevel=function(c){var b=this;if(!this.levels)return-1;var f=this.levels.filter(function(a,e){return h.isLevelAllowed(e,b.restrictedLevels)&&e<=c});return h.getMaxLevelByMediaSize(f,this.mediaWidth,this.mediaHeight)},h.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=A.POSITIVE_INFINITY,
this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1E3),this.detectPlayerSize())},h.prototype._stopCapping=function(){this.restrictedLevels=[];this.firstLevel=null;this.autoLevelCapping=A.POSITIVE_INFINITY;this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(h.prototype,"mediaWidth",{get:function(){var c,b=this.media;return b&&(c=b.width||b.clientWidth||b.offsetWidth,c*=h.contentScaleFactor),
c},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"mediaHeight",{get:function(){var c,b=this.media;return b&&(c=b.height||b.clientHeight||b.offsetHeight,c*=h.contentScaleFactor),c},enumerable:!0,configurable:!0}),Object.defineProperty(h,"contentScaleFactor",{get:function(){var c=1;try{c=window.devicePixelRatio}catch(b){}return c},enumerable:!0,configurable:!0}),h.isLevelAllowed=function(c,b){return void 0===b&&(b=[]),-1===b.indexOf(c)},h.getMaxLevelByMediaSize=function(c,b,f){if(!c||
c&&!c.length)return-1;for(var a=c.length-1,e=0;e<c.length;e+=1){var m=c[e],d;if(d=m.width>=b||m.height>=f)d=c[e+1],d=!d||m.width!==d.width||m.height!==d.height;if(d){a=e;break}}return a},h}(z(4).default);C.default=p}).call(this,z(2).Number)},function(F,C,z){var A=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,c){h.__proto__=c}||function(h,c){for(var b in c)c.hasOwnProperty(b)&&(h[b]=c[b])};return function(h,c){function b(){this.constructor=
h}r(h,c);h.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}}();Object.defineProperty(C,"__esModule",{value:!0});var q=z(1);F=z(4);var g=z(0),p=window.performance;z=function(r){function h(c){return r.call(this,c,q.default.MEDIA_ATTACHING)||this}return A(h,r),h.prototype.destroy=function(){this.timer&&clearInterval(this.timer);this.isVideoPlaybackQualityAvailable=!1},h.prototype.onMediaAttaching=function(c){var b=this.hls.config;b.capLevelOnFPSDrop&&("function"==typeof(this.video=
c.media instanceof window.HTMLVideoElement?c.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod))},h.prototype.checkFPS=function(c,b,f){c=p.now();if(b){if(this.lastTime){var a=f-this.lastDroppedFrames,e=b-this.lastDecodedFrames,m=1E3*a/(c-this.lastTime),d=this.hls;if(d.trigger(q.default.FPS_DROP,{currentDropped:a,currentDecoded:e,totalDroppedFrames:f}),0<m&&a>
d.config.fpsDroppedMonitoringThreshold*e)a=d.currentLevel,g.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),0<a&&(-1===d.autoLevelCapping||d.autoLevelCapping>=a)&&(--a,d.trigger(q.default.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:d.currentLevel}),d.autoLevelCapping=a,d.streamController.nextLevelSwitch())}this.lastTime=c;this.lastDroppedFrames=f;this.lastDecodedFrames=b}},h.prototype.checkFPSInterval=function(){var c=this.video;if(c)if(this.isVideoPlaybackQualityAvailable){var b=
c.getVideoPlaybackQuality();this.checkFPS(c,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(c,c.webkitDecodedFrameCount,c.webkitDroppedFrameCount)},h}(F.default);C.default=z},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(0),q=window.performance,g=window.XMLHttpRequest;F=function(){function p(r){r&&r.xhrSetup&&(this.xhrSetup=r.xhrSetup)}return p.prototype.destroy=function(){this.abort();this.loader=null},p.prototype.abort=function(){var r=this.loader;r&&4!==r.readyState&&
(this.stats.aborted=!0,r.abort());window.clearTimeout(this.requestTimeout);this.requestTimeout=null;window.clearTimeout(this.retryTimeout);this.retryTimeout=null},p.prototype.load=function(r,h,c){this.context=r;this.config=h;this.callbacks=c;this.stats={trequest:q.now(),retry:0};this.retryDelay=h.retryDelay;this.loadInternal()},p.prototype.loadInternal=function(){var r=this.context;var h=this.loader=new g;var c=this.stats;c.tfirst=0;c.loaded=0;c=this.xhrSetup;try{if(c)try{c(h,r.url)}catch(b){h.open("GET",
r.url,!0),c(h,r.url)}h.readyState||h.open("GET",r.url,!0)}catch(b){return void this.callbacks.onError({code:h.status,text:b.message},r,h)}r.rangeEnd&&h.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1));h.onreadystatechange=this.readystatechange.bind(this);h.onprogress=this.loadprogress.bind(this);h.responseType=r.responseType;this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout);h.send()},p.prototype.readystatechange=function(r){var h=r.currentTarget,
c=h.readyState,b=this.stats,f=this.context;r=this.config;if(!b.aborted&&2<=c)if(window.clearTimeout(this.requestTimeout),0===b.tfirst&&(b.tfirst=Math.max(q.now(),b.trequest)),4===c)if(c=h.status,200<=c&&300>c){b.tload=Math.max(b.tfirst,q.now());var a=void 0,e=void 0;if("arraybuffer"===f.responseType){var m=this;handleHlsVideo(h,function(d){a=d;e=a.byteLength;b.loaded=b.total=a;if(m.callbacks)m.callbacks.onSuccess({url:h.responseURL,data:a},b,f,h)})}else e="arraybuffer"===f.responseType?(a=h.response).byteLength:
(a=h.responseText).length,b.loaded=b.total=e,this.callbacks.onSuccess({url:h.responseURL,data:a},b,f,h)}else b.retry>=r.maxRetry||400<=c&&499>c?(A.logger.error(c+" while loading "+f.url),this.callbacks.onError({code:c,text:h.statusText},f,h)):(A.logger.warn(c+" while loading "+f.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,r.maxRetryDelay),b.retry++);else this.requestTimeout=
window.setTimeout(this.loadtimeout.bind(this),r.timeout)},p.prototype.loadtimeout=function(){A.logger.warn("timeout while loading "+this.context.url);this.callbacks.onTimeout(this.stats,this.context,null)},p.prototype.loadprogress=function(r){var h=r.currentTarget,c=this.stats;c.loaded=r.loaded;r.lengthComputable&&(c.total=r.total);(r=this.callbacks.onProgress)&&r(c,this.context,null,h)},p}();C.default=F},function(F,C,z){var A=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof
Array&&function(h,c){h.__proto__=c}||function(h,c){for(var b in c)c.hasOwnProperty(b)&&(h[b]=c[b])};return function(h,c){function b(){this.constructor=h}r(h,c);h.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}}();Object.defineProperty(C,"__esModule",{value:!0});var q=z(1);F=z(28);var g=z(0),p=z(3);z=function(r){function h(c){c=r.call(this,c,q.default.MANIFEST_LOADING,q.default.MANIFEST_PARSED,q.default.AUDIO_TRACK_LOADED,q.default.AUDIO_TRACK_SWITCHED,q.default.LEVEL_LOADED,q.default.ERROR)||
this;return c._trackId=-1,c._selectDefaultTrack=!0,c.tracks=[],c.trackIdBlacklist=Object.create(null),c.audioGroupId=null,c}return A(h,r),h.prototype.onManifestLoading=function(){this.tracks=[];this._trackId=-1;this._selectDefaultTrack=!0},h.prototype.onManifestParsed=function(c){c=this.tracks=c.audioTracks||[];this.hls.trigger(q.default.AUDIO_TRACKS_UPDATED,{audioTracks:c})},h.prototype.onAudioTrackLoaded=function(c){c.id>=this.tracks.length?g.logger.warn("Invalid audio track id:",c.id):((g.logger.log("audioTrack "+
c.id+" loaded"),this.tracks[c.id].details=c.details,c.details.live&&!this.hasInterval())&&this.setInterval(1E3*c.details.targetduration),!c.details.live&&this.hasInterval()&&this.clearInterval())},h.prototype.onAudioTrackSwitched=function(c){(c=this.tracks[c.id].groupId)&&this.audioGroupId!==c&&(this.audioGroupId=c)},h.prototype.onLevelLoaded=function(c){c=this.hls.levels[c.level];c.audioGroupIds&&(c=c.audioGroupIds[c.urlId],this.audioGroupId!==c&&(this.audioGroupId=c,this._selectInitialAudioTrack()))},
h.prototype.onError=function(c){c.type===p.ErrorTypes.NETWORK_ERROR&&(c.fatal&&this.clearInterval(),c.details===p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(g.logger.warn("Network failure on audio-track id:",c.context.id),this._handleLoadError()))},Object.defineProperty(h.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"audioTrack",{get:function(){return this._trackId},set:function(c){this._setAudioTrack(c);this._selectDefaultTrack=
!1},enumerable:!0,configurable:!0}),h.prototype._setAudioTrack=function(c){if(this._trackId===c&&this.tracks[this._trackId].details)g.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(0>c||c>=this.tracks.length)g.logger.warn("Invalid id passed to audio-track controller");else{var b=this.tracks[c];g.logger.log("Now switching to audio-track index "+c);this.clearInterval();this._trackId=c;this.hls.trigger(q.default.AUDIO_TRACK_SWITCHING,{id:b.id,type:b.type,
url:b.url});this._loadTrackDetailsIfNeeded(b)}},h.prototype.doTick=function(){this._updateTrack(this._trackId)},h.prototype._selectInitialAudioTrack=function(){var c=this,b=this.tracks;if(b.length){var f=this.tracks[this._trackId],a=null;if(f&&(a=f.name),this._selectDefaultTrack)f=b.filter(function(m){return m.default}),f.length?b=f:g.logger.warn("No default audio tracks defined");var e=!1;f=function(){b.forEach(function(m){e||c.audioGroupId&&m.groupId!==c.audioGroupId||a&&a!==m.name||(c._setAudioTrack(m.id),
e=!0)})};f();e||(a=null,f());e||(g.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(q.default.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},h.prototype._needsTrackLoading=function(c){var b=c.details;c=c.url;return!(b&&!b.live)&&!!c},h.prototype._loadTrackDetailsIfNeeded=function(c){if(this._needsTrackLoading(c)){var b=c.url;c=c.id;g.logger.log("loading audio-track playlist for id: "+c);this.hls.trigger(q.default.AUDIO_TRACK_LOADING,
{url:b,id:c})}},h.prototype._updateTrack=function(c){0>c||c>=this.tracks.length||(this.clearInterval(),this._trackId=c,g.logger.log("trying to update audio-track "+c),this._loadTrackDetailsIfNeeded(this.tracks[c]))},h.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var c=this._trackId,b=this.tracks[c],f=b.name,a=b.language;g.logger.warn("Loading failed on audio track id: "+c+", group-id: "+b.groupId+', name/language: "'+f+'" / "'+a+'"');b=c;for(var e=0;e<this.tracks.length;e++)if(!this.trackIdBlacklist[e]&&
this.tracks[e].name===f){b=e;break}b!==c?(g.logger.log("Attempting audio-track fallback id:",b,"group-id:",this.tracks[b].groupId),this._setAudioTrack(b)):g.logger.warn('No fallback audio-track found for name/language: "'+f+'" / "'+a+'"')},h}(F.default);C.default=z},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,w){v.__proto__=w}||function(v,w){for(var x in w)w.hasOwnProperty(x)&&(v[x]=w[x])};return function(v,
w){function x(){this.constructor=v}l(v,w);v.prototype=null===w?Object.create(w):(x.prototype=w.prototype,new x)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(10),p=z(5),r=z(20),h=z(1),c=z(8),b=z(25),f=z(3),a=z(0),e=z(26),m=z(7),d=z(12),k=z(15),t=window.performance,n=function(l){function v(w,x){var u=l.call(this,w,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.AUDIO_TRACKS_UPDATED,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,
h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.BUFFER_RESET,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED,h.default.INIT_PTS_FOUND)||this;return u.fragmentTracker=x,u.config=w.config,u.audioCodecSwap=!1,u._state=k.State.STOPPED,u.initPTS=[],u.waitingFragment=null,u.videoTrackCC=null,u}return q(v,l),v.prototype.onInitPtsFound=function(w){var x=w.frag.cc,u=w.initPTS;"main"===w.id&&(this.initPTS[x]=u,this.videoTrackCC=
x,a.logger.log("InitPTS for cc: "+x+" found from video track: "+u),this.state===k.State.WAITING_INIT_PTS&&this.tick())},v.prototype.startLoad=function(w){if(this.tracks){var x=this.lastCurrentTime;this.stopLoad();this.setInterval(100);this.fragLoadError=0;0<x&&-1===w?(a.logger.log("audio:override startPosition with lastCurrentTime @"+x.toFixed(3)),this.state=k.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:w,this.state=k.State.STARTING);this.nextLoadPosition=this.startPosition=
this.lastCurrentTime;this.tick()}else this.startPosition=w,this.state=k.State.STOPPED},Object.defineProperty(v.prototype,"state",{get:function(){return this._state},set:function(w){if(this.state!==w){var x=this.state;this._state=w;a.logger.log("audio stream:"+x+"->"+w)}},enumerable:!0,configurable:!0}),v.prototype.doTick=function(){var w=this.hls,x=w.config;switch(this.state){case k.State.STARTING:this.state=k.State.WAITING_TRACK;this.loadedmetadata=!1;break;case k.State.IDLE:var u=this.tracks;if(!u)break;
if(!this.media&&(this.startFragRequested||!x.startFragPrefetch))break;if(this.loadedmetadata)var y=this.media.currentTime;else if(void 0===(y=this.nextLoadPosition))break;var B=this.mediaBuffer?this.mediaBuffer:this.media,E=this.videoBuffer?this.videoBuffer:this.media,G=p.BufferHelper.bufferInfo(B,y,x.maxBufferHole),D=p.BufferHelper.bufferInfo(E,y,x.maxBufferHole),I=G.end;B=this.fragPrevious;E=this.audioSwitch;var J=this.trackId;if((G.len<Math.max(Math.min(x.maxBufferLength,x.maxMaxBufferLength),
D.len)||E)&&J<u.length)if(void 0===(u=u[J].details))this.state=k.State.WAITING_TRACK;else{if(!E&&this._streamEnded(G,u))return this.hls.trigger(h.default.BUFFER_EOS,{type:"audio"}),void(this.state=k.State.ENDED);D=u.fragments;var K=D.length,H=D[0].start,M=D[K-1].start+D[K-1].duration,L=void 0;if(E)if(u.live&&!u.PTSKnown)a.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),I=0;else if(I=y,u.PTSKnown&&y<H){if(!(G.end>H||G.nextStart))break;a.logger.log("alt audio track ahead of main track, seek to start of alt audio track");
this.media.currentTime=H+.05}if(u.initSegment&&!u.initSegment.data)L=u.initSegment;else if(I<=H){if(L=D[0],null!==this.videoTrackCC&&L.cc!==this.videoTrackCC&&(L=e.findFragWithCC(D,this.videoTrackCC)),u.live&&L.loadIdx&&L.loadIdx===this.fragLoadIdx)return w=G.nextStart?G.nextStart:H,a.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(w+.05)),void(this.media.currentTime=w+.05)}else{G=void 0;var O=x.maxFragLookUpTolerance;x=B?D[B.sn-D[0].sn+1]:void 0;H=function(N){var P=
Math.min(O,N.duration);return N.start+N.duration-P<=I?1:N.start-P>I&&N.start?-1:0};I<M?(I>M-O&&(O=0),G=x&&!H(x)?x:g.default.search(D,H)):G=D[K-1];G&&(L=G,H=G.start,B&&L.level===B.level&&L.sn===B.sn&&(L.sn<u.endSN?(L=D[L.sn+1-u.startSN],a.logger.log("SN just loaded, load next one: "+L.sn)):L=null))}L&&(L.encrypted?(a.logger.log("Loading key for "+L.sn+" of ["+u.startSN+" ,"+u.endSN+"],track "+J),this.state=k.State.KEY_LOADING,w.trigger(h.default.KEY_LOADING,{frag:L})):(a.logger.log("Loading "+L.sn+
", cc: "+L.cc+" of ["+u.startSN+" ,"+u.endSN+"],track "+J+", currentTime:"+y+",bufferEnd:"+I.toFixed(3)),this.fragCurrent=L,(E||this.fragmentTracker.getState(L)===m.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,A.isFinite(L.sn)&&(this.nextLoadPosition=L.start+L.duration),w.trigger(h.default.FRAG_LOADING,{frag:L}),this.state=k.State.FRAG_LOADING)))}break;case k.State.WAITING_TRACK:(y=this.tracks[this.trackId])&&y.details&&(this.state=k.State.IDLE);break;case k.State.FRAG_LOADING_WAITING_RETRY:w=
t.now();y=this.retryDate;x=(B=this.media)&&B.seeking;(!y||w>=y||x)&&(a.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=k.State.IDLE);break;case k.State.WAITING_INIT_PTS:w=this.videoTrackCC,void 0!==this.initPTS[w]&&((x=this.waitingFragment)?(x=x.frag.cc,w!==x?(y=this.tracks[this.trackId]).details&&y.details.live&&(a.logger.warn("Waiting fragment CC ("+x+") does not match video track CC ("+w+")"),this.waitingFragment=null,this.state=k.State.IDLE):(this.state=
k.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)):this.state=k.State.IDLE)}},v.prototype.onMediaAttached=function(w){w=this.media=this.mediaBuffer=w.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);w.addEventListener("seeking",this.onvseeking);w.addEventListener("ended",this.onvended);w=this.config;this.tracks&&w.autoStartLoad&&this.startLoad(w.startPosition)},v.prototype.onMediaDetaching=function(){var w=this.media;
w&&w.ended&&(a.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);w&&(w.removeEventListener("seeking",this.onvseeking),w.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null);this.media=this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=!1;this.stopLoad()},v.prototype.onAudioTracksUpdated=function(w){a.logger.log("audio tracks updated");this.tracks=w.audioTracks},v.prototype.onAudioTrackSwitching=
function(w){var x=!!w.url;this.trackId=w.id;this.fragCurrent=null;this.state=k.State.PAUSED;this.waitingFragment=null;x?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null);x&&(this.audioSwitch=!0,this.state=k.State.IDLE);this.tick()},v.prototype.onAudioTrackLoaded=function(w){var x=w.details,u=w.id;w=this.tracks[u];var y=0;(a.logger.log("track "+u+" loaded ["+x.startSN+","+x.endSN+"],duration:"+x.totalduration),x.live)?(u=w.details)&&0<x.fragments.length?(c.mergeDetails(u,
x),y=x.fragments[0].start,x.PTSKnown?a.logger.log("live audio playlist sliding:"+y.toFixed(3)):a.logger.log("live audio playlist - outdated PTS, unknown sliding")):(x.PTSKnown=!1,a.logger.log("live audio playlist - first load, unknown sliding")):x.PTSKnown=!1;(w.details=x,this.startFragRequested)||(-1===this.startPosition&&(x=x.startTimeOffset,A.isFinite(x)?(a.logger.log("start time offset found in playlist, adjust startPosition to "+x),this.startPosition=x):this.startPosition=0),this.nextLoadPosition=
this.startPosition);this.state===k.State.WAITING_TRACK&&(this.state=k.State.IDLE);this.tick()},v.prototype.onKeyLoaded=function(){this.state===k.State.KEY_LOADING&&(this.state=k.State.IDLE,this.tick())},v.prototype.onFragLoaded=function(w){var x=this.fragCurrent,u=w.frag;if(this.state===k.State.FRAG_LOADING&&x&&"audio"===u.type&&u.level===x.level&&u.sn===x.sn){var y=this.tracks[this.trackId];u=y.details;var B=u.totalduration,E=x.level,G=x.sn,D=x.cc;y=this.config.defaultAudioCodec||y.audioCodec||"mp4a.40.2";
var I=this.stats=w.stats;if("initSegment"===G)this.state=k.State.IDLE,I.tparsed=I.tbuffered=t.now(),u.initSegment.data=w.payload,this.hls.trigger(h.default.FRAG_BUFFERED,{stats:I,frag:x,id:"audio"}),this.tick();else{this.state=k.State.PARSING;this.appended=!1;this.demuxer||(this.demuxer=new r.default(this.hls,"audio"));I=this.initPTS[D];var J=u.initSegment?u.initSegment.data:[];u.initSegment||void 0!==I?(this.pendingBuffering=!0,a.logger.log("Demuxing "+G+" of ["+u.startSN+" ,"+u.endSN+"],track "+
E),this.demuxer.push(w.payload,J,y,null,x,B,!1,I)):(a.logger.log("unknown video PTS for continuity counter "+D+", waiting for video PTS before demuxing audio frag "+G+" of ["+u.startSN+" ,"+u.endSN+"],track "+E),this.waitingFragment=w,this.state=k.State.WAITING_INIT_PTS)}}this.fragLoadError=0},v.prototype.onFragParsingInitSegment=function(w){var x=this.fragCurrent,u=w.frag;if(x&&"audio"===w.id&&u.sn===x.sn&&u.level===x.level&&this.state===k.State.PARSING&&(x=w.tracks,x.video&&delete x.video,u=x.audio)){u.levelCodec=
u.codec;u.id=w.id;this.hls.trigger(h.default.BUFFER_CODECS,x);a.logger.log("audio track:audio,container:"+u.container+",codecs[level/parsed]=["+u.levelCodec+"/"+u.codec+"]");if(w=u.initSegment)w={type:"audio",data:w,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[w]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,w));this.tick()}},v.prototype.onFragParsingData=function(w){var x=this,u=this.fragCurrent,y=w.frag;if(u&&"audio"===w.id&&"audio"===
w.type&&y.sn===u.sn&&y.level===u.level&&this.state===k.State.PARSING){y=this.trackId;var B=this.tracks[y],E=this.hls;A.isFinite(w.endPTS)||(w.endPTS=w.startPTS+u.duration,w.endDTS=w.startDTS+u.duration);u.addElementaryStream(d.default.ElementaryStreamTypes.AUDIO);a.logger.log("parsed "+w.type+",PTS:["+w.startPTS.toFixed(3)+","+w.endPTS.toFixed(3)+"],DTS:["+w.startDTS.toFixed(3)+"/"+w.endDTS.toFixed(3)+"],nb:"+w.nb);c.updateFragPTSDTS(B.details,u,w.startPTS,w.endPTS);B=this.media;u=!1;this.audioSwitch&&
B&&(B.readyState?(B=B.currentTime,a.logger.log("switching audio track : currentTime:"+B),B>=w.startPTS&&(a.logger.log("switching audio track : flushing all audio"),this.state=k.State.BUFFER_FLUSHING,E.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:A.POSITIVE_INFINITY,type:"audio"}),u=!0,this.audioSwitch=!1,E.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:y}))):(this.audioSwitch=!1,E.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:y})));var G=this.pendingData;if(!G)return a.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),
void E.trigger(h.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([w.data1,w.data2].forEach(function(D){D&&D.length&&G.push({type:w.type,data:D,parent:"audio",content:"data"})}),!u&&G.length&&(G.forEach(function(D){x.state===k.State.PARSING&&(x.pendingBuffering=!0,x.hls.trigger(h.default.BUFFER_APPENDING,D))}),this.pendingData=[],this.appended=!0));this.tick()}},v.prototype.onFragParsed=function(w){var x=this.fragCurrent,u=w.frag;x&&"audio"===w.id&&u.sn===x.sn&&
u.level===x.level&&this.state===k.State.PARSING&&(this.stats.tparsed=t.now(),this.state=k.State.PARSED,this._checkAppendedParsed())},v.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null;this.loadedmetadata=!1},v.prototype.onBufferCreated=function(w){var x=w.tracks.audio;x&&(this.mediaBuffer=x.buffer,this.loadedmetadata=!0);w.tracks.video&&(this.videoBuffer=w.tracks.video.buffer)},v.prototype.onBufferAppended=function(w){if("audio"===w.parent){var x=this.state;x!==k.State.PARSING&&
x!==k.State.PARSED||(this.pendingBuffering=0<w.pending,this._checkAppendedParsed())}},v.prototype._checkAppendedParsed=function(){if(!(this.state!==k.State.PARSED||this.appended&&this.pendingBuffering)){var w=this.fragCurrent,x=this.stats,u=this.hls;w&&(this.fragPrevious=w,x.tbuffered=t.now(),u.trigger(h.default.FRAG_BUFFERED,{stats:x,frag:w,id:"audio"}),a.logger.log("audio buffered : "+b.default.toString((this.mediaBuffer?this.mediaBuffer:this.media).buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=
!1,u.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=k.State.IDLE);this.tick()}},v.prototype.onError=function(w){var x=w.frag;if(!x||"audio"===x.type)switch(w.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:var u=w.frag;if(u&&"audio"!==u.type)break;w.fatal||(x=this.fragLoadError,(x?x++:x=1,x<=(u=this.config).fragLoadingMaxRetry)?(this.fragLoadError=x,u=Math.min(Math.pow(2,x-1)*u.fragLoadingRetryDelay,u.fragLoadingMaxRetryTimeout),a.logger.warn("AudioStreamController: frag loading failed, retry in "+
u+" ms"),this.retryDate=t.now()+u,this.state=k.State.FRAG_LOADING_WAITING_RETRY):(a.logger.error("AudioStreamController: "+w.details+" reaches max retry, redispatch as fatal ..."),w.fatal=!0,this.state=k.State.ERROR));break;case f.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case f.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==k.State.ERROR&&(this.state=w.fatal?k.State.ERROR:k.State.IDLE,a.logger.warn("AudioStreamController: "+w.details+
" while loading frag, now switching to "+this.state+" state ..."));break;case f.ErrorDetails.BUFFER_FULL_ERROR:"audio"!==w.parent||this.state!==k.State.PARSING&&this.state!==k.State.PARSED||(w=this.mediaBuffer,x=this.media.currentTime,w&&p.BufferHelper.isBuffered(w,x)&&p.BufferHelper.isBuffered(w,x+.5)?((u=this.config).maxMaxBufferLength>=u.maxBufferLength&&(u.maxMaxBufferLength/=2,a.logger.warn("AudioStreamController: reduce max buffer length to "+u.maxMaxBufferLength+"s")),this.state=k.State.IDLE):
(a.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=k.State.BUFFER_FLUSHING,this.hls.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:A.POSITIVE_INFINITY,type:"audio"})))}},v.prototype.onBufferFlushed=function(){var w=this,x=this.pendingData;x&&x.length?(a.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),x.forEach(function(u){w.hls.trigger(h.default.BUFFER_APPENDING,
u)}),this.appended=!0,this.pendingData=[],this.state=k.State.PARSED):(this.state=k.State.IDLE,this.fragPrevious=null,this.tick())},v}(k.default);C.default=n}).call(this,z(2).Number)},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A=z(30);C.newCue=function(q,g,p,r){for(var h,c,b,f,a=window.VTTCue||window.TextTrackCue,e=0;e<r.rows.length;e++)if(c=!0,b=0,f="",!(h=r.rows[e]).isEmpty()){for(var m=0;m<h.chars.length;m++)h.chars[m].uchar.match(/\s/)&&c?b++:(f+=h.chars[m].uchar,c=!1);
h.cueStartTime=g;g===p&&(p+=1E-4);h=new a(g,p,A.fixLineBreaks(f.trim()));16<=b?b--:b++;navigator.userAgent.match(/Firefox\//)?h.line=e+1:h.line=7<e?e-2:e+1;h.align="left";h.position=Math.max(0,Math.min(100,b/32*100+(navigator.userAgent.match(/Firefox\//)?50:0)));q.addCue(h)}}},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});C.default=function(){function A(h){return"string"==typeof h&&!!r[h.toLowerCase()]&&h.toLowerCase()}function q(h){for(var c=1;c<arguments.length;c++){var b=arguments[c],
f;for(f in b)h[f]=b[f]}return h}function g(h,c,b){var f=this;var a="undefined"!=typeof navigator?/MSIE\s8\.0/.test(navigator.userAgent):void 0;var e={};a?f=document.createElement("custom"):e.enumerable=!0;f.hasBeenReset=!1;var m="",d=!1,k=h,t=c,n=b,l=null,v="",w=!0,x="auto",u="start",y=50,B="middle",E=50,G="middle";if(Object.defineProperty(f,"id",q({},e,{get:function(){return m},set:function(D){m=""+D}})),Object.defineProperty(f,"pauseOnExit",q({},e,{get:function(){return d},set:function(D){d=!!D}})),
Object.defineProperty(f,"startTime",q({},e,{get:function(){return k},set:function(D){if("number"!=typeof D)throw new TypeError("Start time must be set to a number.");k=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",q({},e,{get:function(){return t},set:function(D){if("number"!=typeof D)throw new TypeError("End time must be set to a number.");t=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"text",q({},e,{get:function(){return n},set:function(D){n=""+D;this.hasBeenReset=!0}})),Object.defineProperty(f,
"region",q({},e,{get:function(){return l},set:function(D){l=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",q({},e,{get:function(){return v},set:function(D){D="string"==typeof D&&!!p[D.toLowerCase()]&&D.toLowerCase();if(!1===D)throw new SyntaxError("An invalid or illegal string was specified.");v=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",q({},e,{get:function(){return w},set:function(D){w=!!D;this.hasBeenReset=!0}})),Object.defineProperty(f,"line",q({},e,{get:function(){return x},
set:function(D){if("number"!=typeof D&&"auto"!==D)throw new SyntaxError("An invalid number or illegal string was specified.");x=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",q({},e,{get:function(){return u},set:function(D){D=A(D);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");u=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"position",q({},e,{get:function(){return y},set:function(D){if(0>D||100<D)throw Error("Position must be between 0 and 100.");y=
D;this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",q({},e,{get:function(){return B},set:function(D){D=A(D);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");B=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"size",q({},e,{get:function(){return E},set:function(D){if(0>D||100<D)throw Error("Size must be between 0 and 100.");E=D;this.hasBeenReset=!0}})),Object.defineProperty(f,"align",q({},e,{get:function(){return G},set:function(D){D=A(D);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");
G=D;this.hasBeenReset=!0}})),f.displayState=void 0,a)return f}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var p={"":!0,lr:!0,rl:!0},r={start:!0,middle:!0,end:!0,left:!0,right:!0};return g.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},g}()},function(F,C,z){(function(A){var q=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,d){m.__proto__=d}||function(m,d){for(var k in d)d.hasOwnProperty(k)&&
(m[k]=d[k])};return function(m,d){function k(){this.constructor=m}e(m,d);m.prototype=null===d?Object.create(d):(k.prototype=d.prototype,new k)}}();Object.defineProperty(C,"__esModule",{value:!0});var g=z(1),p=z(4),r=z(71),h=z(72),c=z(73),b=z(0),f=z(29),a=function(e){function m(d){var k=e.call(this,d,g.default.MEDIA_ATTACHING,g.default.MEDIA_DETACHING,g.default.FRAG_PARSING_USERDATA,g.default.FRAG_DECRYPTED,g.default.MANIFEST_LOADING,g.default.MANIFEST_LOADED,g.default.FRAG_LOADED,g.default.LEVEL_SWITCHING,
g.default.INIT_PTS_FOUND)||this;if(k.hls=d,k.config=d.config,k.enabled=!0,k.Cues=d.config.cueHandler,k.textTracks=[],k.tracks=[],k.unparsedVttFrags=[],k.initPTS=[],k.cueRanges=[],k.captionsTracks={},k.captionsProperties={textTrack1:{label:k.config.captionsTextTrack1Label,languageCode:k.config.captionsTextTrack1LanguageCode},textTrack2:{label:k.config.captionsTextTrack2Label,languageCode:k.config.captionsTextTrack2LanguageCode}},k.config.enableCEA708Captions){d=new h.default(k,"textTrack1");var t=
new h.default(k,"textTrack2");k.cea608Parser=new r.default(0,d,t)}return k}return q(m,e),m.prototype.addCues=function(d,k,t,n){for(var l=this.cueRanges,v=!1,w=l.length;w--;){var x=l[w],u=Math.min(x[1],t)-Math.max(x[0],k);if(0<=u&&(x[0]=Math.min(x[0],k),x[1]=Math.max(x[1],t),v=!0,.5<u/(t-k)))return}v||l.push([k,t]);this.Cues.newCue(this.captionsTracks[d],k,t,n)},m.prototype.onInitPtsFound=function(d){var k=this;if("main"===d.id&&(this.initPTS[d.frag.cc]=d.initPTS),this.unparsedVttFrags.length)d=this.unparsedVttFrags,
this.unparsedVttFrags=[],d.forEach(function(t){k.onFragLoaded(t)})},m.prototype.getExistingTrack=function(d){var k=this.media;if(k)for(var t=0;t<k.textTracks.length;t++){var n=k.textTracks[t];if(n[d])return n}return null},m.prototype.createCaptionsTrack=function(d){var k=this.captionsProperties[d],t=k.label,n=k.languageCode;k=this.captionsTracks;if(!k[d]){var l=this.getExistingTrack(d);l?(k[d]=l,f.clearCurrentCues(k[d]),f.sendAddTrackEvent(k[d],this.media)):(t=this.createTextTrack("captions",t,n))&&
(t[d]=!0,k[d]=t)}},m.prototype.createTextTrack=function(d,k,t){var n=this.media;if(n)return n.addTextTrack(d,k,t)},m.prototype.destroy=function(){p.default.prototype.destroy.call(this)},m.prototype.onMediaAttaching=function(d){this.media=d.media;this._cleanTracks()},m.prototype.onMediaDetaching=function(){var d=this.captionsTracks;Object.keys(d).forEach(function(k){f.clearCurrentCues(d[k]);delete d[k]})},m.prototype.onManifestLoading=function(){this.prevCC=this.lastSn=-1;this.vttCCs={ccOffset:0,presentationOffset:0,
0:{start:0,prevCC:-1,new:!1}};this._cleanTracks()},m.prototype._cleanTracks=function(){var d=this.media;if(d&&(d=d.textTracks))for(var k=0;k<d.length;k++)f.clearCurrentCues(d[k])},m.prototype.onManifestLoaded=function(d){var k=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=d.subtitles||[];var t=this.media?this.media.textTracks:[];this.tracks.forEach(function(n,l){var v;if(l<t.length){l=null;for(var w=
0;w<t.length;w++){var x=t[w];if(x&&x.label===n.name&&!x.textTrack1&&!x.textTrack2){l=t[w];break}}l&&(v=l)}v||(v=k.createTextTrack("subtitles",n.name,n.lang));n.default?v.mode=k.hls.subtitleDisplay?"showing":"hidden":v.mode="disabled";k.textTracks.push(v)})}},m.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},m.prototype.onFragLoaded=function(d){var k=d.frag,t=d.payload;if("main"===k.type)k=k.sn,k!==this.lastSn+1&&(t=this.cea608Parser)&&t.reset(),this.lastSn=
k;else if("subtitle"===k.type)if(t.byteLength){if(!A.isFinite(this.initPTS[k.cc]))return this.unparsedVttFrags.push(d),void(this.initPTS.length&&this.hls.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:k}));d=k.decryptdata;null!=d&&null!=d.key&&"AES-128"===d.method||this._parseVTTs(k,t)}else this.hls.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:k})},m.prototype._parseVTTs=function(d,k){var t=this.vttCCs;t[d.cc]||(t[d.cc]={start:d.start,prevCC:this.prevCC,new:!0},this.prevCC=
d.cc);var n=this.textTracks,l=this.hls;c.default.parse(k,this.initPTS[d.cc],t,d.cc,function(v){var w=n[d.level];"disabled"!==w.mode?(v.forEach(function(x){if(!w.cues.getCueById(x.id))try{w.addCue(x)}catch(y){var u=new window.TextTrackCue(x.startTime,x.endTime,x.text);u.id=x.id;w.addCue(u)}}),l.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})):l.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d})},function(v){b.logger.log("Failed to parse VTT cue: "+v);l.trigger(g.default.SUBTITLE_FRAG_PROCESSED,
{success:!1,frag:d})})},m.prototype.onFragDecrypted=function(d){var k=d.payload,t=d.frag;if("subtitle"===t.type){if(!A.isFinite(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(d);this._parseVTTs(t,k)}},m.prototype.onFragParsingUserdata=function(d){if(this.enabled&&this.config.enableCEA708Captions)for(var k=0;k<d.samples.length;k++){var t=this.extractCea608Data(d.samples[k].bytes);this.cea608Parser.addData(d.samples[k].pts,t)}},m.prototype.extractCea608Data=function(d){for(var k,t,n,l=31&
d[0],v=2,w=[],x=0;x<l;x++)k=d[v++],t=127&d[v++],n=127&d[v++],0===t&&0===n||0!=(4&k)&&0===(3&k)&&(w.push(t),w.push(n));return w},m}(p.default);C.default=a}).call(this,z(2).Number)},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});var A={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,
150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},q=function(t){var n=t;return A.hasOwnProperty(t)&&
(n=A[t]),String.fromCharCode(n)},g={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},p={17:2,18:4,21:6,22:8,23:10,19:13,20:15},r={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c="white green blue cyan red yellow magenta black transparent".split(" "),b={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,n){this.verboseFilter[t];this.verboseLevel}},f=function(t){for(var n=[],l=0;l<
t.length;l++)n.push(t[l].toString(16));return n},a=function(){function t(n,l,v,w,x){this.foreground=n||"white";this.underline=l||!1;this.italics=v||!1;this.background=w||"black";this.flash=x||!1}return t.prototype.reset=function(){this.foreground="white";this.italics=this.underline=!1;this.background="black";this.flash=!1},t.prototype.setStyles=function(n){for(var l=["foreground","underline","italics","background","flash"],v=0;v<l.length;v++){var w=l[v];n.hasOwnProperty(w)&&(this[w]=n[w])}},t.prototype.isDefault=
function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},t.prototype.copy=function(n){this.foreground=n.foreground;this.underline=n.underline;this.italics=n.italics;this.background=n.background;this.flash=n.flash},t.prototype.toString=function(){return"color="+this.foreground+
", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),e=function(){function t(n,l,v,w,x,u){this.uchar=n||" ";this.penState=new a(l,v,w,x,u)}return t.prototype.reset=function(){this.uchar=" ";this.penState.reset()},t.prototype.setChar=function(n,l){this.uchar=n;this.penState.copy(l)},t.prototype.setPenState=function(n){this.penState.copy(n)},t.prototype.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},t.prototype.copy=
function(n){this.uchar=n.uchar;this.penState.copy(n.penState)},t.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),m=function(){function t(){this.chars=[];for(var n=0;100>n;n++)this.chars.push(new e);this.pos=0;this.currPenState=new a}return t.prototype.equals=function(n){for(var l=!0,v=0;100>v;v++)if(!this.chars[v].equals(n.chars[v])){l=!1;break}return l},t.prototype.copy=function(n){for(var l=0;100>l;l++)this.chars[l].copy(n.chars[l])},t.prototype.isEmpty=function(){for(var n=
!0,l=0;100>l;l++)if(!this.chars[l].isEmpty()){n=!1;break}return n},t.prototype.setCursor=function(n){this.pos!==n&&(this.pos=n);0>this.pos?(b.log("ERROR","Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(b.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},t.prototype.moveCursor=function(n){var l=this.pos+n;if(1<n)for(n=this.pos+1;n<l+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(l)},t.prototype.backSpace=function(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",
this.currPenState)},t.prototype.insertChar=function(n){144<=n&&this.backSpace();var l=q(n);100<=this.pos?b.log("ERROR","Cannot insert "+n.toString(16)+" ("+l+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(l,this.currPenState),this.moveCursor(1))},t.prototype.clearFromPos=function(n){for(;100>n;n++)this.chars[n].reset()},t.prototype.clear=function(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()},t.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},
t.prototype.getTextString=function(){for(var n=[],l=!0,v=0;100>v;v++){var w=this.chars[v].uchar;" "!==w&&(l=!1);n.push(w)}return l?"":n.join("")},t.prototype.setPenStyles=function(n){this.currPenState.setStyles(n);this.chars[this.pos].setPenState(this.currPenState)},t}(),d=function(){function t(){this.rows=[];for(var n=0;15>n;n++)this.rows.push(new m);this.currRow=14;this.nrRollUpRows=null;this.reset()}return t.prototype.reset=function(){for(var n=0;15>n;n++)this.rows[n].clear();this.currRow=14},
t.prototype.equals=function(n){for(var l=!0,v=0;15>v;v++)if(!this.rows[v].equals(n.rows[v])){l=!1;break}return l},t.prototype.copy=function(n){for(var l=0;15>l;l++)this.rows[l].copy(n.rows[l])},t.prototype.isEmpty=function(){for(var n=!0,l=0;15>l;l++)if(!this.rows[l].isEmpty()){n=!1;break}return n},t.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function(n){this.rows[this.currRow].insertChar(n)},
t.prototype.setPen=function(n){this.rows[this.currRow].setPenStyles(n)},t.prototype.moveCursor=function(n){this.rows[this.currRow].moveCursor(n)},t.prototype.setCursor=function(n){b.log("INFO","setCursor: "+n);this.rows[this.currRow].setCursor(n)},t.prototype.setPAC=function(n){b.log("INFO","pacData = "+JSON.stringify(n));var l=n.row-1;if(this.nrRollUpRows&&l<this.nrRollUpRows-1&&(l=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==l){for(var v=0;15>v;v++)this.rows[v].clear();var w=this.currRow+
1-this.nrRollUpRows,x=this.lastOutputScreen;if(x&&(v=x.rows[w].cueStartTime)&&v<b.time)for(v=0;v<this.nrRollUpRows;v++)this.rows[l-this.nrRollUpRows+v+1].copy(x.rows[w+v])}this.currRow=l;l=this.rows[this.currRow];null!==n.indent&&(w=Math.max(n.indent-1,0),l.setCursor(n.indent),n.color=l.chars[w].penState.foreground);this.setPen({foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1})},t.prototype.setBkgData=function(n){b.log("INFO","bkgData = "+JSON.stringify(n));
this.backSpace();this.setPen(n);this.insertChar(32)},t.prototype.setRollUpRows=function(n){this.nrRollUpRows=n},t.prototype.rollUp=function(){if(null!==this.nrRollUpRows){b.log("TEXT",this.getDisplayText());var n=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];n.clear();this.rows.splice(this.currRow,0,n);b.log("INFO","Rolling up")}else b.log("DEBUG","roll_up but nrRollUpRows not set yet")},t.prototype.getDisplayText=function(n){n=n||!1;for(var l=[],v="",w=-1,x=0;15>x;x++){var u=this.rows[x].getTextString();
u&&(w=x+1,n?l.push("Row "+w+": '"+u+"'"):l.push(u.trim()))}return 0<l.length&&(v=n?"["+l.join(" | ")+"]":l.join("\n")),v},t.prototype.getTextAndFormat=function(){return this.rows},t}(),k=function(){function t(n,l){this.chNr=n;this.outputFilter=l;this.mode=null;this.verbose=0;this.displayedMemory=new d;this.nonDisplayedMemory=new d;this.lastOutputScreen=new d;this.currRollUpRow=this.displayedMemory.rows[14];this.writeScreen=this.displayedMemory;this.cueStartTime=this.mode=null}return t.prototype.reset=
function(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.currRollUpRow=this.displayedMemory.rows[14];this.writeScreen=this.displayedMemory;this.lastCueEndTime=this.cueStartTime=this.mode=null},t.prototype.getHandler=function(){return this.outputFilter},t.prototype.setHandler=function(n){this.outputFilter=n},t.prototype.setPAC=function(n){this.writeScreen.setPAC(n)},t.prototype.setBkgData=function(n){this.writeScreen.setBkgData(n)},t.prototype.setMode=
function(n){n!==this.mode&&(this.mode=n,b.log("INFO","MODE="+n),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},t.prototype.insertChars=function(n){for(var l=0;l<n.length;l++)this.writeScreen.insertChar(n[l]);b.log("INFO",(this.writeScreen===this.displayedMemory?"DISP":"NON_DISP")+": "+this.writeScreen.getDisplayText(!0));
"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(b.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function(){b.log("INFO","RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")},t.prototype.ccBS=function(){b.log("INFO","BS - BackSpace");"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function(){},t.prototype.ccAON=function(){},t.prototype.ccDER=
function(){b.log("INFO","DER- Delete to End of Row");this.writeScreen.clearToEndOfRow();this.outputDataUpdate()},t.prototype.ccRU=function(n){b.log("INFO","RU("+n+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(n)},t.prototype.ccFON=function(){b.log("INFO","FON - Flash On");this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function(){b.log("INFO","RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=
function(){b.log("INFO","TR");this.setMode("MODE_TEXT")},t.prototype.ccRTD=function(){b.log("INFO","RTD");this.setMode("MODE_TEXT")},t.prototype.ccEDM=function(){b.log("INFO","EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate(!0)},t.prototype.ccCR=function(){b.log("CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate(!0)},t.prototype.ccENM=function(){b.log("INFO","ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()},t.prototype.ccEOC=
function(){if(b.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var n=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.writeScreen=this.nonDisplayedMemory=n;b.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function(n){b.log("INFO","TO("+n+") - Tab Offset");this.writeScreen.moveCursor(n)},t.prototype.ccMIDROW=function(n){var l={flash:!1};(l.underline=1==n%2,l.italics=46<=n,l.italics)?l.foreground="white":l.foreground=
"white green blue cyan red yellow magenta".split(" ")[Math.floor(n/2)-16];b.log("INFO","MIDROW: "+JSON.stringify(l));this.writeScreen.setPen(l)},t.prototype.outputDataUpdate=function(n){void 0===n&&(n=!1);var l=b.time;null!==l&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,l,this.lastOutputScreen),!0===n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),
this.cueStartTime=this.displayedMemory.isEmpty()?null:l):this.cueStartTime=l,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},t}();F=function(){function t(n,l,v){this.field=n||1;this.outputs=[l,v];this.channels=[new k(1,l),new k(2,v)];this.currChNr=-1;this.lastCmdB=this.lastCmdA=null;this.bufferedData=
[];this.lastTime=this.startTime=null;this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function(n){return this.channels[n].getHandler()},t.prototype.setHandler=function(n,l){this.channels[n].setHandler(l)},t.prototype.addData=function(n,l){var v,w,x,u=!1;this.lastTime=n;b.setTime(n);for(n=0;n<l.length;n+=2)if(w=127&l[n],x=127&l[n+1],0!==w||0!==x){if(b.log("DATA","["+f([l[n],l[n+1]])+"] -> ("+f([w,x])+")"),(v=this.parseCmd(w,x))||(v=this.parseMidrow(w,x)),v||(v=this.parsePAC(w,
x)),v||(v=this.parseBackgroundAttributes(w,x)),!v)if(u=this.parseChars(w,x))this.currChNr&&0<=this.currChNr?this.channels[this.currChNr-1].insertChars(u):b.log("WARNING","No channel found yet. TEXT-MODE?");v?this.dataCounters.cmd+=2:u?this.dataCounters.char+=2:(this.dataCounters.other+=2,b.log("WARNING","Couldn't parse cleaned data "+f([w,x])+" orig: "+f([l[n],l[n+1]])))}else this.dataCounters.padding+=2},t.prototype.parseCmd=function(n,l){if(!((20===n||28===n)&&32<=l&&47>=l||(23===n||31===n)&&33<=
l&&35>=l))return!1;if(n===this.lastCmdA&&l===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,b.log("DEBUG","Repeated command ("+f([n,l])+") is dropped"),!0;var v=20===n||23===n?1:2;var w=this.channels[v-1];return 20===n||28===n?32===l?w.ccRCL():33===l?w.ccBS():34===l?w.ccAOF():35===l?w.ccAON():36===l?w.ccDER():37===l?w.ccRU(2):38===l?w.ccRU(3):39===l?w.ccRU(4):40===l?w.ccFON():41===l?w.ccRDC():42===l?w.ccTR():43===l?w.ccRTD():44===l?w.ccEDM():45===l?w.ccCR():46===l?w.ccENM():47===l&&w.ccEOC():
w.ccTO(l-32),this.lastCmdA=n,this.lastCmdB=l,this.currChNr=v,!0},t.prototype.parseMidrow=function(n,l){var v=null;return(17===n||25===n)&&32<=l&&47>=l&&((v=17===n?1:2)!==this.currChNr?(b.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[v-1].ccMIDROW(l),b.log("DEBUG","MIDROW ("+f([n,l])+")"),!0))},t.prototype.parsePAC=function(n,l){if(!((17<=n&&23>=n||25<=n&&31>=n)&&64<=l&&127>=l||(16===n||24===n)&&64<=l&&95>=l))return!1;if(n===this.lastCmdA&&l===this.lastCmdB)return this.lastCmdA=
null,this.lastCmdB=null,!0;var v=23>=n?1:2;var w=this.interpretPAC(64<=l&&95>=l?1===v?g[n]:r[n]:1===v?p[n]:h[n],l);return this.channels[v-1].setPAC(w),this.lastCmdA=n,this.lastCmdB=l,this.currChNr=v,!0},t.prototype.interpretPAC=function(n,l){var v=l;n={color:null,italics:!1,indent:null,underline:!1,row:n};return v=95<l?l-96:l-64,n.underline=1==(1&v),13>=v?n.color="white green blue cyan red yellow magenta white".split(" ")[Math.floor(v/2)]:15>=v?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((v-
16)/2),n},t.prototype.parseChars=function(n,l){var v=null,w=null,x=null;(25<=n?(v=2,x=n-8):(v=1,x=n),17<=x&&19>=x)?(w=17===x?l+80:18===x?l+112:l+144,b.log("INFO","Special char '"+q(w)+"' in channel "+v),w=[w]):32<=n&&127>=n&&(w=0===l?[n]:[n,l]);w&&(v=f(w),b.log("DEBUG","Char codes =  "+v.join(",")),this.lastCmdB=this.lastCmdA=null);return w},t.prototype.parseBackgroundAttributes=function(n,l){var v,w,x;return((16===n||24===n)&&32<=l&&47>=l||(23===n||31===n)&&45<=l&&47>=l)&&(v={},16===n||24===n?(w=
Math.floor((l-32)/2),v.background=c[w],1==l%2&&(v.background+="_semi")):45===l?v.background="transparent":(v.foreground="black",47===l&&(v.underline=!0)),x=24>n?1:2,this.channels[x-1].setBkgData(v),this.lastCmdA=null,this.lastCmdB=null,!0)},t.prototype.reset=function(){for(var n=0;n<this.channels.length;n++)this.channels[n]&&this.channels[n].reset();this.lastCmdB=this.lastCmdA=null},t.prototype.cueSplitAtTime=function(n){for(var l=0;l<this.channels.length;l++)this.channels[l]&&this.channels[l].cueSplitAtTime(n)},
t}();C.default=F},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F=function(){function A(q,g){this.timelineController=q;this.trackName=g;this.screen=this.endTime=this.startTime=null}return A.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},A.prototype.newCue=function(q,g,p){(null===this.startTime||this.startTime>q)&&(this.startTime=q);this.endTime=g;this.screen=p;
this.timelineController.createCaptionsTrack(this.trackName)},A}();C.default=F},function(F,C,z){(function(A){Object.defineProperty(C,"__esModule",{value:!0});var q=z(30),g=z(11),p=function(h,c,b){return h.substr(b||0,c.length)===c},r=function(h){for(var c=5381,b=h.length;b;)c=33*c^h.charCodeAt(--b);return(c>>>0).toString()};C.default={parse:function(h,c,b,f,a,e){var m;h=g.utf8ArrayToStr(new Uint8Array(h)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");var d="00:00.000",k=0,t=0,n=0,l=[],v=!0,w=
new q.default;w.oncue=function(x){var u=b[f],y=b.ccOffset;if(u&&u.new)if(void 0!==t)y=b.ccOffset=u.start;else{u=n;var B=b[f],E=b[B.prevCC];if(!E||!E.new&&B.new)b.ccOffset=b.presentationOffset=B.start,B.new=!1;else{for(;E&&E.new;)b.ccOffset+=B.start-E.start,B.new=!1,E=b[(B=E).prevCC];b.presentationOffset=u}}n&&(y=n-b.presentationOffset);x.startTime+=y-t;x.endTime+=y-t;x.id=r(x.startTime.toString())+r(x.endTime.toString())+r(x.text);x.text=decodeURIComponent(encodeURIComponent(x.text));0<x.endTime&&
l.push(x)};w.onparsingerror=function(x){m=x};w.onflush=function(){m&&e?e(m):a(l)};h.forEach(function(x){if(v){if(p(x,"X-TIMESTAMP-MAP=")){v=!1;x.substr(16).split(",").forEach(function(u){p(u,"LOCAL:")?d=u.substr(6):p(u,"MPEGTS:")&&(k=parseInt(u.substr(7)))});try{0>c+(9E4*b[f].start||0)&&(c+=8589934592),k-=c,t=function(u){var y=parseInt(u.substr(-3)),B=parseInt(u.substr(-6,2)),E=parseInt(u.substr(-9,2));u=9<u.length?parseInt(u.substr(0,u.indexOf(":"))):0;return A.isFinite(y)&&A.isFinite(B)&&A.isFinite(E)&&
A.isFinite(u)?(y+=1E3*B,y+=6E4*E,y+36E5*u):-1}(d)/1E3,n=k/9E4,-1===t&&(m=Error("Malformed X-TIMESTAMP-MAP: "+x))}catch(u){m=Error("Malformed X-TIMESTAMP-MAP: "+x)}return}""===x&&(v=!1)}w.parse(x+"\n")});w.flush()}}}).call(this,z(2).Number)},function(F,C,z){(function(A){function q(f){for(var a=[],e=0;e<f.length;e++){var m=f[e];"subtitles"===m.kind&&m.label&&a.push(f[e])}return a}var g=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=
e}||function(a,e){for(var m in e)e.hasOwnProperty(m)&&(a[m]=e[m])};return function(a,e){function m(){this.constructor=a}f(a,e);a.prototype=null===e?Object.create(e):(m.prototype=e.prototype,new m)}}();Object.defineProperty(C,"__esModule",{value:!0});var p=z(1),r=z(4),h=z(0),c=z(8),b=function(f){function a(e){e=f.call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.MANIFEST_LOADED,p.default.SUBTITLE_TRACK_LOADED)||this;return e.tracks=[],e.trackId=-1,e.media=null,e.stopped=!0,e.subtitleDisplay=
!0,e}return g(a,f),a.prototype.destroy=function(){r.default.prototype.destroy.call(this)},a.prototype.onMediaAttached=function(e){var m=this;(this.media=e.media)&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){m.trackChangeListener()},
500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},a.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},a.prototype.onManifestLoaded=function(e){var m=this;this.tracks=e=e.subtitles||[];this.hls.trigger(p.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:e});e.forEach(function(d){d.default&&(m.media?m.subtitleTrack=
d.id:m.queuedDefaultTrack=d.id)})},a.prototype.onSubtitleTrackLoaded=function(e){var m=this,d=e.id,k=e.details,t=this.trackId,n=this.tracks,l=n[t];d>=n.length||d!==t||!l||this.stopped?this._clearReloadTimer():(h.logger.log("subtitle track "+d+" loaded"),k.live)?(e=c.computeReloadInterval(l.details,k,e.stats.trequest),h.logger.log("Reloading live subtitle playlist in "+e+"ms"),this.timer=setTimeout(function(){m._loadCurrentTrack()},e)):this._clearReloadTimer()},a.prototype.startLoad=function(){this.stopped=
!1;this._loadCurrentTrack()},a.prototype.stopLoad=function(){this.stopped=!0;this._clearReloadTimer()},Object.defineProperty(a.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))},enumerable:!0,configurable:!0}),a.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),
this.timer=null)},a.prototype._loadCurrentTrack=function(){var e=this.trackId,m=this.hls,d=this.tracks[e];0>e||!d||d.details&&!d.details.live||(h.logger.log("Loading subtitle track "+e),m.trigger(p.default.SUBTITLE_TRACK_LOADING,{url:d.url,id:e}))},a.prototype._toggleTrackModes=function(e){var m=this.media,d=this.subtitleDisplay,k=this.trackId;m&&(m=q(m.textTracks),-1===e?[].slice.call(m).forEach(function(t){t.mode="disabled"}):(k=m[k])&&(k.mode="disabled"),(e=m[e])&&(e.mode=d?"showing":"hidden"))},
a.prototype._setSubtitleTrackInternal=function(e){var m=this.hls,d=this.tracks;!A.isFinite(e)||-1>e||e>=d.length||(this.trackId=e,h.logger.log("Switching to subtitle track "+e),m.trigger(p.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},a.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,m=q(this.media.textTracks),d=0;d<m.length;d++)if("hidden"===m[d].mode)e=d;else if("showing"===m[d].mode){e=d;break}this.subtitleTrack=e}},a}(r.default);C.default=b}).call(this,
z(2).Number)},function(F,C,z){var A=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,d){m.__proto__=d}||function(m,d){for(var k in d)d.hasOwnProperty(k)&&(m[k]=d[k])};return function(m,d){function k(){this.constructor=m}e(m,d);m.prototype=null===d?Object.create(d):(k.prototype=d.prototype,new k)}}();Object.defineProperty(C,"__esModule",{value:!0});var q=z(1),g=z(0),p=z(13),r=z(5),h=z(27),c=z(7),b=z(15),f=z(8),a=window.performance;F=function(e){function m(d,
k){var t=e.call(this,d,q.default.MEDIA_ATTACHED,q.default.MEDIA_DETACHING,q.default.ERROR,q.default.KEY_LOADED,q.default.FRAG_LOADED,q.default.SUBTITLE_TRACKS_UPDATED,q.default.SUBTITLE_TRACK_SWITCH,q.default.SUBTITLE_TRACK_LOADED,q.default.SUBTITLE_FRAG_PROCESSED,q.default.LEVEL_UPDATED)||this;return t.fragmentTracker=k,t.config=d.config,t.state=b.State.STOPPED,t.tracks=[],t.tracksBuffered=[],t.currentTrackId=-1,t.decrypter=new p.default(d,d.config),t.lastAVStart=0,t._onMediaSeeking=t.onMediaSeeking.bind(t),
t}return A(m,e),m.prototype.onSubtitleFragProcessed=function(d){var k=d.frag;d=d.success;if(this.fragPrevious=k,this.state=b.State.IDLE,d)if(d=this.tracksBuffered[this.currentTrackId]){for(var t,n=k.start,l=0;l<d.length;l++)if(n>=d[l].start&&n<=d[l].end){t=d[l];break}k=k.start+k.duration;t?t.end=k:(t={start:n,end:k},d.push(t))}},m.prototype.onMediaAttached=function(d){this.media=d=d.media;d.addEventListener("seeking",this._onMediaSeeking);this.state=b.State.IDLE},m.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",
this._onMediaSeeking);this.media=null;this.state=b.State.STOPPED},m.prototype.onError=function(d){(d=d.frag)&&"subtitle"===d.type&&(this.state=b.State.IDLE)},m.prototype.onSubtitleTracksUpdated=function(d){var k=this;g.logger.log("subtitle tracks updated");this.tracksBuffered=[];this.tracks=d.subtitleTracks;this.tracks.forEach(function(t){k.tracksBuffered[t.id]=[]})},m.prototype.onSubtitleTrackSwitch=function(d){(this.currentTrackId=d.id,this.tracks&&-1!==this.currentTrackId)?(d=this.tracks[this.currentTrackId])&&
d.details&&this.setInterval(500):this.clearInterval()},m.prototype.onSubtitleTrackLoaded=function(d){var k=d.id;d=d.details;var t=this.currentTrackId,n=this.tracks,l=n[t];k>=n.length||k!==t||!l||(d.live&&f.mergeSubtitlePlaylists(l.details,d,this.lastAVStart),l.details=d,this.setInterval(500))},m.prototype.onKeyLoaded=function(){this.state===b.State.KEY_LOADING&&(this.state=b.State.IDLE)},m.prototype.onFragLoaded=function(d){var k=this.fragCurrent,t=d.frag.decryptdata,n=d.frag,l=this.hls;if(this.state===
b.State.FRAG_LOADING&&k&&"subtitle"===d.frag.type&&k.sn===d.frag.sn&&0<d.payload.byteLength&&t&&t.key&&"AES-128"===t.method){var v=a.now();this.decrypter.decrypt(d.payload,t.key.buffer,t.iv.buffer,function(w){var x=a.now();l.trigger(q.default.FRAG_DECRYPTED,{frag:n,payload:w,stats:{tstart:v,tdecrypt:x}})})}},m.prototype.onLevelUpdated=function(d){d=d.details.fragments;this.lastAVStart=d.length?d[0].start:0},m.prototype.doTick=function(){if(this.media)switch(this.state){case b.State.IDLE:var d=this.config,
k=this.currentTrackId,t=this.fragmentTracker,n=this.media,l=this.tracks;if(l&&l[k]&&l[k].details){var v=d.maxBufferHole,w=d.maxFragLookUpTolerance;d=Math.min(d.maxBufferLength,d.maxMaxBufferLength);v=r.BufferHelper.bufferedInfo(this._getBuffered(),n.currentTime,v);n=v.end;k=l[k].details;l=k.fragments;var x=l.length;v.len>d||(d=void 0,v=this.fragPrevious,n<l[x-1].start+l[x-1].duration?(v&&k.hasProgramDateTime&&(d=h.findFragmentByPDT(l,v.endProgramDateTime,w)),d||(d=h.findFragmentByPTS(v,l,n,w))):d=
l[x-1],d&&d.encrypted?(g.logger.log("Loading key for "+d.sn),this.state=b.State.KEY_LOADING,this.hls.trigger(q.default.KEY_LOADING,{frag:d})):d&&t.getState(d)===c.FragmentState.NOT_LOADED&&(this.fragCurrent=d,this.state=b.State.FRAG_LOADING,this.hls.trigger(q.default.FRAG_LOADING,{frag:d})))}}else this.state=b.State.IDLE},m.prototype.stopLoad=function(){this.lastAVStart=0;e.prototype.stopLoad.call(this)},m.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},m.prototype.onMediaSeeking=
function(){this.fragPrevious=null},m}(b.default);C.SubtitleStreamController=F},function(F,C,z){var A=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,b){c.__proto__=b}||function(c,b){for(var f in b)b.hasOwnProperty(f)&&(c[f]=b[f])};return function(c,b){function f(){this.constructor=c}h(c,b);c.prototype=null===b?Object.create(b):(f.prototype=b.prototype,new f)}}();Object.defineProperty(C,"__esModule",{value:!0});F=z(4);var q=z(1),g=z(3),p=z(0),
r=window.XMLHttpRequest;z=function(h){function c(b){var f=h.call(this,b,q.default.MEDIA_ATTACHED,q.default.MANIFEST_PARSED)||this;return f._widevineLicenseUrl=b.config.widevineLicenseUrl,f._licenseXhrSetup=b.config.licenseXhrSetup,f._emeEnabled=b.config.emeEnabled,f._requestMediaKeySystemAccess=b.config.requestMediaKeySystemAccessFunc,f._mediaKeysList=[],f._media=null,f._hasSetMediaKeys=!1,f._isMediaEncrypted=!1,f._requestLicenseFailureCount=0,f}return A(c,h),c.prototype.getLicenseServerUrl=function(b){switch(b){case "com.widevine.alpha":var f=
this._widevineLicenseUrl;break;default:f=null}return f||(p.logger.error('No license server URL configured for key-system "'+b+'"'),this.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),f},c.prototype._attemptKeySystemAccess=function(b,f,a){var e=this;(f=function(m,d,k){switch(m){case "com.widevine.alpha":return function(t,n,l){var v={videoCapabilities:[]};return n.forEach(function(w){v.videoCapabilities.push({contentType:'video/mp4; codecs="'+
w+'"'})}),[v]}(0,k);default:throw Error("Unknown key-system: "+m);}}(b,0,a))?(p.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(b,f).then(function(m){e._onMediaKeySystemAccessObtained(b,m)}).catch(function(m){p.logger.error('Failed to obtain key-system "'+b+'" access:',m)})):p.logger.warn("Can not create config for key-system (maybe because platform is not supported):",b)},Object.defineProperty(c.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw Error("No requestMediaKeySystemAccess function configured");
return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),c.prototype._onMediaKeySystemAccessObtained=function(b,f){var a=this;p.logger.log('Access for key-system "'+b+'" obtained');var e={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:f,mediaKeySystemDomain:b};this._mediaKeysList.push(e);f.createMediaKeys().then(function(m){e.mediaKeys=m;p.logger.log('Media-keys created for key-system "'+b+'"');a._onMediaKeysCreated()}).catch(function(m){p.logger.error("Failed to create media-keys:",
m)})},c.prototype._onMediaKeysCreated=function(){var b=this;this._mediaKeysList.forEach(function(f){f.mediaKeysSession||(f.mediaKeysSession=f.mediaKeys.createSession(),b._onNewMediaKeySession(f.mediaKeysSession))})},c.prototype._onNewMediaKeySession=function(b){var f=this;p.logger.log("New key-system session "+b.sessionId);b.addEventListener("message",function(a){f._onKeySessionMessage(b,a.message)},!1)},c.prototype._onKeySessionMessage=function(b,f){p.logger.log("Got EME message event, creating license request");
this._requestLicense(f,function(a){p.logger.log("Received license data, updating key-session");b.update(a)})},c.prototype._onMediaEncrypted=function(b,f){p.logger.log('Media is encrypted using "'+b+'" init data type');this._isMediaEncrypted=!0;this._mediaEncryptionInitDataType=b;this._mediaEncryptionInitData=f;this._attemptSetMediaKeys();this._generateRequestWithPreferredKeySession()},c.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var b=this._mediaKeysList[0];if(!b||!b.mediaKeys)return p.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),
void this.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});p.logger.log("Setting keys for encrypted media");this._media.setMediaKeys(b.mediaKeys);this._hasSetMediaKeys=!0}},c.prototype._generateRequestWithPreferredKeySession=function(){var b=this,f=this._mediaKeysList[0];if(!f)return p.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,
details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(f.mediaKeysSessionInitialized)p.logger.warn("Key-Session already initialized but requested again");else{var a=f.mediaKeysSession;a||(p.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var e=this._mediaEncryptionInitDataType,m=this._mediaEncryptionInitData;p.logger.log('Generating key-session request for "'+
e+'" init data type');f.mediaKeysSessionInitialized=!0;a.generateRequest(e,m).then(function(){p.logger.debug("Key-session generation succeeded")}).catch(function(d){p.logger.error("Error generating key-session request:",d);b.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},c.prototype._createLicenseXhr=function(b,f,a){var e=new r,m=this._licenseXhrSetup;try{if(m)try{m(e,b)}catch(d){e.open("POST",b,!0),m(e,b)}e.readyState||
e.open("POST",b,!0)}catch(d){return p.logger.error("Error setting up key-system license XHR",d),void this.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,b,f,a),e},c.prototype._onLicenseRequestReadyStageChange=function(b,f,a,e){switch(b.readyState){case 4:if(200===b.status)this._requestLicenseFailureCount=0,
p.logger.log("License request succeeded"),e(b.response);else{if(p.logger.error("License Request XHR failed ("+f+"). Status: "+b.status+" ("+b.statusText+")"),this._requestLicenseFailureCount++,3>=this._requestLicenseFailureCount)return p.logger.warn("Retrying license request, "+(3-this._requestLicenseFailureCount+1)+" attempts left"),void this._requestLicense(a,e);this.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},
c.prototype._generateLicenseRequestChallenge=function(b,f){var a;return"com.microsoft.playready"===b.mediaKeySystemDomain?p.logger.error("PlayReady is not supported (yet)"):"com.widevine.alpha"===b.mediaKeySystemDomain?a=f:p.logger.error("Unsupported key-system:",b.mediaKeySystemDomain),a},c.prototype._requestLicense=function(b,f){p.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a)return p.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),
void this.hls.trigger(q.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var e=this.getLicenseServerUrl(a.mediaKeySystemDomain);f=this._createLicenseXhr(e,b,f);p.logger.log("Sending license request to URL: "+e);f.send(this._generateLicenseRequestChallenge(a,b))},c.prototype.onMediaAttached=function(b){var f=this;this._emeEnabled&&(this._media=b=b.media,b.addEventListener("encrypted",function(a){f._onMediaEncrypted(a.initDataType,a.initData)}))},
c.prototype.onManifestParsed=function(b){if(this._emeEnabled){var f=b.levels.map(function(a){return a.audioCodec});b=b.levels.map(function(a){return a.videoCodec});this._attemptKeySystemAccess("com.widevine.alpha",f,b)}},c}(F.default);C.default=z},function(F,C,z){Object.defineProperty(C,"__esModule",{value:!0});F="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;C.requestMediaKeySystemAccess=
F}]).default});